# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr add_count
#' @export
add_count.data.frame <- function(x, ..., wt = NULL, sort = FALSE, name = NULL, .drop = deprecated()) {
  # Our implementation
  rel_try(
    "No relational implementation for add_count()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  add_count <- add_count_data_frame
  out <- add_count(x, ..., wt = {{ wt }}, sort = sort, name = name, .drop = .drop)
  return(out)

  # dplyr implementation
  out <- add_count_impl(
    x,
    ...,
    wt = {{ wt }},
    sort = sort,
    name = name,
    .drop = .drop
  )
  dplyr_reconstruct(out, x)
}

duckplyr_add_count <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- add_count(x, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr anti_join
#' @export
anti_join.data.frame <- function(x, y, by = NULL, copy = FALSE, ..., na_matches = c("na", "never")) {
  check_dots_empty0(...)
  error_call <- caller_env()

  # https://github.com/duckdb/duckdb/issues/6597
  na_matches <- check_na_matches(na_matches, error_call = error_call)

  # Our implementation
  rel_try(
    "No relational implementation for anti_join(copy = TRUE)" = copy,
    {
      out <- rel_join_impl(x, y, by, "anti", na_matches, error_call = error_call)
      return(out)
    }
  )

  # dplyr forward
  anti_join <- anti_join_data_frame
  out <- anti_join(x, y, by, copy, ..., na_matches = na_matches)
  return(out)

  # dplyr implementation
  check_dots_empty0(...)
  y <- auto_copy(x, y, copy = copy)
  join_filter(x, y, by = by, type = "anti", na_matches = na_matches, user_env = caller_env())
}

duckplyr_anti_join <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- anti_join(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr arrange
#' @export
arrange.data.frame <- function(.data, ..., .by_group = FALSE, .locale = NULL) {
  force(.data)

  dots <- enquos(...)
  dots <- unname(dots)

  if (.by_group) {
    dots <- c(quos(!!!groups(.data)), dots)
  }

  rel_try(
    ".locale argument not supported" = !is.null(.locale),
    "dplyr.legacy_locale not supported" = isTRUE(getOption("dplyr.legacy_locale")),
    {
      # Translate to df before early exit, so that we can bail out for subclasses
      rel <- duckdb_rel_from_df(.data)
      if (length(dots) == 0) {
        return(.data)
      }
      exprs <- rel_translate_dots(dots, .data)
      out_rel <- rel_order(rel, exprs)
      out <- rel_to_df(out_rel)
      out <- dplyr_reconstruct(out, .data)
      return(out)
    }
  )

  # dplyr forward
  arrange <- arrange_data_frame
  out <- arrange(.data, ..., .by_group = .by_group, .locale = .locale)
  return(out)

  # dplyr implementation
  dots <- enquos(...)

  if (.by_group) {
    dots <- c(quos(!!!groups(.data)), dots)
  }

  loc <- arrange_rows(.data, dots = dots, locale = .locale)
  dplyr_row_slice(.data, loc)
}

duckplyr_arrange <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- arrange(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

#' @export
as_duckplyr_df <- function(.data) {
  if (inherits(.data, "duckplyr_df")) {
    return(.data)
  }

  if (!identical(class(.data), "data.frame") && !identical(class(.data), c("tbl_df", "tbl", "data.frame"))) {
    abort("Must pass a plain data frame or a tibble to `as_duckplyr_df()`.")
  }

  if (is.character(.row_names_info(.data, 0L))) {
    abort("Must pass data frame without row names to `as_duckplyr_df()`.")
  }

  if (anyNA(names(.data)) || any(names(.data) == "")) {
    abort("Missing or empty names not allowed.")
  }

  class(.data) <- c("duckplyr_df", class(.data))
  .data
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr auto_copy
#' @export
auto_copy.data.frame <- function(x, y, copy = FALSE, ...) {
  return(as_duckplyr_df(y))

  # dplyr implementation
  as.data.frame(y)
}

duckplyr_auto_copy <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- auto_copy(x, y, ...)
  out
}

# Generated by 02-duckplyr_df-methods.R
duckplyr_collapse <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- collapse(x, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr collect
#' @export
collect.data.frame <- function(x, ...) {
  # Side effect: ALTREP materialization is triggered
  nrow(x)
  x
}

duckplyr_collect <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- collect(x, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr compute
#' @export
compute.data.frame <- function(x, ...) {
  # Our implementation
  rel_try(
    "No relational implementation for compute()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  compute <- compute_data_frame
  out <- compute(x, ...)
  return(out)

  # dplyr implementation
  x
}

duckplyr_compute <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- compute(x, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr count
#' @export
count.data.frame <- function(x, ..., wt = NULL, sort = FALSE, name = NULL, .drop = group_by_drop_default(x)) {
  force(x)

  dplyr_local_error_call()

  quos <- enquos(...)
  exprs <- unname(map(quos, quo_get_expr))
  is_name <- map_lgl(exprs, is_symbol)

  # FIXME: Use rel_try() for accurate stats
  if (!is_grouped_df(x) && all(is_name) && .drop && !sort) {
    by_chr <- map_chr(exprs, as_string)
    name <- check_n_name(name, by_chr)

    if (!(name %in% by_chr)) {
      n <- tally_n(x, {{ wt }})

      out <- summarise(x, !!name := !!n, .by = c(!!!exprs))
      out <- dplyr_reconstruct(out, x)
      return(out)
    }
  }

  # FIXME: optimize, no need to forward dots
  # out <- count(x_df, !!!quos, wt = {{ wt }}, sort = sort, name = name, .drop = .drop)

  # dplyr forward
  count <- count_data_frame
  out <- count(x, ..., wt = {{ wt }}, sort = sort, name = name, .drop = .drop)
  return(out)

  # dplyr implementation
  dplyr_local_error_call()

  if (!missing(...)) {
    out <- group_by(x, ..., .add = TRUE, .drop = .drop)
  } else {
    out <- x
  }

  out <- tally(out, wt = !!enquo(wt), sort = sort, name = name)

  # Ensure grouping is transient
  out <- dplyr_reconstruct(out, x)

  out
}

duckplyr_count <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- count(x, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr cross_join
#' @export
cross_join.data.frame <- function(x, y, ..., copy = FALSE, suffix = c(".x", ".y")) {
  # Our implementation
  rel_try(
    "No relational implementation for cross_join()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  cross_join <- cross_join_data_frame
  out <- cross_join(x, y, ..., copy = copy, suffix = suffix)
  return(out)

  # dplyr implementation
  check_dots_empty0(...)

  y <- auto_copy(x, y, copy = copy)

  x_names <- tbl_vars(x)
  y_names <- tbl_vars(y)

  # Empty join by with no keys
  by <- new_join_by()

  # Particular value isn't too important, as there are no keys to keep/drop
  keep <- FALSE

  vars <- join_cols(
    x_names = x_names,
    y_names = y_names,
    by = by,
    suffix = suffix,
    keep = keep
  )

  x_in <- as_tibble(x, .name_repair = "minimal")
  y_in <- as_tibble(y, .name_repair = "minimal")

  x_size <- vec_size(x_in)
  y_size <- vec_size(y_in)

  x_out <- set_names(x_in, names(vars$x$out))
  y_out <- set_names(y_in, names(vars$y$out))

  x_out <- vec_rep_each(x_out, times = y_size)
  y_out <- vec_rep(y_out, times = x_size)

  x_out[names(y_out)] <- y_out

  dplyr_reconstruct(x_out, x)
}

duckplyr_cross_join <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- cross_join(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

#' @export
duckdb_from_file <- function(path, table_function, options=list()) {
  # FIXME: For some reason, it's important to create an alias here
  con <- get_default_duckdb_connection()

  out <- duckdb:::rel_from_table_function(
    con,
    table_function,
    list(path),
    options
  )

  meta_rel_register_csv(out, path)

  duckdb:::rel_to_altrep(out)
}

#' @export
duckplyr_df_from_file <- function(path, table_function, options=list()) {
  out <- duckdb_from_file(path, table_function, options)
  as_duckplyr_df(out)
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr distinct
#' @export
distinct.data.frame <- function(.data, ..., .keep_all = FALSE) {
  # Our implementation
  rel_try(
    {
      dots <- enquos(..., .named = TRUE)
      # FIXME: avoid column duplication in a cleaner way
      dupes <- duplicated(names(dots), fromLast = TRUE)
      dots <- dots[!dupes]

      rel <- duckdb_rel_from_df(.data)

      oo <- .keep_all || oo_force()

      if (oo) {
        # Push row number as separate projection
        rel <- oo_prep(rel, force = TRUE)

        exprs <- rel_translate_dots(dots, .data)
        all_exprs <- NULL
        if (length(exprs) == 0) {
          exprs <- imap(set_names(names(.data)), relexpr_reference, rel = NULL)
          all_exprs <- exprs
        }

        if (.keep_all) {
          proj_exprs <- all_exprs %||% imap(set_names(names(.data)), relexpr_reference, rel = NULL)
        } else {
          proj_exprs <- exprs
        }

        proj_exprs <- c(proj_exprs, list(
          relexpr_reference("___row_number"),
          relexpr_window(
            relexpr_function("row_number", list()),
            partitions = exprs,
            alias = "___row_number_by"
          )
        ))

        rel <- rel_project(rel, unname(proj_exprs))

        expr_filter <- rel_translate(
          quo(`___row_number_by` == 1L),
          names_data = "___row_number_by"
        )
        out_rel <- rel_filter(rel, list(expr_filter))

        out_rel <- oo_restore_order(out_rel, force = TRUE)
        out_rel <- oo_restore_cols(out_rel, extra = "___row_number_by", force = TRUE)
      } else {
        exprs <- rel_translate_dots(dots, .data)
        if (length(exprs) > 0) {
          rel <- rel_project(rel, exprs)
        }
        out_rel <- rel_distinct(rel)
      }

      out <- rel_to_df(out_rel)
      out <- dplyr_reconstruct(out, .data)
      return(out)
    }
  )

  # dplyr forward
  distinct <- distinct_data_frame
  out <- distinct(.data, ..., .keep_all = .keep_all)
  return(out)

  # dplyr implementation
  prep <- distinct_prepare(
    .data,
    vars = enquos(...),
    group_vars = group_vars(.data),
    .keep_all = .keep_all,
    caller_env = caller_env()
  )

  out <- prep$data

  cols <- dplyr_col_select(out, prep$vars)
  loc <- vec_unique_loc(cols)

  out <- dplyr_col_select(out, prep$keep)
  dplyr_row_slice(out, loc)
}

duckplyr_distinct <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- distinct(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr do
#' @export
do.data.frame <- function(.data, ...) {
  # Our implementation
  rel_try(
    "No relational implementation for do()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  do <- do_data_frame
  out <- do(.data, ...)
  return(out)

  # dplyr implementation
  args <- enquos(...)
  named <- named_args(args)

  # Create custom data mask with `.` pronoun
  mask <- new_data_mask(new_environment())
  env_bind_do_pronouns(mask, .data)

  if (!named) {
    out <- eval_tidy(args[[1]], mask)
    if (!inherits(out, "data.frame")) {
      msg <- glue("Result must be a data frame, not {fmt_classes(out)}.")
      abort(msg)
    }
  } else {
    out <- map(args, function(arg) list(eval_tidy(arg, mask)))
    names(out) <- names(args)
    out <- tibble::as_tibble(out, .name_repair = "minimal")
  }

  out
}

duckplyr_do <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- do(.data, ...)
  out
}

fix_auto_name <- function(dots) {
  if (is.null(names(dots))) {
    dots <- set_names(dots, "")
  }

  for (i in seq_along(dots)) {
    dot <- dots[[i]]
    if (names(dots)[[i]] == "") {
      quo_data <- attr(dot, "dplyr:::data")
      names(dots)[[i]] <- as_label(quo_data$name)
    }
  }

  dots
}

duckplyr_mutate_keep <- function(out, keep, used, names_new, names_groups) {
  if (keep == "all") {
    return(out)
  }

  names <- names(out)

  names_keep <- switch(keep,
    used = names(used)[used],
    unused = names(used)[!used],
    none = character(),
    abort("Unknown `keep`.", .internal = TRUE)
  )

  names_out <- intersect(names, c(names_new, names_groups, names_keep))

  select(out, !!!names_out)
}

# Generated by 02-duckplyr_df-methods.R

#' @importFrom dplyr dplyr_reconstruct
NULL

#' @export
dplyr_reconstruct.data.frame <- function(data, template) {
  if (inherits(data, c("grouped_df", "rowwise_df"))) {
    return(data)
  }
  .Call(duckplyr:::copy_df_attribs, data, template)
  return(data)

  # dplyr forward
  dplyr_reconstruct <- dplyr_reconstruct_data_frame
  out <- dplyr_reconstruct(data, template)
  return(out)

  # dplyr implementation
  attrs <- attributes(template)
  attrs$names <- names(data)
  attrs$row.names <- .row_names_info(data, type = 0L)

  attributes(data) <- attrs
  data
}

duckplyr_dplyr_reconstruct <- function(data, ...) {
  try_fetch(
    data <- as_duckplyr_df(data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- dplyr_reconstruct(data, ...)
  out
}

# @importFrom dplyr explain
#' @export
explain.data.frame <- function(x, ...) {
  rel_try({
    rel <- duckdb_rel_from_df(x)
    rel_explain(rel)
    return(invisible())
  })

  writeLines("Can't convert to relational, fallback implementation will be used.")
  invisible()
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr filter
#' @export
filter.data.frame <- function(.data, ..., .by = NULL, .preserve = FALSE) {
  force(.data)

  dots <- dplyr_quosures(...)
  check_filter(dots)

  by <- enquo(.by)

  rel_try(
    "Can't use relational with zero-column result set." = (length(.data) == 0),
    "Can't use relational without filter conditions." = (length(dots) == 0),
    "Can't use relational with grouped operation." = (!quo_is_null(by)), # (length(by$names) > 0),
    {
      exprs <- rel_translate_dots(dots, .data)
      rel <- duckdb_rel_from_df(.data)
      out_rel <- rel_filter(rel, exprs)
      out <- rel_to_df(out_rel)
      out <- dplyr_reconstruct(out, .data)
      return(out)
    }
  )

  # dplyr forward
  filter <- filter_data_frame
  out <- filter(.data, ..., .by = {{ .by }}, .preserve = .preserve)
  return(out)

  # dplyr implementation
  dots <- dplyr_quosures(...)
  check_filter(dots)

  by <- compute_by(
    by = {{ .by }},
    data = .data,
    by_arg = ".by",
    data_arg = ".data"
  )

  loc <- filter_rows(.data, dots, by)
  dplyr_row_slice(.data, loc, preserve = .preserve)
}

duckplyr_filter <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- filter(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr full_join
#' @export
full_join.data.frame <- function(x, y, by = NULL, copy = FALSE, suffix = c(".x", ".y"), ..., keep = NULL, na_matches = c("na", "never"), multiple = "all", relationship = NULL) {
  check_dots_empty0(...)
  error_call <- caller_env()

  # Our implementation
  rel_try(
    "No implicit cross joins for full_join()" = is_cross_by(by),
    "No relational implementation for full_join(copy = TRUE)" = copy,
    {
      out <- rel_join_impl(x, y, by, "full", na_matches, suffix, keep, error_call)
      return(out)
    }
  )

  # dplyr forward
  full_join <- full_join_data_frame
  out <- full_join(x, y, by, copy, suffix, ..., keep = keep, na_matches = na_matches, multiple = multiple, relationship = relationship)
  return(out)

  # dplyr implementation
  check_dots_empty0(...)
  y <- auto_copy(x, y, copy = copy)
  join_mutate(
    x = x,
    y = y,
    by = by,
    type = "full",
    suffix = suffix,
    na_matches = na_matches,
    keep = keep,
    multiple = multiple,
    # All keys from both inputs are retained. Erroring never makes sense.
    unmatched = "drop",
    relationship = relationship,
    user_env = caller_env()
  )
}

duckplyr_full_join <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- full_join(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr group_vars
#' @export
group_vars.data.frame <- function(x) {
  if (inherits(x, c("grouped_df", "rowwise_df"))) {
    return(group_vars_data_frame(x))
  }

  # Avoid calling group_data()
  character()
}

duckplyr_group_vars <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- group_vars(x, ...)
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr inner_join
#' @export
inner_join.data.frame <- function(x, y, by = NULL, copy = FALSE, suffix = c(".x", ".y"), ..., keep = NULL, na_matches = c("na", "never"), multiple = "all", unmatched = "drop", relationship = NULL) {
  check_dots_empty0(...)
  error_call <- caller_env()

  # Our implementation
  rel_try(
    "No implicit cross joins for inner_join()" = is_cross_by(by),
    "No relational implementation for inner_join(copy = TRUE)" = copy,
    {
      out <- rel_join_impl(x, y, by, "inner", na_matches, suffix, keep, error_call)
      return(out)
    }
  )

  # dplyr forward
  inner_join <- inner_join_data_frame
  out <- inner_join(x, y, by, copy, suffix, ..., keep = keep, na_matches = na_matches, multiple = multiple, unmatched = unmatched, relationship = relationship)
  return(out)

  # dplyr implementation
  check_dots_empty0(...)
  y <- auto_copy(x, y, copy = copy)
  join_mutate(
    x = x,
    y = y,
    by = by,
    type = "inner",
    suffix = suffix,
    na_matches = na_matches,
    keep = keep,
    multiple = multiple,
    unmatched = unmatched,
    relationship = relationship,
    user_env = caller_env()
  )
}

duckplyr_inner_join <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- inner_join(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr intersect
#' @export
intersect.data.frame <- function(x, y, ...) {
  # Our implementation
  check_dots_empty()

  x_names <- names(x)
  y_names <- names(y)
  if (identical(x_names, y_names)) {
    # Ensure identical() is very cheap
    y_names <- x_names
  }

  rel_try(
    "No duplicate names" = !identical(x_names, y_names) && anyDuplicated(x_names) && anyDuplicated(y_names),
    "Tables of different width" = length(x_names) != length(y_names),
    "Name mismatch" = !identical(x_names, y_names) && !all(y_names %in% x_names),
    {
      x_rel <- duckdb_rel_from_df(x)
      y_rel <- duckdb_rel_from_df(y)
      if (!identical(x_names, y_names)) {
        # FIXME: Select by position
        exprs <- nexprs_from_loc(x_names, set_names(seq_along(x_names), x_names))
        y_rel <- rel_project(y_rel, exprs)
      }

      rel <- rel_set_intersect(x_rel, y_rel)
      out <- rel_to_df(rel)
      out <- dplyr_reconstruct(out, x)
      return(out)
    }
  )

  # dplyr forward
  intersect <- intersect_data_frame
  out <- intersect(x, y, ...)
  return(out)

  # dplyr implementation
  check_dots_empty()
  check_compatible(x, y)

  out <- vec_set_intersect(x, y, error_call = current_env())

  dplyr_reconstruct(out, x)
}

duckplyr_intersect <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- intersect(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

#' @export
is_duckplyr_df <- function(.data) {
  inherits(.data, "duckplyr_df")
}

rel_join_impl <- function(x, y, by, join, na_matches, suffix, keep, error_call = caller_env()) {
  mutating <- !(join %in% c("semi", "anti"))

  if (mutating) {
    check_keep(keep, error_call = error_call)
  }

  na_matches <- check_na_matches(na_matches, error_call = error_call)

  x_names <- tbl_vars(x)
  y_names <- tbl_vars(y)

  if (is_null(by)) {
    by <- join_by_common(x_names, y_names, error_call = error_call)
  } else {
    by <- as_join_by(by, error_call = error_call)
  }

  x_by <- by$x
  y_by <- by$y
  x_rel <- duckdb_rel_from_df(x)
  x_rel <- rel_set_alias(x_rel, "lhs")
  y_rel <- duckdb_rel_from_df(y)
  y_rel <- rel_set_alias(y_rel, "rhs")

  # Rename if non-unique column names
  if (mutating) {
    if (length(intersect(x_names, y_names)) != 0) {
      x_names_remap <- paste0(x_names, "_x")
      x_by <- paste0(x_by, "_x")
      x_exprs <- exprs_from_loc(x, set_names(seq_along(x_names_remap), x_names_remap))
      x_rel <- rel_project(x_rel, x_exprs)

      y_names_remap <- paste0(y_names, "_y")
      y_by <- paste0(y_by, "_y")
      y_exprs <- exprs_from_loc(y, set_names(seq_along(y_names_remap), y_names_remap))
      y_rel <- rel_project(y_rel, y_exprs)
    } else {
      x_names_remap <- x_names
      y_names_remap <- y_names
    }
  }

  x_rel <- oo_prep(x_rel, "___row_number_x")
  if (mutating) {
    y_rel <- oo_prep(y_rel, "___row_number_y")
  }

  x_by <- map(x_by, relexpr_reference, rel = x_rel)
  y_by <- map(y_by, relexpr_reference, rel = y_rel)

  cond_by <- by$condition

  if (na_matches == "na") {
    cond_by[cond_by == "=="] <- "___eq_na_matches_na"
  }

  conds <- pmap(list(cond_by, x_by, y_by), ~ relexpr_function(..1, list(..2, ..3)))

  if (any(by$filter != "none")) {
    join_ref_type <- "asof"
  } else {
    join_ref_type <- "regular"
  }

  joined <- rel_join(x_rel, y_rel, conds, join, join_ref_type)

  if (mutating) {
    joined <- oo_restore_order(
      joined,
      c("___row_number_x", "___row_number_y"),
      list(x_rel, y_rel)
    )

    vars <- join_cols(
      x_names = x_names,
      y_names = y_names,
      by = by,
      suffix = suffix,
      keep = keep,
      error_call = error_call
    )

    exprs <- c(
      nexprs_from_loc(x_names_remap, vars$x$out),
      nexprs_from_loc(y_names_remap, vars$y$out)
    )

    remap <- (is.null(keep) || is_false(keep))

    if (remap) {
      by_pos <- match(names(vars$x$key), x_names)
      # Only coalesce for equi-joins
      eq_idx <- (by$condition == "==")

      if (join == "right") {
        exprs[by_pos[eq_idx]] <- map2(y_by[eq_idx], names(vars$x$key)[eq_idx], relexpr_set_alias)
      } else {
        exprs[by_pos[eq_idx]] <- pmap(
          list(x_by[eq_idx], y_by[eq_idx], names(vars$x$key)[eq_idx]),
          ~ relexpr_function("___coalesce", list(..1, ..2), alias = ..3)
        )
      }
    }

    out <- rel_project(joined, exprs)
  } else {
    out <- oo_restore(joined, "___row_number_x", list(x_rel))
  } # if (mutating)

  out <- rel_to_df(out)
  out <- dplyr_reconstruct(out, x)

  return(out)
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr left_join
#' @export
left_join.data.frame <- function(x, y, by = NULL, copy = FALSE, suffix = c(".x", ".y"), ..., keep = NULL, na_matches = c("na", "never"), multiple = "all", unmatched = "drop", relationship = NULL) {
  check_dots_empty0(...)
  error_call <- caller_env()

  # Our implementation
  rel_try(
    "No implicit cross joins for left_join()" = is_cross_by(by),
    "No relational implementation for left_join(copy = TRUE)" = copy,
    {
      out <- rel_join_impl(x, y, by, "left", na_matches, suffix, keep, error_call)
      return(out)
    }
  )

  # dplyr forward
  left_join <- left_join_data_frame
  out <- left_join(x, y, by, copy, suffix, ..., keep = keep, na_matches = na_matches, multiple = multiple, unmatched = unmatched, relationship = relationship)
  return(out)

  # dplyr implementation
  check_dots_empty0(...)
  y <- auto_copy(x, y, copy = copy)
  join_mutate(
    x = x,
    y = y,
    by = by,
    type = "left",
    suffix = suffix,
    na_matches = na_matches,
    keep = keep,
    multiple = multiple,
    unmatched = unmatched,
    relationship = relationship,
    user_env = caller_env()
  )
}

duckplyr_left_join <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- left_join(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

pre_code_cache <- collections::queue()
code_cache <- collections::queue()
macro_cache <- collections::dict()
df_cache <- collections::dict()
rel_cache <- collections::dict()

meta_clear <- function() {
  pre_code_cache$clear()
  code_cache$clear()
  macro_cache$clear()
  df_cache$clear()
  rel_cache$clear()
}

meta_pre_record <- function(call) {
  pre_code_cache$push(new_prom_fun({{ call }}))
  invisible()
}

meta_record <- function(call) {
  code_cache$push(new_prom_fun({{ call }}))
  invisible()
}

meta_replay <- function(add_pre_code = TRUE) {
  if (add_pre_code) {
    con_exprs <- list(
      expr(con <- DBI::dbConnect(duckdb::duckdb())),
      expr(experimental <- !!(Sys.getenv("DUCKPLYR_EXPERIMENTAL") == "TRUE"))
    )
    con_code <- map(con_exprs, constructive::deparse_call)
    pre_code <- c(
      con_code,
      map(pre_code_cache$as_list(), ~ .x())
    )
  } else {
    pre_code <- NULL
  }

  # HACK
  count <- rel_cache$size()
  res_name <- sym(paste0("rel", count))
  res_mat_expr <- expr(duckdb:::rel_to_altrep(!!res_name))
  res_code <- map(list(res_name, res_mat_expr), constructive::deparse_call)

  all_code <- c(
    pre_code,
    map(code_cache$as_list(), ~ .x()),
    res_code
  )

  walk(all_code, print)
}

meta_replay_to_fun_code <- function() {
  code <- utils::capture.output(meta_replay(add_pre_code = FALSE))
  code <- c(
    paste0("function(con, experimental) {"),
    paste0("  ", code),
    "}"
  )

  # Trailing newline
  paste0(code, "\n", collapse = "")
}

meta_replay_to_fun <- function(text = meta_replay_to_fun_code()) {
  eval(parse(text = text)[[1]])
}

meta_replay_to_fun_file <- function(name) {
  code <- paste0(
    "# Generated by meta_replay_to_fun_file(), do not edit by hand\n", name, " <- ",
    meta_replay_to_fun_code()
  )

  path <- file.path("R", paste0(name, ".R"))

  brio::write_file(code, path)
}

meta_replay_to_file <- function(path, extra = character()) {
  code <- utils::capture.output(meta_replay())
  writeLines(c(extra, code), path)
}

meta_replay_to_new_doc <- function() {
  code <- utils::capture.output(meta_replay())
  rstudioapi::documentNew(code, execute = TRUE)
}

meta_replay_to_reprex <- function(...) {
  code <- utils::capture.output(meta_replay())
  reprex::reprex(input = code, ...)
}

meta_eval <- function() {
  code <- utils::capture.output(meta_replay())
  eval(parse(text = code))
}

meta_macro_register <- function(name) {
  macro <- duckplyr_macros[name]
  if (is.na(macro)) {
    return(invisible())
  }

  if (macro_cache$has(name)) {
    return(invisible())
  }

  macro_expr <- expr(invisible(
    DBI::dbExecute(con, !!paste0('CREATE MACRO "', names(macro), '"', macro))
  ))
  meta_pre_record(constructive::deparse_call(macro_expr))

  macro_cache$set(name, TRUE)
  invisible()
}

meta_df_register <- function(df) {
  if (df_cache$has(df)) {
    return(invisible(df_cache$get(df)))
  }

  count <- df_cache$size()
  name <- sym(paste0("df", count + 1))

  df_expr <- NULL

  if (Sys.getenv("DUCKPLYR_META_GLOBAL") == "TRUE") {
    global_dfs <- mget(ls(.GlobalEnv), .GlobalEnv, mode = "list", ifnotfound = list(NULL))

    for (df_name in names(global_dfs)) {
      global_df <- global_dfs[[df_name]]
      if (identical(df, global_df)) {
        df_expr <- sym(df_name)
        break
      }
    }
  }

  df_cache$set(df, name)

  if (is.null(df_expr)) {
    class(df) <- setdiff(class(df), "duckplyr_df")
    meta_record(constructive::construct_multi(list2(!!name := df)))
  } else {
    # Changes df in-place!
    class(df) <- setdiff(class(df), "duckplyr_df")
    meta_record(constructive::deparse_call(expr(!!name <- !!df_expr)))
  }

  invisible(name)
}

meta_rel_register_df <- function(rel, df) {
  if (Sys.getenv("DUCKPLYR_META_SKIP") == "TRUE") {
    return(invisible())
  }

  df_name <- meta_df_register(df)
  # Expect experimental argument from outside
  rel_expr <- expr(duckdb:::rel_from_df(con, !!df_name, experimental = experimental))
  meta_rel_register(rel, rel_expr)
}

meta_rel_register_csv <- function(rel, path) {
  if (Sys.getenv("DUCKPLYR_META_SKIP") == "TRUE") {
    return(invisible())
  }

  # FIXME

  df_name <- meta_df_register(df)
  # Expect experimental argument from outside
  rel_expr <- expr(duckdb:::rel_from_df(con, !!df_name, experimental = experimental))
  meta_rel_register(rel, rel_expr)
}

meta_rel_register <- function(rel, rel_expr) {
  if (Sys.getenv("DUCKPLYR_META_SKIP") == "TRUE") {
    return(invisible())
  }

  force(rel_expr)

  count <- rel_cache$size()
  name <- sym(paste0("rel", count + 1))

  # https://github.com/cynkra/constructive/issues/102

  meta_record(constructive::deparse_call(expr(!!name <- !!rel_expr)))

  obj <- list(rel = rel, name = name, df = df)
  hash <- deparse(rel)

  rel_cache$set(hash, obj)
  invisible()
}

meta_rel_get <- function(rel) {
  hash <- deparse(rel)

  if (!rel_cache$has(hash)) {
    abort(
      c(
        "duckplyr: internal: hash not found",
        i = paste0("hash: ", hash),
        i = paste0("relation: ", paste(utils::capture.output(print(rel), type = "message"), collapse = "\n"))
      )
    )
  }

  rel_cache$get(hash)
}

new_prom_fun <- function(code) {
  quo <- enquo(code)

  valid <- FALSE
  out <- NULL

  function() {
    if (!valid) {
      out <<- eval_tidy(quo)
      valid <<- TRUE
    }
    out
  }
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr mutate
#' @export
mutate.data.frame <- function(.data, ..., .by = NULL, .keep = c("all", "used", "unused", "none"), .before = NULL, .after = NULL) {
  by_arg <- enquo(.by)
  keep <- arg_match(.keep)

  by_names <- eval_select_by(by_arg, .data)

  # Our implementation
  rel_try(
    {
      rel <- duckdb_rel_from_df(.data)

      if (length(by_names) > 0) {
        rel <- oo_prep(rel)
      }

      dots <- dplyr_quosures(...)
      dots <- fix_auto_name(dots)

      names_used <- character()
      names_new <- character()
      names_out <- rel_names(rel)

      # FIXME: use fewer projections
      for (i in seq_along(dots)) {
        dot <- dots[[i]]

        new <- names(dots)[[i]]

        names_new <- c(names_new, new)

        new_pos <- match(new, names_out, nomatch = length(names_out) + 1L)
        exprs <- imap(set_names(names_out), relexpr_reference, rel = NULL)
        new_expr <- rel_translate(dot, names_data = names_out, alias = new, partition = by_names, need_window = TRUE)
        exprs[[new_pos]] <- new_expr

        rel <- rel_project(rel, unname(exprs))
        names_out[[new_pos]] <- new

        new_names_used <- intersect(attr(new_expr, "used"), names(.data))
        names_used <- c(names_used, setdiff(new_names_used, names_used))
      }

      if (length(by_names) > 0) {
        rel <- oo_restore(rel)
      }

      out <- rel_to_df(rel)

      out <- dplyr_reconstruct(out, .data)

      names_original <- names(.data)

      out <- mutate_relocate(
        out = out,
        before = {{ .before }},
        after = {{ .after }},
        names_original = names_original
      )

      used <- set_names(names(out) %in% names_used, names(out))
      names_groups <- by_names

      out <- duckplyr_mutate_keep(
        out = out,
        keep = keep,
        used = used,
        names_new = names_new,
        names_groups = names_groups
      )

      return(out)
    }
  )

  # dplyr forward
  mutate <- mutate_data_frame
  out <- mutate(.data, ..., .by = {{ .by }}, .keep = .keep, .before = {{ .before }}, .after = {{ .after }})
  return(out)

  # dplyr implementation
  keep <- arg_match0(.keep, values = c("all", "used", "unused", "none"))

  by <- compute_by({{ .by }}, .data, by_arg = ".by", data_arg = ".data")

  cols <- mutate_cols(.data, dplyr_quosures(...), by)
  used <- attr(cols, "used")

  out <- dplyr_col_modify(.data, cols)

  names_original <- names(.data)

  out <- mutate_relocate(
    out = out,
    before = {{ .before }},
    after = {{ .after }},
    names_original = names_original
  )

  names_new <- names(cols)
  names_groups <- by$names

  out <- mutate_keep(
    out = out,
    keep = keep,
    used = used,
    names_new = names_new,
    names_groups = names_groups
  )

  out
}

duckplyr_mutate <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- mutate(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr nest_by
#' @export
nest_by.data.frame <- function(.data, ..., .key = "data", .keep = FALSE) {
  # Our implementation
  rel_try(
    "No relational implementation for nest_by()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  nest_by <- nest_by_data_frame
  out <- nest_by(.data, ..., .key = .key, .keep = .keep)
  return(out)

  # dplyr implementation
  .data <- group_by(.data, ...)
  nest_by.grouped_df(.data, .key = .key, .keep = .keep)
}

duckplyr_nest_by <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- nest_by(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr nest_join
#' @export
nest_join.data.frame <- function(x, y, by = NULL, copy = FALSE, keep = NULL, name = NULL, ..., na_matches = c("na", "never"), unmatched = "drop") {
  # from dplyr implementation
  check_keep(keep)
  na_matches <- check_na_matches(na_matches)

  if (is.null(name)) {
    name <- as_label(enexpr(y))
  } else {
    check_string(name)
  }

  # Our implementation
  rel_try(
    "No relational implementation for nest_join()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  x_df <- x
  class(x_df) <- setdiff(class(x_df), "duckplyr_df")
  y_df <- y
  class(y_df) <- setdiff(class(y_df), "duckplyr_df")
  nest_join <- nest_join_data_frame
  out <- nest_join(x_df, y_df, by, copy, keep, name, ..., na_matches = na_matches, unmatched = unmatched)
  out <- dplyr_reconstruct(out, x)
  return(out)

  # dplyr implementation
  check_dots_empty0(...)
  check_keep(keep)
  na_matches <- check_na_matches(na_matches)

  if (is.null(name)) {
    name <- as_label(enexpr(y))
  } else {
    check_string(name)
  }

  x_names <- tbl_vars(x)
  y_names <- tbl_vars(y)

  if (is_cross_by(by)) {
    warn_join_cross_by()
    by <- new_join_by()
    cross <- TRUE
  } else {
    cross <- FALSE
  }

  if (is_null(by)) {
    by <- join_by_common(x_names, y_names)
  } else {
    by <- as_join_by(by)
  }

  vars <- join_cols(x_names, y_names, by = by, suffix = c("", ""), keep = keep)
  y <- auto_copy(x, y, copy = copy)

  x_in <- as_tibble(x, .name_repair = "minimal")
  y_in <- as_tibble(y, .name_repair = "minimal")

  x_key <- set_names(x_in[vars$x$key], names(vars$x$key))
  y_key <- set_names(y_in[vars$y$key], names(vars$x$key))

  args <- join_cast_common(x_key, y_key, vars)
  x_key <- args$x
  y_key <- args$y

  condition <- by$condition
  filter <- by$filter

  # We always want to retain all of the matches. We never experience a Cartesian
  # explosion because `nrow(x) == nrow(out)` is an invariant of `nest_join()`,
  # and the whole point of `nest_join()` is to nest all of the matches for that
  # row of `x` (#6392).
  multiple <- "all"

  # Will be set to `"none"` in `join_rows()`. Because we can't have a Cartesian
  # explosion, we don't care about many-to-many relationships.
  relationship <- NULL

  rows <- join_rows(
    x_key = x_key,
    y_key = y_key,
    type = "nest",
    na_matches = na_matches,
    condition = condition,
    filter = filter,
    cross = cross,
    multiple = multiple,
    unmatched = unmatched,
    relationship = relationship,
    user_env = caller_env()
  )

  y_loc <- vec_split(rows$y, rows$x)$val

  out <- set_names(x_in[vars$x$out], names(vars$x$out))

  # Modify all columns in one step so that we only need to re-group once
  new_cols <- vec_cast(out[names(x_key)], x_key)

  y_out <- set_names(y_in[vars$y$out], names(vars$y$out))
  y_out <- map(y_loc, vec_slice, x = y_out)
  y_out <- map(y_out, dplyr_reconstruct, template = y)
  new_cols[[name]] <- y_out

  out <- dplyr_col_modify(out, new_cols)
  dplyr_reconstruct(out, x)
}

duckplyr_nest_join <- function(x, y, by = NULL, copy = FALSE, keep = NULL, name = NULL, ...) {
  if (is.null(name)) {
    name <- as_label(enexpr(y))
  } else {
    check_string(name)
  }

  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- nest_join(x, y, by, copy, keep, name, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

oo_force <- function() {
  if (dplyr_mode) {
    return(TRUE)
  }

  if (Sys.getenv("DUCKPLYR_OUTPUT_ORDER") == "TRUE") {
    return(TRUE)
  }

  return(FALSE)
}

oo_prep <- function(rel, colname = "___row_number", force = oo_force()) {
  if (!force) {
    return(rel)
  }

  names <- rel_names(rel)

  if (colname %in% names) {
    abort("Must use column name not yet present in rel")
  }

  proj_exprs <- imap(set_names(names), relexpr_reference, rel = NULL)
  proj_exprs <- c(proj_exprs, list(relexpr_window(
    relexpr_function("row_number", list()),
    partitions = list(),
    alias = colname
  )))

  rel_project(rel, unname(proj_exprs))
}

oo_restore <- function(rel, colname = "___row_number", column_rels = list(NULL)) {
  rel <- oo_restore_order(rel, colname, column_rels)
  oo_restore_cols(rel, colname)
}

oo_restore_order <- function(rel, colname = "___row_number", column_rels = list(NULL), force = oo_force()) {
  if (!force) {
    return(rel)
  }

  order_exprs <- map2(colname, column_rels, relexpr_reference)
  rel_order(rel, order_exprs)
}

oo_restore_cols <- function(rel, colname = "___row_number", extra = NULL, force = oo_force()) {
  if (!force) {
    if (!is.null(extra)) {
      names <- setdiff(rel_names(rel), extra)
      proj_exprs <- imap(set_names(names), relexpr_reference, rel = NULL)
      rel <- rel_project(rel, unname(proj_exprs))
    }

    return(rel)
  }

  names <- setdiff(rel_names(rel), c(colname, extra))
  proj_exprs <- imap(set_names(names), relexpr_reference, rel = NULL)

  rel_project(rel, unname(proj_exprs))
}

#' @export
methods_overwrite <- function() {
  vctrs::s3_register("dplyr::add_count", "data.frame", duckplyr:::add_count.duckplyr_df)
  vctrs::s3_register("dplyr::anti_join", "data.frame", duckplyr:::anti_join.duckplyr_df)
  vctrs::s3_register("dplyr::arrange", "data.frame", duckplyr:::arrange.duckplyr_df)
  vctrs::s3_register("dplyr::auto_copy", "data.frame", duckplyr:::auto_copy.duckplyr_df)
  vctrs::s3_register("dplyr::collect", "data.frame", duckplyr:::collect.duckplyr_df)
  vctrs::s3_register("dplyr::compute", "data.frame", duckplyr:::compute.duckplyr_df)
  vctrs::s3_register("dplyr::count", "data.frame", duckplyr:::count.duckplyr_df)
  vctrs::s3_register("dplyr::cross_join", "data.frame", duckplyr:::cross_join.duckplyr_df)
  vctrs::s3_register("dplyr::distinct", "data.frame", duckplyr:::distinct.duckplyr_df)
  vctrs::s3_register("dplyr::do", "data.frame", duckplyr:::do.duckplyr_df)
  vctrs::s3_register("dplyr::dplyr_reconstruct", "data.frame", duckplyr:::dplyr_reconstruct.duckplyr_df)
  vctrs::s3_register("dplyr::filter", "data.frame", duckplyr:::filter.duckplyr_df)
  vctrs::s3_register("dplyr::full_join", "data.frame", duckplyr:::full_join.duckplyr_df)
  vctrs::s3_register("dplyr::group_vars", "data.frame", duckplyr:::group_vars.duckplyr_df)
  vctrs::s3_register("dplyr::inner_join", "data.frame", duckplyr:::inner_join.duckplyr_df)
  vctrs::s3_register("dplyr::intersect", "data.frame", duckplyr:::intersect.duckplyr_df)
  vctrs::s3_register("dplyr::left_join", "data.frame", duckplyr:::left_join.duckplyr_df)
  vctrs::s3_register("dplyr::mutate", "data.frame", duckplyr:::mutate.duckplyr_df)
  vctrs::s3_register("dplyr::nest_by", "data.frame", duckplyr:::nest_by.duckplyr_df)
  vctrs::s3_register("dplyr::nest_join", "data.frame", duckplyr:::nest_join.duckplyr_df)
  vctrs::s3_register("dplyr::pull", "data.frame", duckplyr:::pull.duckplyr_df)
  vctrs::s3_register("dplyr::reframe", "data.frame", duckplyr:::reframe.duckplyr_df)
  vctrs::s3_register("dplyr::relocate", "data.frame", duckplyr:::relocate.duckplyr_df)
  vctrs::s3_register("dplyr::rename", "data.frame", duckplyr:::rename.duckplyr_df)
  vctrs::s3_register("dplyr::rename_with", "data.frame", duckplyr:::rename_with.duckplyr_df)
  vctrs::s3_register("dplyr::right_join", "data.frame", duckplyr:::right_join.duckplyr_df)
  vctrs::s3_register("dplyr::rows_append", "data.frame", duckplyr:::rows_append.duckplyr_df)
  vctrs::s3_register("dplyr::rows_delete", "data.frame", duckplyr:::rows_delete.duckplyr_df)
  vctrs::s3_register("dplyr::rows_insert", "data.frame", duckplyr:::rows_insert.duckplyr_df)
  vctrs::s3_register("dplyr::rows_patch", "data.frame", duckplyr:::rows_patch.duckplyr_df)
  vctrs::s3_register("dplyr::rows_update", "data.frame", duckplyr:::rows_update.duckplyr_df)
  vctrs::s3_register("dplyr::rows_upsert", "data.frame", duckplyr:::rows_upsert.duckplyr_df)
  vctrs::s3_register("dplyr::sample_frac", "data.frame", duckplyr:::sample_frac.duckplyr_df)
  vctrs::s3_register("dplyr::sample_n", "data.frame", duckplyr:::sample_n.duckplyr_df)
  vctrs::s3_register("dplyr::select", "data.frame", duckplyr:::select.duckplyr_df)
  vctrs::s3_register("dplyr::semi_join", "data.frame", duckplyr:::semi_join.duckplyr_df)
  vctrs::s3_register("dplyr::setdiff", "data.frame", duckplyr:::setdiff.duckplyr_df)
  vctrs::s3_register("dplyr::setequal", "data.frame", duckplyr:::setequal.duckplyr_df)
  vctrs::s3_register("dplyr::slice", "data.frame", duckplyr:::slice.duckplyr_df)
  vctrs::s3_register("dplyr::slice_head", "data.frame", duckplyr:::slice_head.duckplyr_df)
  vctrs::s3_register("dplyr::slice_tail", "data.frame", duckplyr:::slice_tail.duckplyr_df)
  vctrs::s3_register("dplyr::summarise", "data.frame", duckplyr:::summarise.duckplyr_df)
  vctrs::s3_register("dplyr::symdiff", "data.frame", duckplyr:::symdiff.duckplyr_df)
  vctrs::s3_register("dplyr::tbl_vars", "data.frame", duckplyr:::tbl_vars.duckplyr_df)
  vctrs::s3_register("dplyr::transmute", "data.frame", duckplyr:::transmute.duckplyr_df)
  vctrs::s3_register("dplyr::ungroup", "data.frame", duckplyr:::ungroup.duckplyr_df)
  vctrs::s3_register("dplyr::union", "data.frame", duckplyr:::union.duckplyr_df)
  vctrs::s3_register("dplyr::union_all", "data.frame", duckplyr:::union_all.duckplyr_df)
}

exprs_from_loc <- function(.data, loc) {
  nexprs_from_loc(names(.data), loc)
}

nexprs_from_loc <- function(names, loc) {
  stopifnot(is.integer(loc))
  map2(names[loc], names(loc), ~ relexpr_reference(.x, alias = .y))
}

exprs_project <- function(rel, exprs, .data) {
  out_rel <- rel_project(rel, exprs)
  out <- rel_to_df(out_rel)
  dplyr_reconstruct(out, .data)
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr pull
#' @export
pull.data.frame <- function(.data, var = -1, name = NULL, ...) {
  # dplyr implementation
  var <- tidyselect::vars_pull(names(.data), !!enquo(var))
  name <- enquo(name)
  if (!quo_is_null(name)) {
    name <- tidyselect::vars_pull(names(.data), !!name)
    var <- c(name, var)
  }

  loc <- set_names(match(var, names(.data)), var)

  exprs <- exprs_from_loc(.data, loc)

  rel_try(
    "Can't use relational with zero-column result set." = (length(exprs) == 0),
    {
      rel <- duckdb_rel_from_df(.data)
      out_rel <- rel_project(rel, exprs)
      out <- rel_to_df(out_rel)
      out <- tibble::deframe(out)
      return(out)
    }
  )

  # dplyr forward
  pull <- pull_data_frame
  out <- pull(.data, {{ var }}, {{ name }}, ...)
  return(out)

  # dplyr implementation
  var <- tidyselect::vars_pull(names(.data), !!enquo(var))
  name <- enquo(name)
  if (quo_is_null(name)) {
    return(.data[[var]])
  }
  name <- tidyselect::vars_pull(names(.data), !!name)
  set_names(.data[[var]], nm = .data[[name]])
}

duckplyr_pull <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- pull(.data, ...)
  out
}

qloadm <- function(file, envir = caller_env()) {
  data <- qs::qread(file)
  .mapply(assign, list(names(data), data), list(pos = envir))
  invisible()
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr reframe
#' @export
reframe.data.frame <- function(.data, ..., .by = NULL) {
  # Our implementation
  rel_try(
    "No relational implementation for reframe()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  reframe <- reframe_data_frame
  out <- reframe(.data, ..., .by = {{ .by }})
  return(out)

  # dplyr implementation
  by <- compute_by({{ .by }}, .data, by_arg = ".by", data_arg = ".data")

  cols <- summarise_cols(.data, dplyr_quosures(...), by, "reframe")
  out <- summarise_build(by, cols)

  if (!is_tibble(.data)) {
    # The `by` group data we build from is always a tibble,
    # so we have to manually downcast as needed
    out <- as.data.frame(out)
  }

  out
}

duckplyr_reframe <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- reframe(.data, ...)
  out
}

#' @export
wrap_integer <- function(x) {
  .Call(chunkrep_wrap, x)
}

#' @export
wrap_df <- function(df) {
  stopifnot(is.data.frame(df))
  out <- lapply(df, wrap_integer)
  class(out) <- "data.frame"
  .Call(set_row_names, out, wrap_integer(.set_row_names(nrow(df))))
  out
}

#' Data frame relational backend
#'
#' TBD.
#'
#' @param df A data frame.
#' @return A relational object.
#'
#' @export
rel_from_df <- function(df) {
  # FIXME: make generic
  stopifnot(is.data.frame(df))
  new_relational(list(df), class = "relational_df")
}

#' @export
rel_to_df.relational_df <- function(rel, ...) {
  rel[[1L]]
}

#' @export
rel_filter.relational_df <- function(rel, exprs, ...) {
}

#' @export
rel_project.relational_df <- function(rel, exprs, ...) {
}

#' @export
rel_aggregate.relational_df <- function(rel, groups, aggregates, ...) {
}

#' @export
rel_order.relational_df <- function(rel, orders, ...) {
}

#' @export
rel_join.relational_df <- function(left, right, conds, ...) {
}

#' @export
rel_limit.relational_df <- function(rel, n, ...) {
}

#' @export
rel_distinct.relational_df <- function(rel, ...) {
}

#' @export
rel_set_intersect.relational_df <- function(rel_a, rel_b, ...) {
}

#' @export
rel_set_diff.relational_df <- function(rel_a, rel_b, ...) {
}

#' @export
rel_set_symdiff.relational_df <- function(rel_a, rel_b, ...) {
}

#' @export
rel_union_all.relational_df <- function(rel_a, rel_b, ...) {
}


#' @export
rel_tostring.relational_df <- function(rel, ...) {
}

#' @export
rel_explain.relational_df <- function(rel, ...) {
}

#' @export
rel_alias.relational_df <- function(rel, ...) {
}

#' @export
rel_set_alias.relational_df <- function(rel, alias, ...) {
}

#' @export
rel_names.relational_df <- function(rel, ...) {
}

# To be moved to duckdb

# singleton DuckDB instance since we need only one really
# we need a finalizer to disconnect on exit otherwise we get a warning
default_duckdb_connection <- new.env(parent = emptyenv())
get_default_duckdb_connection <- function() {
  if (!exists("con", default_duckdb_connection)) {
    default_duckdb_connection$con <- create_default_duckdb_connection()

    reg.finalizer(default_duckdb_connection, onexit = TRUE, function(e) {
      DBI::dbDisconnect(e$con, shutdown = TRUE)
    })
  }
  default_duckdb_connection$con
}

duckplyr_macros <- c(
  "<" = '(a, b) AS a < b',
  "<=" = '(a, b) AS a <= b',
  ">" = '(a, b) AS a > b',
  ">=" = '(a, b) AS a >= b',
  "==" = '(a, b) AS a = b',
  "!=" = '(a, b) AS a <> b',
  "is.na" = '(a) AS (a IS NULL)',
  "n" = '() AS (COUNT(*))',

  "log10" = '(x) AS log(x)',
  "log" = '(x) AS ln(x)',
  # TPCH
  "as.Date" = '(x) AS strptime(x, \'%Y-%m-%d\')',
  "grepl" = '(pattern, x) AS regexp_matches(x, pattern)',
  "as.integer" = '(x) AS CAST(x AS int32)',
  "ifelse" = '(test, yes, no) AS (CASE WHEN test THEN yes ELSE no END)',
  "|" = '(x, y) AS (x OR y)',
  "&" = '(x, y) AS (x AND y)',
  "!" = '(x) AS (NOT x)',
  "any" = '(x) AS (bool_or(x))',
  "desc" = '(x) AS (-x)',
  "n_distinct" = '(x) AS (COUNT(DISTINCT x))',

  "___eq_na_matches_na" = '(a, b) AS ((a IS NULL AND b IS NULL) OR (a = b))',
  "___coalesce" = '(a, b) AS COALESCE(a, b)',

  NULL
)

create_default_duckdb_connection <- function() {
  con <- DBI::dbConnect(duckdb::duckdb())

  for (i in seq_along(duckplyr_macros)) {
    sql <- paste0('CREATE MACRO "', names(duckplyr_macros)[[i]], '"', duckplyr_macros[[i]])
    DBI::dbExecute(con, sql)
  }

  con
}

#' DuckDB relational backend
#'
#' TBD.
#'
#' @param df A data frame.
#' @return A relational object.
#'
#' @export
duckdb_rel_from_df <- function(df) {
  # FIXME: make generic
  stopifnot(is.data.frame(df))

  tryCatch(
    {
      # duckdb:::df_is_materialized() is broken and unneeded
      return(duckdb:::rel_from_altrep_df(df))
    },
    error = function(e) {}
  )

  # FIXME: Move to duckdb:::rel_from_df()

  if (!is_duckplyr_df(df)) {
    df <- as_duckplyr_df(df)
  }

  if (is.character(.row_names_info(df, 0L))) {
    stop("Need data frame without row names to convert to relational.")
  }

  for (i in seq_along(df)) {
    col <- .subset2(df, i)
    if (!is.null(names(col))) {
      stop("Can't convert named vectors to relational. Affected column: `", names(df)[[i]], "`.")
    }
    if (!is.null(dim(col))) {
      stop("Can't convert arrays or matrices to relational. Affected column: `", names(df)[[i]], "`.")
    }
    if (isS4(col)) {
      stop("Can't convert S4 columns to relational. Affected column: `", names(df)[[i]], "`.")
    }
  }

  # FIXME: For some reason, it's important to create an alias here
  con <- get_default_duckdb_connection()

  # FIXME: For some other reason, it seems crucial to assign the result to a
  # variable before returning it
  experimental <- (Sys.getenv("DUCKPLYR_EXPERIMENTAL") == "TRUE")
  out <- duckdb:::rel_from_df(con, df, experimental = experimental)

  meta_rel_register_df(out, df)

  out

  # Causes protection errors
  # duckdb:::rel_from_df(get_default_duckdb_connection(), df)
}

#' @export
rel_to_df.duckdb_relation <- function(rel, ...) {
  duckdb:::rel_to_altrep(rel)
}

#' @export
rel_filter.duckdb_relation <- function(rel, exprs, ...) {
  duckdb_exprs <- to_duckdb_exprs(exprs)
  out <- duckdb:::rel_filter(rel, duckdb_exprs)

  meta_rel_register(out, expr(duckdb:::rel_filter(
    !!meta_rel_get(rel)$name,
    list(!!!to_duckdb_exprs_meta(exprs))
  )))

  out
}

#' @export
rel_project.duckdb_relation <- function(rel, exprs, ...) {
  duckdb_exprs <- to_duckdb_exprs(exprs)

  out <- duckdb:::rel_project(rel, duckdb_exprs)

  meta_rel_register(out, expr(duckdb:::rel_project(
    !!meta_rel_get(rel)$name,
    list(!!!to_duckdb_exprs_meta(exprs))
  )))

  out
}

#' @export
rel_aggregate.duckdb_relation <- function(rel, groups, aggregates, ...) {
  duckdb_groups <- to_duckdb_exprs(groups)
  duckdb_aggregates <- to_duckdb_exprs(aggregates)

  out <- duckdb:::rel_aggregate(
    rel,
    groups = duckdb_groups,
    aggregates = duckdb_aggregates
  )

  meta_rel_register(out, expr(duckdb:::rel_aggregate(
    !!meta_rel_get(rel)$name,
    groups = list(!!!to_duckdb_exprs_meta(groups)),
    aggregates = list(!!!to_duckdb_exprs_meta(aggregates))
  )))

  out
}

#' @export
rel_order.duckdb_relation <- function(rel, orders, ...) {
  duckdb_orders <- to_duckdb_exprs(orders)

  out <- duckdb:::rel_order(rel, duckdb_orders)

  meta_rel_register(out, expr(duckdb:::rel_order(
    !!meta_rel_get(rel)$name,
    list(!!!to_duckdb_exprs_meta(orders))
  )))

  out
}

#' @export
rel_join.duckdb_relation <- function(left, right, conds, join, join_ref_type, ...) {
  duckdb_conds <- to_duckdb_exprs(conds)
  if (join == "full") {
    join <- "outer"
  }

  out <- duckdb:::rel_join(left, right, duckdb_conds, join, join_ref_type)

  meta_rel_register(out, expr(duckdb:::rel_join(
    !!meta_rel_get(left)$name,
    !!meta_rel_get(right)$name,
    list(!!!to_duckdb_exprs_meta(conds)),
    !!join,
    !!join_ref_type
  )))

  out
}

#' @export
rel_limit.duckdb_relation <- function(rel, n, ...) {
  out <- duckdb:::rel_limit(rel, n)

  meta_rel_register(out, expr(duckdb:::rel_limit(
    !!meta_rel_get(rel)$name,
    !!n
  )))

  out
}

#' @export
rel_distinct.duckdb_relation <- function(rel, ...) {
  out <- duckdb:::rel_distinct(rel)

  meta_rel_register(out, expr(duckdb:::rel_distinct(
    !!meta_rel_get(rel)$name
  )))

  out
}

#' @export
rel_set_intersect.duckdb_relation <- function(rel_a, rel_b, ...) {
  out <- duckdb:::rel_set_intersect(rel_a, rel_b)

  meta_rel_register(out, expr(duckdb:::rel_set_intersect(
    !!meta_rel_get(rel_a)$name,
    !!meta_rel_get(rel_b)$name
  )))

  out
}

#' @export
rel_set_diff.duckdb_relation <- function(rel_a, rel_b, ...) {
  out <- duckdb:::rel_set_diff(rel_a, rel_b)

  meta_rel_register(out, expr(duckdb:::rel_set_diff(
    !!meta_rel_get(rel_a)$name,
    !!meta_rel_get(rel_b)$name
  )))

  out
}

#' @export
rel_set_symdiff.duckdb_relation <- function(rel_a, rel_b, ...) {
  out <- duckdb:::rel_set_symdiff(rel_a, rel_b)

  meta_rel_register(out, expr(duckdb:::rel_set_symdiff(
    !!meta_rel_get(rel_a)$name,
    !!meta_rel_get(rel_b)$name
  )))

  out
}

#' @export
rel_union_all.duckdb_relation <- function(rel_a, rel_b, ...) {
  out <- duckdb:::rel_union_all(rel_a, rel_b)

  meta_rel_register(out, expr(duckdb:::rel_union_all(
    !!meta_rel_get(rel_a)$name,
    !!meta_rel_get(rel_b)$name
  )))

  out
}

#' @export
rel_tostring.duckdb_relation <- function(rel, ...) {
}

#' @export
rel_explain.duckdb_relation <- function(rel, ...) {
  duckdb:::rel_explain(rel)
}

#' @export
rel_alias.duckdb_relation <- function(rel, ...) {
}

#' @export
rel_set_alias.duckdb_relation <- function(rel, alias, ...) {
  out <- duckdb:::rel_set_alias(rel, alias)

  meta_rel_register(out, expr(duckdb:::rel_set_alias(
    !!meta_rel_get(rel)$name,
    !!alias
  )))

  out
}

#' @export
rel_names.duckdb_relation <- function(rel, ...) {
  duckdb:::rapi_rel_names(rel)
}

to_duckdb_exprs <- function(exprs) {
  lapply(exprs, to_duckdb_expr)
}

to_duckdb_expr <- function(x) {
  switch(class(x)[[1]],
    relational_relexpr_reference = {
      out <- duckdb:::expr_reference(x$name, if (is.null(x$rel)) "" else x$rel)
      if (!is.null(x$alias)) {
        duckdb:::expr_set_alias(out, x$alias)
      }
      out
    },
    relational_relexpr_function = {
      out <- duckdb:::expr_function(x$name, to_duckdb_exprs(x$args))
      if (!is.null(x$alias)) {
        duckdb:::expr_set_alias(out, x$alias)
      }
      out
    },
    relational_relexpr_window = {
      out <- duckdb:::expr_window(
        to_duckdb_expr(x$expr),
        to_duckdb_exprs(x$partitions),
        to_duckdb_exprs(x$order_bys),
        offset_expr = to_duckdb_expr(x$offset_expr),
        default_expr = to_duckdb_expr(x$default_expr)
      )
      if (!is.null(x$alias)) {
        duckdb:::expr_set_alias(out, x$alias)
      }
      out
    },
    relational_relexpr_constant = {
      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
        experimental <- (Sys.getenv("DUCKPLYR_EXPERIMENTAL") == "TRUE")
        out <- duckdb:::expr_constant(x$val, experimental = experimental)
      } else {
        out <- duckdb:::expr_constant(x$val)
      }
      if (!is.null(x$alias)) {
        duckdb:::expr_set_alias(out, x$alias)
      }
      out
    },
    NULL = NULL,
    stop("Unknown expr class: ", class(x)[[1]])
  )
}

to_duckdb_exprs_meta <- function(exprs) {
  lapply(exprs, to_duckdb_expr_meta)
}

to_duckdb_expr_meta <- function(x) {
  switch(class(x)[[1]],
    relational_relexpr_reference = {
      args <- list(x$name)
      if (!is.null(x$rel)) {
        args <- c(args, meta_rel_get(x$rel)$name)
      }
      out <- expr(duckdb:::expr_reference(!!!args))
      if (!is.null(x$alias)) {
        out <- expr({
          tmp_expr <- !!out
          duckdb:::expr_set_alias(tmp_expr, !!x$alias)
          tmp_expr
        })
      }
      out
    },
    relational_relexpr_function = {
      meta_macro_register(x$name)
      out <- expr(duckdb:::expr_function(!!x$name, list(!!!to_duckdb_exprs_meta(x$args))))
      if (!is.null(x$alias)) {
        out <- expr({
          tmp_expr <- !!out
          duckdb:::expr_set_alias(tmp_expr, !!x$alias)
          tmp_expr
        })
      }
      out
    },
    relational_relexpr_window = {
      out <- expr(duckdb:::expr_window(
        !!to_duckdb_expr_meta(x$expr),
        list(!!!to_duckdb_exprs_meta(x$partitions)),
        list(!!!to_duckdb_exprs_meta(x$order_bys)),
        offset_expr = !!to_duckdb_expr_meta(x$offset_expr),
        default_expr = !!to_duckdb_expr_meta(x$default_expr)
      ))
      if (!is.null(x$alias)) {
        out <- expr({
          tmp_expr <- !!out
          duckdb:::expr_set_alias(tmp_expr, !!x$alias)
          tmp_expr
        })
      }
      out
    },
    relational_relexpr_constant = {
      out <- expr(
        # FIXME: always pass experimental flag once it's merged
        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(!!x$val, experimental = experimental)
        } else {
          duckdb:::expr_constant(!!x$val)
        }
      )

      if (!is.null(x$alias)) {
        out <- expr({
          tmp_expr <- !!out
          duckdb:::expr_set_alias(tmp_expr, !!x$alias)
          tmp_expr
        })
      }
      out
    },
    NULL = expr(NULL),
    stop("Unknown expr class: ", class(x)[[1]])
  )
}

#' Relational expressions
#'
#' TBD.
#'
#' @param x An object.
#' @param class Classes added in front of the `"relational_relexpr"` base class.
#'
#' @name expr
#' @export
new_relexpr <- function(x, class = NULL) {
  structure(x, class = unique(c(class, "relational_relexpr")))
}

#' @param name The name of the column or function to reference.
#' @param rel The name of the relation to reference.
#' @param alias An alias for the new expression.
#' @rdname expr
#' @export
relexpr_reference <- function(name, rel = NULL, alias = NULL) {
  stopifnot(is_string(name))
  stopifnot(is.null(rel) || inherits(rel, "duckdb_relation"))
  stopifnot(is.null(alias) || is_string(alias))
  new_relexpr(list(name = name, rel = rel, alias = alias), class = "relational_relexpr_reference")
}

#' @param val The value to use in the constant expression.
#' @rdname expr
#' @export
relexpr_constant <- function(val, alias = NULL) {
  stopifnot(length(val) == 1)
  stopifnot(is.null(alias) || is_string(alias))
  new_relexpr(list(val = val, alias = alias), class = "relational_relexpr_constant")
}

#' @param args Function arguments, a list of `expr` objects.
#' @rdname expr
#' @export
relexpr_function <- function(name, args, alias = NULL) {
  stopifnot(is_string(name))
  stopifnot(is.list(args))
  stopifnot(is.null(alias) || is_string(alias))
  new_relexpr(list(name = name, args = args, alias = alias), class = "relational_relexpr_function")
}

#' @param partitions Partitions, a list of `expr` objects.
#' @param order_bys which variables to order results by (list).
#' @param offset_expr offset relational expression.
#' @param default_expr default relational expression.
#' @rdname expr
#' @export
relexpr_window <- function(
    expr,
    partitions,
    order_bys = list(),
    offset_expr = NULL,
    default_expr = NULL,
    alias = NULL
) {
  stopifnot(inherits(expr, "relational_relexpr"))
  stopifnot(is.list(partitions))
  stopifnot(is.list(order_bys))
  stopifnot(is.null(offset_expr) || inherits(offset_expr, "relational_relexpr"))
  stopifnot(is.null(default_expr) || inherits(default_expr, "relational_relexpr"))
  stopifnot(is.null(alias) || is_string(alias))
  new_relexpr(
    list(
      expr = expr,
      partitions = partitions,
      order_bys = order_bys,
      offset_expr = offset_expr,
      default_expr = default_expr,
      alias = alias
    ),
    class = "relational_relexpr_window"
  )
}

#' @param expr An `expr` object.
#' @rdname expr
#' @export
relexpr_set_alias <- function(expr, alias = NULL) {
  stopifnot(inherits(expr, "relational_relexpr"))
  stopifnot(is.null(alias) || is_string(alias))
  expr$alias <- alias
  expr
}

#' @export
print.relational_relexpr <- function(x, ...) {
  writeLines(format(x, ...))
}

#' @export
format.relational_relexpr <- function(x, ...) {
  # FIXME: Use home-grown code
  utils::capture.output(print(constructive::construct(x)))
}

rel_stats_env <- new.env(parent = emptyenv(), size = 937L)

rel_stats_clean <- function() {
  rm(list = ls(rel_stats_env, all.names = TRUE), pos = rel_stats_env)
}

rel_stats_get <- function() {
  arrange(tibble::enframe(unlist(as.list(rel_stats_env)), "fun", "count"), desc(count))
}

#' Relational API
#'
#' TBD.
#'
#' @param ... Passed on to [structure()]
#' @param class Classes added in front of the `"relational"` base class
#'
#' @export
new_relational <- function(..., class = NULL) {
  structure(..., class = unique(c(class, "relational")))
}

#' Convert a relation object to a data frame
#'
#' TBD.
#'
#' @param rel The relation object.
#' @param ... Reserved for future extensions, must be empty.
#' @return A data frame.
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_filter(
#'   rel,
#'   list(
#'     relexpr_function(
#'       "gt",
#'       list(relexpr_reference("cyl"), relexpr_constant("6"))
#'    )
#'   )
#'  )
rel_to_df <- function(rel, ...) {
  rel_stats_env$rel_to_df <- (rel_stats_env$rel_to_df %||% 0L) + 1L
  UseMethod("rel_to_df")
}

#' Lazily filter a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @param exprs a list of DuckDB expressions to filter by
#' @return the now filtered relation object
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_filter(
#'   rel,
#'   list(
#'     relexpr_function(
#'       "gt",
#'       list(relexpr_reference("cyl"), relexpr_constant("6")))
#'   )
#' )
rel_filter <- function(rel, exprs, ...) {
  rel_stats_env$rel_filter <- (rel_stats_env$rel_filter %||% 0L) + 1L
  UseMethod("rel_filter")
}

#' Lazily project a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @param exprs a list of DuckDB expressions to project
#' @return the now projected relation object
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_project(rel, list(relexpr_reference("cyl"), relexpr_reference("disp")))
rel_project <- function(rel, exprs, ...) {
  rel_stats_env$rel_project <- (rel_stats_env$rel_project %||% 0L) + 1L
  UseMethod("rel_project")
}

#' Lazily aggregate a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @param groups a list of DuckDB expressions to group by
#' @param aggregates a (optionally named) list of DuckDB expressions with aggregates to compute
#' @return the now aggregated relation object
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' aggrs <- list(avg_hp = relexpr_function("avg", list(relexpr_reference("hp"))))
#' rel2 <- rel_aggregate(rel, list(relexpr_reference("cyl")), aggrs)
rel_aggregate <- function(rel, groups, aggregates, ...) {
  rel_stats_env$rel_aggregate <- (rel_stats_env$rel_aggregate %||% 0L) + 1L
  UseMethod("rel_aggregate")
}

#' Lazily reorder a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @param orders a list of DuckDB expressions to order by
#' @return the now aggregated relation object
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_order(rel, list(relexpr_reference("hp")))
rel_order <- function(rel, orders, ...) {
  rel_stats_env$rel_order <- (rel_stats_env$rel_order %||% 0L) + 1L
  UseMethod("rel_order")
}

#' Lazily INNER join two relation objects
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @param left the left-hand-side relation object
#' @param right the right-hand-side relation object
#' @param conds a list of DuckDB expressions to use for the join
#' @param join type of join
#' @return a new relation object resulting from the join
#' @export
#' @examples
#' \dontrun{
#' left <- rel_from_df(mtcars)
#' right <- rel_from_df(mtcars)
#' cond <- list(
#'   relexpr_function(
#'     "eq",
#'     list(relexpr_reference("cyl", left), relexpr_reference("cyl", right))
#'   )
#' )
#' rel2 <- rel_join(left, right, cond)
#' }
rel_join <- function(left,
                     right,
                     conds,
                     join = c("inner", "left", "right", "outer", "cross", "semi", "anti"),
                     join_ref_type = c("regular", "natural", "cross", "positional", "asof"),
                     ...) {
  rel_stats_env$rel_join <- (rel_stats_env$rel_join %||% 0L) + 1L
  UseMethod("rel_join")
}

#' Lazily limit the rows in a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @param n The number of rows.
#' @export
rel_limit <- function(rel, n, ...) {
  rel_stats_env$rel_limit <- (rel_stats_env$rel_limit %||% 0L) + 1L
  UseMethod("rel_limit")
}

#' Lazily compute a distinct result on a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @return a new relation object with distinct rows
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_distinct(rel)
rel_distinct <- function(rel, ...) {
  rel_stats_env$rel_distinct <- (rel_stats_env$rel_distinct %||% 0L) + 1L
  UseMethod("rel_distinct")
}

#' Lazily compute a set_intersect result on a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @inheritParams rel_set_diff
#' @return a new relation object with the result
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_set_intersect(rel)
rel_set_intersect <- function(rel_a, rel_b, ...) {
  rel_stats_env$rel_set_intersect <- (rel_stats_env$rel_set_intersect %||% 0L) + 1L
  UseMethod("rel_set_intersect")
}

#' Lazily compute a set_diff result on a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @param rel_a a DuckDB relation object
#' @param rel_b a DuckDB relation object
#' @return a new relation object with the result
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_set_diff(rel)
rel_set_diff <- function(rel_a, rel_b, ...) {
  rel_stats_env$rel_set_diff <- (rel_stats_env$rel_set_diff %||% 0L) + 1L
  UseMethod("rel_set_diff")
}

#' Lazily compute a set_symdiff result on a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @inheritParams rel_set_diff
#' @return a new relation object with the result
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_set_symdiff(rel)
rel_set_symdiff <- function(rel_a, rel_b, ...) {
  rel_stats_env$rel_set_symdiff <- (rel_stats_env$rel_set_symdiff %||% 0L) + 1L
  UseMethod("rel_set_symdiff")
}

#' Lazily compute a set_union_all result on a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @inheritParams rel_set_diff
#' @return a new relation object with the result
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel2 <- rel_union_all(rel)
rel_union_all <- function(rel_a, rel_b, ...) {
  rel_stats_env$rel_union_all <- (rel_stats_env$rel_union_all %||% 0L) + 1L
  UseMethod("rel_union_all")
}

#' TBD
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @rdname rel
#' @export
rel_tostring <- function(rel, ...) {
  rel_stats_env$rel_tostring <- (rel_stats_env$rel_tostring %||% 0L) + 1L
  UseMethod("rel_tostring")
}

#' Print the EXPLAIN output for a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel_explain(rel)
rel_explain <- function(rel, ...) {
  rel_stats_env$rel_explain <- (rel_stats_env$rel_explain %||% 0L) + 1L
  UseMethod("rel_explain")
}

#' Get the internal alias for a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel_alias(rel)
rel_alias <- function(rel, ...) {
  rel_stats_env$rel_alias <- (rel_stats_env$rel_alias %||% 0L) + 1L
  UseMethod("rel_alias")
}

#' Set the internal alias for a relation object
#'
#' TBD.
#'
#' @inheritParams rel_to_df
#' @param alias the new alias
#' @export
#' @examples
#' rel <- rel_from_df(mtcars)
#' rel_set_alias(rel, "my_new_alias")
rel_set_alias <- function(rel, alias, ...) {
  rel_stats_env$rel_set_alias <- (rel_stats_env$rel_set_alias %||% 0L) + 1L
  UseMethod("rel_set_alias")
}

#' @rdname rel
#' @export
rel_names <- function(rel, ...) {
  rel_stats_env$rel_names <- (rel_stats_env$rel_names %||% 0L) + 1L
  UseMethod("rel_names")
}

rel_try <- function(rel, ...) {
  call <- as.character(sys.call(-1)[[1]])

  if (!(list(call) %in% stats$calls)) {
    stats$calls <- c(stats$calls, call)
  }

  stats$attempts <- stats$attempts + 1L

  dots <- list(...)
  for (i in seq_along(dots)) {
    if (dots[[i]]) {
      stats$fallback <- stats$fallback + 1L
      if (!dplyr_mode) {
        if (!identical(Sys.getenv("TESTTHAT"), "true")) {
          inform(message = c("Requested fallback for relational:", i = names(dots)[[i]]))
        }
        if (Sys.getenv("DUCKPLYR_FORCE") == "TRUE") {
          abort("Fallback not available with DUCKPLYR_FORCE")
        }
      }

      return()
    }
  }

  if (Sys.getenv("DUCKPLYR_FORCE") == "TRUE") {
    return(rel)
  }

  out <- rlang::try_fetch(rel, error = identity)
  if (inherits(out, "error")) {
    # FIXME: enable always
    if (!dplyr_mode && !identical(Sys.getenv("TESTTHAT"), "true")) {
      rlang::cnd_signal(rlang::message_cnd(message = "Error processing with relational.", parent = out))
    }
    stats$fallback <- stats$fallback + 1L
    return()
  }

  # Never reached due to return() in code
  stop("Must use a return() in rel_try().")
}

rel_translate_dots <- function(dots, data) {
  if (is.null(names(dots))) {
    map(dots, rel_translate, data)
  } else {
    imap(dots, rel_translate, data = data)
  }
}

rel_translate <- function(
    quo, data,
    alias = NULL,
    partition = NULL,
    need_window = FALSE,
    names_data = names(data)
) {
  env <- quo_get_env(quo)

  used <- character()

  do_translate <- function(expr, in_window = FALSE) {
    if (is_quosure(expr)) {
      # FIXME: What to do with the environment here?
      expr <- quo_get_expr(expr)
    }

    switch(typeof(expr),
      character = ,
      logical = ,
      integer = ,
      double = relexpr_constant(expr),
      #
      symbol = {
        if (as.character(expr) %in% names_data) {
          ref <- as.character(expr)
          if (!(ref %in% used)) {
            used <<- c(used, ref)
          }
          relexpr_reference(ref)
        } else {
          val <- eval_tidy(expr, env = env)
          relexpr_constant(val)
        }
      },
      #
      language = {
        switch(as.character(expr[[1]]),
          "(" = {
            return(do_translate(expr[[2]], in_window = in_window))
          },
          "%in%" = {
            tryCatch(
              {
                values <- eval(expr[[3]], envir = baseenv())
                consts <- map(values, do_translate, in_window = in_window)
                ops <- map(consts, list, do_translate(expr[[2]]))
                cmp <- map(ops, relexpr_function, name = "==")
                alt <- reduce(cmp, ~ relexpr_function("|", list(.x, .y)))
                return(alt)
              },
              error = identity
            )
          }
        )

        name <- as.character(expr[[1]])

        aliases <- c(
          sd = "stddev",
          first = "first_value",
          last = "last_value",
          nth = "nth_value",
          NULL
        )

        if (name %in% names(aliases)) {
          name <- aliases[[name]]
        }
        # name <- aliases[name] %|% name

        window <- need_window && (name %in% c(
          # Window functions
          "rank", "rank_dense", "dense_rank", "percent_rank",
          "row_number", "first_value", "last_value", "nth_value",
          "cume_dist", "lead", "lag", "ntile",

          # Aggregates
          "sum", "mean", "stddev", "min", "max",

          NULL
        ))

        order_bys <- list()
        offset_expr <- NULL
        default_expr <- NULL
        if (name %in% c("lag", "lead")) {
          # x, n = 1L, default = NULL, order_by = NULL
          expr <- match.call(lag, expr)

          offset_expr <- relexpr_constant(expr$n %||% 1L)
          expr$n <- NULL

          if (!is.null(expr$default)) {
            default_expr <- do_translate(expr$default, in_window = TRUE)
            expr$default <- NULL
          }

          if (!is.null(expr$order_by)) {
            order_bys <- list(do_translate(expr$order_by, in_window = TRUE))
            expr$order_by <- NULL
          }
        }

        args <- map(as.list(expr[-1]), do_translate, in_window = in_window || window)
        fun <- relexpr_function(name, args)
        if (window) {
          partitions <- map(partition, relexpr_reference)
          fun <- relexpr_window(
            fun,
            partitions,
            order_bys,
            offset_expr = offset_expr,
            default_expr = default_expr
          )
        }
        fun
      },
      #
      abort(paste0("Internal: Unknown type ", typeof(expr)))
    )
  }

  out <- do_translate(quo_get_expr(quo))

  if (!is.null(alias) && !identical(alias, "")) {
    out <- relexpr_set_alias(out, alias)
  }

  structure(out, used = used)
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr relocate
#' @export
relocate.data.frame <- function(.data, ..., .before = NULL, .after = NULL) {
  loc <- eval_relocate(
    expr = expr(c(...)),
    data = .data,
    before = enquo(.before),
    after = enquo(.after),
    before_arg = ".before",
    after_arg = ".after"
  )

  exprs <- exprs_from_loc(.data, loc)

  # Ensure `relocate()` appears in call stack
  rel_try(
    "Can't use relational with zero-column result set." = (length(exprs) == 0),
    {
      rel <- duckdb_rel_from_df(.data)
      out <- exprs_project(rel, exprs, .data)
      return(out)
    }
  )

  # dplyr forward
  relocate <- relocate_data_frame
  out <- relocate(.data, ..., .before = {{ .before }}, .after = {{ .after }})
  return(out)

  # dplyr implementation
  loc <- eval_relocate(
    expr = expr(c(...)),
    data = .data,
    before = enquo(.before),
    after = enquo(.after),
    before_arg = ".before",
    after_arg = ".after"
  )

  out <- dplyr_col_select(.data, loc)
  out <- set_names(out, names(loc))

  out
}

duckplyr_relocate <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- relocate(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr rename
#' @export
rename.data.frame <- function(.data, ...) {
  loc <- tidyselect::eval_rename(expr(c(...)), .data)
  dupes <- duplicated(loc, fromLast = TRUE)
  loc <- loc[!dupes]

  # eval_rename() only returns changes
  proj <- rlang::set_names(seq_along(.data), names(.data))
  names(proj)[loc] <- names(loc)

  exprs <- exprs_from_loc(.data, proj)

  rel_try(
    "Can't use relational with zero-column result set." = (length(exprs) == 0),
    {
      rel <- duckdb_rel_from_df(.data)
      out <- exprs_project(rel, exprs, .data)
      return(out)
    }
  )

  # dplyr forward
  rename <- rename_data_frame
  out <- rename(.data, ...)
  return(out)

  # dplyr implementation
  loc <- tidyselect::eval_rename(expr(c(...)), .data)
  # eval_rename() only returns changes
  names <- names(.data)
  names[loc] <- names(loc)

  set_names(.data, names)
}

duckplyr_rename <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- rename(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr rename_with
#' @export
rename_with.data.frame <- function(.data, .fn, .cols = everything(), ...) {
  # Our implementation
  rel_try(
    "No relational implementation for rename_with()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  rename_with <- rename_with_data_frame
  out <- rename_with(.data, .fn, {{ .cols }}, ...)
  return(out)

  # dplyr implementation
  .fn <- as_function(.fn)
  cols <- tidyselect::eval_select(enquo(.cols), .data, allow_rename = FALSE)

  names <- names(.data)

  sel <- vec_slice(names, cols)
  new <- .fn(sel, ...)

  if (!is_character(new)) {
    cli::cli_abort(
      "{.arg .fn} must return a character vector, not {.obj_type_friendly {new}}."
    )
  }
  if (length(new) != length(sel)) {
    cli::cli_abort(
      "{.arg .fn} must return a vector of length {length(sel)}, not {length(new)}."
    )
  }

  names <- vec_assign(names, cols, new)
  names <- vec_as_names(names, repair = "check_unique")

  set_names(.data, names)
}

duckplyr_rename_with <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- rename_with(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

#' @export
methods_restore <- function() {
  vctrs::s3_register("dplyr::add_count", "data.frame", add_count_data_frame)
  vctrs::s3_register("dplyr::anti_join", "data.frame", anti_join_data_frame)
  vctrs::s3_register("dplyr::arrange", "data.frame", arrange_data_frame)
  vctrs::s3_register("dplyr::auto_copy", "data.frame", auto_copy_data_frame)
  vctrs::s3_register("dplyr::collect", "data.frame", collect_data_frame)
  vctrs::s3_register("dplyr::compute", "data.frame", compute_data_frame)
  vctrs::s3_register("dplyr::count", "data.frame", count_data_frame)
  vctrs::s3_register("dplyr::cross_join", "data.frame", cross_join_data_frame)
  vctrs::s3_register("dplyr::distinct", "data.frame", distinct_data_frame)
  vctrs::s3_register("dplyr::do", "data.frame", do_data_frame)
  vctrs::s3_register("dplyr::dplyr_reconstruct", "data.frame", dplyr_reconstruct_data_frame)
  vctrs::s3_register("dplyr::filter", "data.frame", filter_data_frame)
  vctrs::s3_register("dplyr::full_join", "data.frame", full_join_data_frame)
  vctrs::s3_register("dplyr::group_vars", "data.frame", group_vars_data_frame)
  vctrs::s3_register("dplyr::inner_join", "data.frame", inner_join_data_frame)
  vctrs::s3_register("dplyr::intersect", "data.frame", intersect_data_frame)
  vctrs::s3_register("dplyr::left_join", "data.frame", left_join_data_frame)
  vctrs::s3_register("dplyr::mutate", "data.frame", mutate_data_frame)
  vctrs::s3_register("dplyr::nest_by", "data.frame", nest_by_data_frame)
  vctrs::s3_register("dplyr::nest_join", "data.frame", nest_join_data_frame)
  vctrs::s3_register("dplyr::pull", "data.frame", pull_data_frame)
  vctrs::s3_register("dplyr::reframe", "data.frame", reframe_data_frame)
  vctrs::s3_register("dplyr::relocate", "data.frame", relocate_data_frame)
  vctrs::s3_register("dplyr::rename", "data.frame", rename_data_frame)
  vctrs::s3_register("dplyr::rename_with", "data.frame", rename_with_data_frame)
  vctrs::s3_register("dplyr::right_join", "data.frame", right_join_data_frame)
  vctrs::s3_register("dplyr::rows_append", "data.frame", rows_append_data_frame)
  vctrs::s3_register("dplyr::rows_delete", "data.frame", rows_delete_data_frame)
  vctrs::s3_register("dplyr::rows_insert", "data.frame", rows_insert_data_frame)
  vctrs::s3_register("dplyr::rows_patch", "data.frame", rows_patch_data_frame)
  vctrs::s3_register("dplyr::rows_update", "data.frame", rows_update_data_frame)
  vctrs::s3_register("dplyr::rows_upsert", "data.frame", rows_upsert_data_frame)
  vctrs::s3_register("dplyr::sample_frac", "data.frame", sample_frac_data_frame)
  vctrs::s3_register("dplyr::sample_n", "data.frame", sample_n_data_frame)
  vctrs::s3_register("dplyr::select", "data.frame", select_data_frame)
  vctrs::s3_register("dplyr::semi_join", "data.frame", semi_join_data_frame)
  vctrs::s3_register("dplyr::setdiff", "data.frame", setdiff_data_frame)
  vctrs::s3_register("dplyr::setequal", "data.frame", setequal_data_frame)
  vctrs::s3_register("dplyr::slice", "data.frame", slice_data_frame)
  vctrs::s3_register("dplyr::slice_head", "data.frame", slice_head_data_frame)
  vctrs::s3_register("dplyr::slice_tail", "data.frame", slice_tail_data_frame)
  vctrs::s3_register("dplyr::summarise", "data.frame", summarise_data_frame)
  vctrs::s3_register("dplyr::symdiff", "data.frame", symdiff_data_frame)
  vctrs::s3_register("dplyr::tbl_vars", "data.frame", tbl_vars_data_frame)
  vctrs::s3_register("dplyr::transmute", "data.frame", transmute_data_frame)
  vctrs::s3_register("dplyr::ungroup", "data.frame", ungroup_data_frame)
  vctrs::s3_register("dplyr::union", "data.frame", union_data_frame)
  vctrs::s3_register("dplyr::union_all", "data.frame", union_all_data_frame)
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr right_join
#' @export
right_join.data.frame <- function(x, y, by = NULL, copy = FALSE, suffix = c(".x", ".y"), ..., keep = NULL, na_matches = c("na", "never"), multiple = "all", unmatched = "drop", relationship = NULL) {
  check_dots_empty0(...)
  error_call <- caller_env()

  # Our implementation
  rel_try(
    "No implicit cross joins for right_join()" = is_cross_by(by),
    "No relational implementation for right_join(copy = TRUE)" = copy,
    {
      out <- rel_join_impl(x, y, by, "right", na_matches, suffix, keep, error_call)
      return(out)
    }
  )

  # dplyr forward
  right_join <- right_join_data_frame
  out <- right_join(x, y, by, copy, suffix, ..., keep = keep, na_matches = na_matches, multiple = multiple, unmatched = unmatched, relationship = relationship)
  return(out)

  # dplyr implementation
  check_dots_empty0(...)
  y <- auto_copy(x, y, copy = copy)
  join_mutate(
    x = x,
    y = y,
    by = by,
    type = "right",
    suffix = suffix,
    na_matches = na_matches,
    keep = keep,
    multiple = multiple,
    unmatched = unmatched,
    relationship = relationship,
    user_env = caller_env()
  )
}

duckplyr_right_join <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- right_join(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr rows_append
#' @export
rows_append.data.frame <- function(x, y, ..., copy = FALSE, in_place = FALSE) {
  # Our implementation
  rel_try(
    "No relational implementation for rows_append()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  rows_append <- rows_append_data_frame
  out <- rows_append(x, y, ..., copy = copy, in_place = in_place)
  return(out)

  # dplyr implementation
  check_dots_empty()
  rows_df_in_place(in_place)

  y <- auto_copy(x, y, copy = copy)

  rows_check_x_contains_y(x, y)
  y <- rows_cast_y(y, x)

  rows_bind(x, y)
}

duckplyr_rows_append <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- rows_append(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr rows_delete
#' @export
rows_delete.data.frame <- function(x, y, by = NULL, ..., unmatched = c("error", "ignore"), copy = FALSE, in_place = FALSE) {
  # Our implementation
  rel_try(
    "No relational implementation for rows_delete()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  rows_delete <- rows_delete_data_frame
  out <- rows_delete(x, y, by, ..., unmatched = unmatched, copy = copy, in_place = in_place)
  return(out)

  # dplyr implementation
  check_dots_empty()
  rows_df_in_place(in_place)

  y <- auto_copy(x, y, copy = copy)

  by <- rows_check_by(by, y)

  rows_check_contains_by(x, by, "x")
  rows_check_contains_by(y, by, "y")

  x_key <- dplyr_col_select(x, by)
  y_key <- dplyr_col_select(y, by)

  args <- vec_cast_common(x = x_key, y = y_key)
  x_key <- args$x
  y_key <- args$y

  keep <- rows_check_y_unmatched(x_key, y_key, unmatched)

  if (!is.null(keep)) {
    y_key <- dplyr_row_slice(y_key, keep)
  }

  extra <- setdiff(names(y), names(y_key))
  if (!is_empty(extra)) {
    message <- glue("Ignoring extra `y` columns: ", commas(tick_if_needed(extra)))
    inform(message, class = c("dplyr_message_delete_extra_cols", "dplyr_message"))
  }

  loc <- vec_match(x_key, y_key)
  unmatched <- is.na(loc)

  x_loc <- which(unmatched)

  dplyr_row_slice(x, x_loc)
}

duckplyr_rows_delete <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- rows_delete(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr rows_insert
#' @export
rows_insert.data.frame <- function(x, y, by = NULL, ..., conflict = c("error", "ignore"), copy = FALSE, in_place = FALSE) {
  # Our implementation
  rel_try(
    "No relational implementation for rows_insert()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  rows_insert <- rows_insert_data_frame
  out <- rows_insert(x, y, by, ..., conflict = conflict, copy = copy, in_place = in_place)
  return(out)

  # dplyr implementation
  check_dots_empty()
  rows_df_in_place(in_place)

  y <- auto_copy(x, y, copy = copy)

  by <- rows_check_by(by, y)

  rows_check_x_contains_y(x, y)
  rows_check_contains_by(x, by, "x")
  rows_check_contains_by(y, by, "y")

  y <- rows_cast_y(y, x)

  x_key <- dplyr_col_select(x, by)
  y_key <- dplyr_col_select(y, by)

  keep <- rows_check_y_conflict(x_key, y_key, conflict)

  if (!is.null(keep)) {
    y <- dplyr_row_slice(y, keep)
  }

  rows_bind(x, y)
}

duckplyr_rows_insert <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- rows_insert(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr rows_patch
#' @export
rows_patch.data.frame <- function(x, y, by = NULL, ..., unmatched = c("error", "ignore"), copy = FALSE, in_place = FALSE) {
  # Our implementation
  rel_try(
    "No relational implementation for rows_patch()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  rows_patch <- rows_patch_data_frame
  out <- rows_patch(x, y, by, ..., unmatched = unmatched, copy = copy, in_place = in_place)
  return(out)

  # dplyr implementation
  check_dots_empty()
  rows_df_in_place(in_place)

  y <- auto_copy(x, y, copy = copy)

  by <- rows_check_by(by, y)

  rows_check_x_contains_y(x, y)
  rows_check_contains_by(x, by, "x")
  rows_check_contains_by(y, by, "y")

  x_key <- dplyr_col_select(x, by)
  y_key <- dplyr_col_select(y, by)

  rows_check_unique(y_key, "y")

  args <- vec_cast_common(x = x_key, y = y_key)
  x_key <- args$x
  y_key <- args$y

  values_names <- setdiff(names(y), names(y_key))

  x_values <- dplyr_col_select(x, values_names)
  y_values <- dplyr_col_select(y, values_names)
  y_values <- rows_cast_y(y_values, x_values)

  keep <- rows_check_y_unmatched(x_key, y_key, unmatched)

  if (!is.null(keep)) {
    y_key <- dplyr_row_slice(y_key, keep)
    y_values <- dplyr_row_slice(y_values, keep)
  }

  loc <- vec_match(x_key, y_key)
  match <- !is.na(loc)

  y_loc <- loc[match]
  x_loc <- which(match)

  x_slice <- dplyr_row_slice(x_values, x_loc)
  x_slice <- dplyr_new_list(x_slice)

  y_slice <- dplyr_row_slice(y_values, y_loc)
  y_slice <- dplyr_new_list(y_slice)

  x_patched <- map2(x_slice, y_slice, coalesce)
  x_patched <- new_data_frame(x_patched, n = length(x_loc))

  x_values <- vec_assign(x_values, x_loc, x_patched)
  x_values <- dplyr_new_list(x_values)

  x <- dplyr_col_modify(x, x_values)

  x
}

duckplyr_rows_patch <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- rows_patch(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr rows_update
#' @export
rows_update.data.frame <- function(x, y, by = NULL, ..., unmatched = c("error", "ignore"), copy = FALSE, in_place = FALSE) {
  # Our implementation
  rel_try(
    "No relational implementation for rows_update()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  rows_update <- rows_update_data_frame
  out <- rows_update(x, y, by, ..., unmatched = unmatched, copy = copy, in_place = in_place)
  return(out)

  # dplyr implementation
  check_dots_empty()
  rows_df_in_place(in_place)

  y <- auto_copy(x, y, copy = copy)

  by <- rows_check_by(by, y)

  rows_check_x_contains_y(x, y)
  rows_check_contains_by(x, by, "x")
  rows_check_contains_by(y, by, "y")

  x_key <- dplyr_col_select(x, by)
  y_key <- dplyr_col_select(y, by)

  rows_check_unique(y_key, "y")

  args <- vec_cast_common(x = x_key, y = y_key)
  x_key <- args$x
  y_key <- args$y

  values_names <- setdiff(names(y), names(y_key))

  x_values <- dplyr_col_select(x, values_names)
  y_values <- dplyr_col_select(y, values_names)
  y_values <- rows_cast_y(y_values, x_values)

  keep <- rows_check_y_unmatched(x_key, y_key, unmatched)

  if (!is.null(keep)) {
    y_key <- dplyr_row_slice(y_key, keep)
    y_values <- dplyr_row_slice(y_values, keep)
  }

  loc <- vec_match(x_key, y_key)
  match <- !is.na(loc)

  y_loc <- loc[match]
  x_loc <- which(match)

  y_values <- dplyr_row_slice(y_values, y_loc)

  x_values <- vec_assign(x_values, x_loc, y_values)
  x_values <- dplyr_new_list(x_values)

  x <- dplyr_col_modify(x, x_values)

  x
}

duckplyr_rows_update <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- rows_update(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr rows_upsert
#' @export
rows_upsert.data.frame <- function(x, y, by = NULL, ..., copy = FALSE, in_place = FALSE) {
  # Our implementation
  rel_try(
    "No relational implementation for rows_upsert()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  rows_upsert <- rows_upsert_data_frame
  out <- rows_upsert(x, y, by, ..., copy = copy, in_place = in_place)
  return(out)

  # dplyr implementation
  check_dots_empty()
  rows_df_in_place(in_place)

  y <- auto_copy(x, y, copy = copy)

  by <- rows_check_by(by, y)

  rows_check_x_contains_y(x, y)
  rows_check_contains_by(x, by, "x")
  rows_check_contains_by(y, by, "y")

  x_key <- dplyr_col_select(x, by)
  y_key <- dplyr_col_select(y, by)

  rows_check_unique(y_key, "y")

  args <- vec_cast_common(x = x_key, y = y_key)
  x_key <- args$x
  y_key <- args$y

  values_names <- setdiff(names(y), names(y_key))

  x_values <- dplyr_col_select(x, values_names)
  y_values <- dplyr_col_select(y, values_names)
  y_values <- rows_cast_y(y_values, x_values)

  loc <- vec_match(x_key, y_key)
  match <- !is.na(loc)

  y_loc <- loc[match]
  x_loc <- which(match)

  # Update
  y_values <- dplyr_row_slice(y_values, y_loc)
  x_values <- vec_assign(x_values, x_loc, y_values)
  x_values <- dplyr_new_list(x_values)

  x <- dplyr_col_modify(x, x_values)

  # Insert
  y_size <- vec_size(y_key)
  y_extra <- dplyr:::vec_as_location_invert(y_loc, y_size)

  y <- dplyr_row_slice(y, y_extra)
  y <- rows_cast_y(y, x)

  x <- rows_bind(x, y)

  x
}

duckplyr_rows_upsert <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- rows_upsert(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr sample_frac
#' @export
sample_frac.data.frame <- function(tbl, size = 1, replace = FALSE, weight = NULL, .env = NULL, ...) {
  # Our implementation
  rel_try(
    "No relational implementation for sample_frac()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  sample_frac <- sample_frac_data_frame
  out <- sample_frac(tbl, {{ size }}, replace, {{ weight }}, .env, ...)
  return(out)

  # dplyr implementation
  if (!is_null(.env)) {
    inform("`.env` is deprecated and no longer has any effect")
  }

  size <- enquo(size)
  weight <- enquo(weight)

  dplyr_local_error_call()
  slice(tbl, local({
    size <- round(n() * check_frac(!!size, replace = replace))
    sample.int(n(), size, replace = replace, prob = !!weight)
  }))
}

duckplyr_sample_frac <- function(tbl, ...) {
  try_fetch(
    tbl <- as_duckplyr_df(tbl),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- sample_frac(tbl, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr sample_n
#' @export
sample_n.data.frame <- function(tbl, size, replace = FALSE, weight = NULL, .env = NULL, ...) {
  # Our implementation
  rel_try(
    "No relational implementation for sample_n()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  sample_n <- sample_n_data_frame
  out <- sample_n(tbl, {{ size }}, replace, {{ weight }}, .env, ...)
  return(out)

  # dplyr implementation
  if (!is_null(.env)) {
    inform("`sample_n() argument `.env` is deprecated and no longer has any effect.")
  }

  size <- enquo(size)
  weight <- enquo(weight)

  dplyr_local_error_call()
  slice(tbl, local({
    size <- check_size(!!size, n(), replace = replace)
    sample.int(n(), size, replace = replace, prob = !!weight)
  }))
}

duckplyr_sample_n <- function(tbl, ...) {
  try_fetch(
    tbl <- as_duckplyr_df(tbl),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- sample_n(tbl, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr select
#' @export
select.data.frame <- function(.data, ...) {
  force(.data)

  error_call <- dplyr_error_call()

  loc <- tidyselect::eval_select(
    expr(c(...)),
    data = .data,
    error_call = error_call
  )

  exprs <- exprs_from_loc(.data, loc)

  rel_try(
    "Can't use relational with zero-column result set." = (length(exprs) == 0),
    {
      rel <- duckdb_rel_from_df(.data)
      out <- exprs_project(rel, exprs, .data)
      return(out)
    }
  )


  # dplyr forward
  select <- select_data_frame
  out <- select(.data, ...)
  return(out)

  # dplyr implementation
  error_call <- dplyr_error_call()

  loc <- tidyselect::eval_select(
    expr(c(...)),
    data = .data,
    error_call = error_call
  )
  loc <- ensure_group_vars(loc, .data, notify = TRUE)

  out <- dplyr_col_select(.data, loc)
  out <- set_names(out, names(loc))

  out
}

duckplyr_select <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- select(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr semi_join
#' @export
semi_join.data.frame <- function(x, y, by = NULL, copy = FALSE, ..., na_matches = c("na", "never")) {
  check_dots_empty0(...)
  error_call <- caller_env()

  # https://github.com/duckdb/duckdb/issues/6597
  na_matches <- check_na_matches(na_matches, error_call = error_call)

  # Our implementation
  rel_try(
    "No relational implementation for semi_join(copy = TRUE)" = copy,
    {
      out <- rel_join_impl(x, y, by, "semi", na_matches, error_call = error_call)
      return(out)
    }
  )

  # dplyr forward
  semi_join <- semi_join_data_frame
  out <- semi_join(x, y, by, copy, ..., na_matches = na_matches)
  return(out)

  # dplyr implementation
  check_dots_empty0(...)
  y <- auto_copy(x, y, copy = copy)
  join_filter(x, y, by = by, type = "semi", na_matches = na_matches, user_env = caller_env())
}

duckplyr_semi_join <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- semi_join(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr setdiff
#' @export
setdiff.data.frame <- function(x, y, ...) {
  # Our implementation
  check_dots_empty()

  x_names <- names(x)
  y_names <- names(y)
  if (identical(x_names, y_names)) {
    # Ensure identical() is very cheap
    y_names <- x_names
  }

  rel_try(
    "No duplicate names" = !identical(x_names, y_names) && anyDuplicated(x_names) && anyDuplicated(y_names),
    "Tables of different width" = length(x_names) != length(y_names),
    "Name mismatch" = !identical(x_names, y_names) && !all(y_names %in% x_names),
    {
      x_rel <- duckdb_rel_from_df(x)
      y_rel <- duckdb_rel_from_df(y)
      if (!identical(x_names, y_names)) {
        # FIXME: Select by position
        exprs <- nexprs_from_loc(x_names, set_names(seq_along(x_names), x_names))
        y_rel <- rel_project(y_rel, exprs)
      }

      rel <- rel_set_diff(x_rel, y_rel)
      out <- rel_to_df(rel)
      out <- dplyr_reconstruct(out, x)
      return(out)
    }
  )

  # dplyr forward
  setdiff <- setdiff_data_frame
  out <- setdiff(x, y, ...)
  return(out)

  # dplyr implementation
  check_dots_empty()
  check_compatible(x, y)

  out <- vec_set_difference(x, y, error_call = current_env())

  dplyr_reconstruct(out, x)
}

duckplyr_setdiff <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- setdiff(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr setequal
#' @export
setequal.data.frame <- function(x, y, ...) {
  # Our implementation
  rel_try(
    "No relational implementation for setequal()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  setequal <- setequal_data_frame
  out <- setequal(x, y, ...)
  return(out)

  # dplyr implementation
  check_dots_empty()
  check_compatible(x, y)

  cast <- vec_cast_common(x = x, y = y)
  all(vec_in(cast$x, cast$y)) && all(vec_in(cast$y, cast$x))
}

duckplyr_setequal <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- setequal(x, y, ...)
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr slice
#' @export
slice.data.frame <- function(.data, ..., .by = NULL, .preserve = FALSE) {
  # Our implementation
  rel_try(
    "No relational implementation for slice()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  slice <- slice_data_frame
  out <- slice(.data, ..., .by = {{ .by }}, .preserve = .preserve)
  return(out)

  # dplyr implementation
  check_dots_unnamed()

  dots <- enquos(...)

  by <- compute_by(
    by = {{ .by }},
    data = .data,
    by_arg = the$slice_by_arg,
    data_arg = ".data"
  )

  loc <- slice_rows(.data, dots, by)
  dplyr_row_slice(.data, loc, preserve = .preserve)
}

duckplyr_slice <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- slice(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr slice_head
#' @export
slice_head.data.frame <- function(.data, ..., n, prop, by = NULL) {
  # Our implementation
  rel_try(
    "No relational implementation for slice_head()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  slice_head <- slice_head_data_frame
  out <- slice_head(.data, ..., n = n, prop = prop, by = {{ by }})
  return(out)

  # dplyr implementation
  check_dots_empty0(...)

  size <- get_slice_size(n = n, prop = prop)
  idx <- function(n) {
    seq2(1, size(n))
  }

  dplyr_local_error_call()
  dplyr_local_slice_by_arg("by")

  slice(.data, idx(dplyr::n()), .by = {{ by }})
}

duckplyr_slice_head <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- slice_head(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
duckplyr_slice_max <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- slice_max(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
duckplyr_slice_min <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- slice_min(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
duckplyr_slice_sample <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- slice_sample(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr slice_tail
#' @export
slice_tail.data.frame <- function(.data, ..., n, prop, by = NULL) {
  # Our implementation
  rel_try(
    "No relational implementation for slice_tail()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  slice_tail <- slice_tail_data_frame
  out <- slice_tail(.data, ..., n = n, prop = prop, by = {{ by }})
  return(out)

  # dplyr implementation
  check_dots_empty0(...)

  size <- get_slice_size(n = n, prop = prop)
  idx <- function(n) {
    seq2(n - size(n) + 1, n)
  }

  dplyr_local_error_call()
  dplyr_local_slice_by_arg("by")

  slice(.data, idx(dplyr::n()), .by = {{ by }})
}

duckplyr_slice_tail <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- slice_tail(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

stats <- new_environment(list(attempts = 0L, fallback = 0L, calls = character()))

#' @export
stats_show <- function() {
  writeLines(paste0(
    c("\U0001f6e0", "\U0001f528", "\U0001f986"),
    ": ",
    format(c(stats$attempts, stats$fallback, stats$attempts - stats$fallback))
  ))
  calls <- sort(gsub("[.]duckplyr_df", "", stats$calls))
  writeLines(paste(calls, collapse = ", "))
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr summarise
#' @export
summarise.data.frame <- function(.data, ..., .by = NULL, .groups = NULL) {
  force(.data)

  rel_try(
    'summarize(.groups = "rowwise") not supported' = identical(.groups, "rowwise"),
    {
      by <- eval_select_by(enquo(.by), .data)
      oo <- (length(by) > 0) && oo_force()

      rel <- duckdb_rel_from_df(.data)

      if (oo) {
        rel <- oo_prep(rel, colname = "___row_number", force = TRUE)
      }

      dots <- dplyr_quosures(...)
      dots <- fix_auto_name(dots)

      aggregates <- rel_translate_dots(dots, .data)
      groups <- lapply(by, relexpr_reference)

      if (oo) {
        aggregates <- c(
          list(rel_translate(
            quo(min(`___row_number`)),
            new_data_frame(list(`___row_number` = integer())),
            alias = "___row_number"
          )),
          aggregates
        )
      }

      out_rel <- rel_aggregate(rel, groups, unname(aggregates))
      # https://github.com/duckdb/duckdb/issues/7095
      if (length(groups) == 0) {
        out_rel <- rel_distinct(out_rel)
      }

      if (oo) {
        out_rel <- oo_restore(out_rel, "___row_number")
      }

      out <- rel_to_df(out_rel)
      class(out) <- class(.data)

      return(out)
    }
  )

  # dplyr forward
  summarise <- summarise_data_frame
  out <- summarise(.data, ..., .by = {{ .by }}, .groups = .groups)
  return(out)

  # dplyr implementation
  by <- compute_by({{ .by }}, .data, by_arg = ".by", data_arg = ".data")

  cols <- summarise_cols(.data, dplyr_quosures(...), by, "summarise")
  out <- summarise_build(by, cols)

  if (!cols$all_one) {
    summarise_deprecate_variable_size()
  }

  if (!is_tibble(.data)) {
    # The `by` group data we build from is always a tibble,
    # so we have to manually downcast as needed
    out <- as.data.frame(out)
  }

  if (identical(.groups, "rowwise")) {
    out <- rowwise_df(out, character())
  }

  out
}

duckplyr_summarise <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- summarise(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr symdiff
#' @export
symdiff.data.frame <- function(x, y, ...) {
  # Our implementation
  check_dots_empty()

  x_names <- names(x)
  y_names <- names(y)
  if (identical(x_names, y_names)) {
    # Ensure identical() is very cheap
    y_names <- x_names
  }

  rel_try(
    "No duplicate names" = !identical(x_names, y_names) && anyDuplicated(x_names) && anyDuplicated(y_names),
    "Tables of different width" = length(x_names) != length(y_names),
    "Name mismatch" = !identical(x_names, y_names) && !all(y_names %in% x_names),
    {
      x_rel <- duckdb_rel_from_df(x)
      y_rel <- duckdb_rel_from_df(y)
      if (!identical(x_names, y_names)) {
        # FIXME: Select by position
        exprs <- nexprs_from_loc(x_names, set_names(seq_along(x_names), x_names))
        y_rel <- rel_project(y_rel, exprs)
      }

      rel <- rel_set_symdiff(x_rel, y_rel)
      out <- rel_to_df(rel)
      out <- dplyr_reconstruct(out, x)
      return(out)
    }
  )

  # dplyr forward
  symdiff <- symdiff_data_frame
  out <- symdiff(x, y, ...)
  return(out)

  # dplyr implementation
  check_dots_empty()
  check_compatible(x, y)

  out <- vec_set_symmetric_difference(x, y, error_call = current_env())

  dplyr_reconstruct(out, x)
}

duckplyr_symdiff <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- symdiff(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
duckplyr_tally <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- tally(x, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr tbl_vars
#' @export
tbl_vars.data.frame <- function(x) {
  # Our implementation
  # Avoid rel_try(), it's not an error if the input is not an ALTREP df
  tryCatch(
    {
      rel <- duckdb:::rel_from_altrep_df(x)
      return(rel_names(rel))
    },
    error = identity
  )

  # dplyr implementation
  names(x)
}

duckplyr_tbl_vars <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- tbl_vars(x, ...)
  out
}

select_opt <- select
# select_opt <- function(x, ...) x

TPCH_NA_MATCHES <- "never"

tpch_01 <- function() {
  lineitem |>
    select_opt(l_shipdate, l_returnflag, l_linestatus, l_quantity, l_extendedprice, l_discount, l_tax) |>
    filter(l_shipdate <= as.Date("1998-09-02")) |>
    select_opt(l_returnflag, l_linestatus, l_quantity, l_extendedprice, l_discount, l_tax) |>
    summarise(
      sum_qty = sum(l_quantity),
      sum_base_price = sum(l_extendedprice),
      sum_disc_price = sum(l_extendedprice * (1 - l_discount)),
      sum_charge = sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)),
      avg_qty = mean(l_quantity),
      avg_price = mean(l_extendedprice),
      avg_disc = mean(l_discount),
      count_order = n(),
      .by = c(l_returnflag, l_linestatus)
    ) |>
    arrange(l_returnflag, l_linestatus)
}

tpch_02 <- function() {
  ps <- partsupp |> select_opt(ps_partkey, ps_suppkey, ps_supplycost)

  p <- part |>
    select_opt(p_partkey, p_type, p_size, p_mfgr) |>
    filter(p_size == 15, grepl("BRASS$", p_type)) |>
    select_opt(p_partkey, p_mfgr)

  psp <- inner_join(na_matches = TPCH_NA_MATCHES, p, ps, by = c("p_partkey" = "ps_partkey"))

  sp <- supplier |>
    select_opt(
      s_suppkey, s_nationkey, s_acctbal, s_name,
      s_address, s_phone, s_comment
    )

  psps <- inner_join(psp, sp,
    by = c("ps_suppkey" = "s_suppkey")
  ) |>
    select_opt(
      p_partkey, ps_supplycost, p_mfgr, s_nationkey,
      s_acctbal, s_name, s_address, s_phone, s_comment
    )

  nr <- inner_join(
    nation,
    region |> filter(r_name == "EUROPE"),
    by = c("n_regionkey" = "r_regionkey")
  ) |>
    select_opt(n_nationkey, n_name)

  pspsnr <- inner_join(psps, nr, by = c("s_nationkey" = "n_nationkey")) |>
    select_opt(
      p_partkey, ps_supplycost, p_mfgr, n_name, s_acctbal,
      s_name, s_address, s_phone, s_comment
    )

  aggr <- pspsnr |>
    summarise(min_ps_supplycost = min(ps_supplycost), .by = p_partkey)

  sj <- inner_join(pspsnr, aggr,
    by = c(
      "p_partkey" = "p_partkey",
      "ps_supplycost" = "min_ps_supplycost"
    )
  )

  res <- sj |>
    select(
      s_acctbal, s_name, n_name, p_partkey, p_mfgr,
      s_address, s_phone, s_comment
    ) |>
    arrange(desc(s_acctbal), n_name, s_name, p_partkey) |>
    head(100)

  res
}

tpch_03 <- function() {
  oc <- inner_join(
    orders |>
      select_opt(o_orderkey, o_custkey, o_orderdate, o_shippriority) |>
      filter(o_orderdate < as.Date("1995-03-15")),
    customer |>
      select_opt(c_custkey, c_mktsegment) |>
      filter(c_mktsegment == "BUILDING"),
    by = c("o_custkey" = "c_custkey")
  ) |>
    select_opt(o_orderkey, o_orderdate, o_shippriority)

  loc <- inner_join(
    lineitem |>
      select_opt(l_orderkey, l_shipdate, l_extendedprice, l_discount) |>
      filter(l_shipdate > as.Date("1995-03-15")) |>
      select_opt(l_orderkey, l_extendedprice, l_discount),
    oc,
    by = c("l_orderkey" = "o_orderkey")
  )

  aggr <- loc |>
    mutate(volume = l_extendedprice * (1 - l_discount)) |>
    summarise(revenue = sum(volume), .by = c(l_orderkey, o_orderdate, o_shippriority)) |>
    select(l_orderkey, revenue, o_orderdate, o_shippriority) |>
    arrange(desc(revenue), o_orderdate) |>
    head(10)
  aggr
}

tpch_04 <- function() {
  l <- lineitem |>
    select_opt(l_orderkey, l_commitdate, l_receiptdate) |>
    filter(l_commitdate < l_receiptdate) |>
    select(l_orderkey)

  o <- orders |>
    select_opt(o_orderkey, o_orderdate, o_orderpriority) |>
    filter(o_orderdate >= as.Date("1993-07-01"), o_orderdate < as.Date("1993-10-01")) |>
    select(o_orderkey, o_orderpriority)

  # distinct after join, tested and indeed faster
  lo <- inner_join(na_matches = TPCH_NA_MATCHES, l, o, by = c("l_orderkey" = "o_orderkey")) |>
    distinct() |>
    select_opt(o_orderpriority)

  aggr <- lo |>
    summarise(order_count = n(), .by = o_orderpriority) |>
    arrange(o_orderpriority)

  aggr
}

tpch_05 <- function() {
  nr <- inner_join(na_matches = TPCH_NA_MATCHES,
    nation |>
      select_opt(n_nationkey, n_regionkey, n_name),
    region |>
      select_opt(r_regionkey, r_name) |>
      filter(r_name == "ASIA"),
    by = c("n_regionkey" = "r_regionkey")
  ) |>
    select_opt(n_nationkey, n_name)

  snr <- inner_join(na_matches = TPCH_NA_MATCHES,
    supplier |>
      select_opt(s_suppkey, s_nationkey),
    nr,
    by = c("s_nationkey" = "n_nationkey")
  ) |>
    select_opt(s_suppkey, s_nationkey, n_name)

  lsnr <- inner_join(na_matches = TPCH_NA_MATCHES,
    lineitem |> select_opt(l_suppkey, l_orderkey, l_extendedprice, l_discount),
    snr,
    by = c("l_suppkey" = "s_suppkey")
  )

  o <- orders |>
    select_opt(o_orderdate, o_orderkey, o_custkey) |>
    filter(o_orderdate >= as.Date("1994-01-01"), o_orderdate < as.Date("1995-01-01")) |>
    select_opt(o_orderkey, o_custkey)

  oc <- inner_join(na_matches = TPCH_NA_MATCHES, o, customer |> select_opt(c_custkey, c_nationkey),
    by = c("o_custkey" = "c_custkey")
  ) |>
    select_opt(o_orderkey, c_nationkey)

  lsnroc <- inner_join(na_matches = TPCH_NA_MATCHES, lsnr, oc,
    by = c("l_orderkey" = "o_orderkey", "s_nationkey" = "c_nationkey")
  ) |>
    select_opt(l_extendedprice, l_discount, n_name)

  aggr <- lsnroc |>
    mutate(volume = l_extendedprice * (1 - l_discount)) |>
    summarise(revenue = sum(volume), .by = n_name) |>
    arrange(desc(revenue))

  aggr
}

tpch_06 <- function() {
  lineitem |>
    select_opt(l_shipdate, l_extendedprice, l_discount, l_quantity) |>
    filter(
      l_shipdate >= as.Date("1994-01-01"),
      l_shipdate < as.Date("1995-01-01"),
      l_discount >= 0.05,
      l_discount <= 0.07,
      l_quantity < 24
    ) |>
    select_opt(l_extendedprice, l_discount) |>
    summarise(revenue = sum(l_extendedprice * l_discount))
}

tpch_07 <- function() {
  sn <- inner_join(na_matches = TPCH_NA_MATCHES,
    supplier |>
      select_opt(s_nationkey, s_suppkey),
    nation |>
      select(n1_nationkey = n_nationkey, n1_name = n_name) |>
      # filter(n1_name %in% c("FRANCE", "GERMANY")),  TODO
      filter(n1_name == "FRANCE" | n1_name == "GERMANY"),
    by = c("s_nationkey" = "n1_nationkey")
  ) |>
    select_opt(s_suppkey, n1_name)

  cn <- inner_join(na_matches = TPCH_NA_MATCHES,
    customer |>
      select_opt(c_custkey, c_nationkey),
    nation |>
      select(n2_nationkey = n_nationkey, n2_name = n_name) |>
      # filter(n2_name %in% c("FRANCE", "GERMANY")),
      filter(n2_name == "FRANCE" | n2_name == "GERMANY"),
    by = c("c_nationkey" = "n2_nationkey")
  ) |>
    select_opt(c_custkey, n2_name)

  cno <- inner_join(na_matches = TPCH_NA_MATCHES,
    orders |>
      select_opt(o_custkey, o_orderkey),
    cn,
    by = c("o_custkey" = "c_custkey")
  ) |>
    select_opt(o_orderkey, n2_name)

  cnol <- inner_join(na_matches = TPCH_NA_MATCHES,
    lineitem |>
      select_opt(l_orderkey, l_suppkey, l_shipdate, l_extendedprice, l_discount) |>
      filter(l_shipdate >= as.Date("1995-01-01"), l_shipdate <= as.Date("1996-12-31")),
    cno,
    by = c("l_orderkey" = "o_orderkey")
  ) |>
    select_opt(l_suppkey, l_shipdate, l_extendedprice, l_discount, n2_name)

  all <- inner_join(na_matches = TPCH_NA_MATCHES, cnol, sn, by = c("l_suppkey" = "s_suppkey"))

  aggr <- all |>
    filter((n1_name == "FRANCE" & n2_name == "GERMANY") |
      (n1_name == "GERMANY" & n2_name == "FRANCE")) |>
    mutate(
      supp_nation = n1_name,
      cust_nation = n2_name,
      l_year = as.integer(strftime(l_shipdate, "%Y")),
      volume = l_extendedprice * (1 - l_discount)
    ) |>
    select_opt(supp_nation, cust_nation, l_year, volume) |>
    summarise(revenue = sum(volume), .by = c(supp_nation, cust_nation, l_year)) |>
    arrange(supp_nation, cust_nation, l_year)

  aggr
}

tpch_08 <- function() {
  nr <- inner_join(na_matches = TPCH_NA_MATCHES,
    nation |>
      select(n1_nationkey = n_nationkey, n1_regionkey = n_regionkey),
    region |>
      select_opt(r_regionkey, r_name) |>
      filter(r_name == "AMERICA") |>
      select_opt(r_regionkey),
    by = c("n1_regionkey" = "r_regionkey")
  ) |>
    select_opt(n1_nationkey)

  cnr <- inner_join(na_matches = TPCH_NA_MATCHES,
    customer |>
      select_opt(c_custkey, c_nationkey),
    nr,
    by = c("c_nationkey" = "n1_nationkey")
  ) |>
    select_opt(c_custkey)

  ocnr <- inner_join(na_matches = TPCH_NA_MATCHES,
    orders |>
      select_opt(o_orderkey, o_custkey, o_orderdate) |>
      filter(o_orderdate >= as.Date("1995-01-01"), o_orderdate <= as.Date("1996-12-31")),
    cnr,
    by = c("o_custkey" = "c_custkey")
  ) |>
    select_opt(o_orderkey, o_orderdate)

  locnr <- inner_join(na_matches = TPCH_NA_MATCHES,
    lineitem |>
      select_opt(l_orderkey, l_partkey, l_suppkey, l_extendedprice, l_discount),
    ocnr,
    by = c("l_orderkey" = "o_orderkey")
  ) |>
    select_opt(l_partkey, l_suppkey, l_extendedprice, l_discount, o_orderdate)

  locnrp <- inner_join(na_matches = TPCH_NA_MATCHES, locnr,
    part |>
      select_opt(p_partkey, p_type) |>
      filter(p_type == "ECONOMY ANODIZED STEEL") |>
      select_opt(p_partkey),
    by = c("l_partkey" = "p_partkey")
  ) |>
    select_opt(l_suppkey, l_extendedprice, l_discount, o_orderdate)

  locnrps <- inner_join(na_matches = TPCH_NA_MATCHES, locnrp,
    supplier |>
      select_opt(s_suppkey, s_nationkey),
    by = c("l_suppkey" = "s_suppkey")
  ) |>
    select_opt(l_extendedprice, l_discount, o_orderdate, s_nationkey)

  all <- inner_join(na_matches = TPCH_NA_MATCHES, locnrps,
    nation |>
      select(n2_nationkey = n_nationkey, n2_name = n_name),
    by = c("s_nationkey" = "n2_nationkey")
  ) |>
    select_opt(l_extendedprice, l_discount, o_orderdate, n2_name)

  aggr <- all |>
    mutate(
      o_year =  as.integer(strftime(o_orderdate, "%Y")),
      volume = l_extendedprice * (1 - l_discount),
      nation = n2_name
    ) |>
    select_opt(o_year, volume, nation) |>
    summarise(
      mkt_share = sum(ifelse(nation == "BRAZIL", volume, 0)) / sum(volume),
      .by = o_year
    ) |>
    arrange(o_year)
  aggr
}

tpch_09 <- function() {
  p <- part |>
    select_opt(p_name, p_partkey) |>
    filter(grepl("green", p_name)) |>
    select_opt(p_partkey)

  psp <- inner_join(na_matches = TPCH_NA_MATCHES,
    partsupp |>
      select_opt(ps_suppkey, ps_partkey, ps_supplycost),
    p,
    by = c("ps_partkey" = "p_partkey")
  )

  sn <- inner_join(na_matches = TPCH_NA_MATCHES,
    supplier |>
      select_opt(s_suppkey, s_nationkey),
    nation |>
      select_opt(n_nationkey, n_name),
    by = c("s_nationkey" = "n_nationkey")
  ) |>
    select_opt(s_suppkey, n_name)

  pspsn <- inner_join(na_matches = TPCH_NA_MATCHES, psp, sn, by = c("ps_suppkey" = "s_suppkey"))

  lpspsn <- inner_join(na_matches = TPCH_NA_MATCHES,
    lineitem |>
      select_opt(l_suppkey, l_partkey, l_orderkey, l_extendedprice, l_discount, l_quantity),
    pspsn,
    by = c("l_suppkey" = "ps_suppkey", "l_partkey" = "ps_partkey")
  ) |>
    select_opt(l_orderkey, l_extendedprice, l_discount, l_quantity, ps_supplycost, n_name)

  all <- inner_join(na_matches = TPCH_NA_MATCHES,
    orders |>
      select_opt(o_orderkey, o_orderdate),
    lpspsn,
    by = c("o_orderkey" = "l_orderkey")
  ) |>
    select_opt(l_extendedprice, l_discount, l_quantity, ps_supplycost, n_name, o_orderdate)

  aggr <- all |>
    mutate(
      nation = n_name,
      o_year = as.integer(strftime(o_orderdate, "%Y")),
      amount = l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity
    ) |>
    select_opt(nation, o_year, amount) |>
    summarise(sum_profit = sum(amount), .by = c(nation, o_year)) |>
    arrange(nation, desc(o_year))

  aggr
}

tpch_10 <- function() {
  l <- lineitem |>
    select_opt(l_orderkey, l_returnflag, l_extendedprice, l_discount) |>
    filter(l_returnflag == "R") |>
    select_opt(l_orderkey, l_extendedprice, l_discount)

  o <- orders |>
    select_opt(o_orderkey, o_custkey, o_orderdate) |>
    filter(o_orderdate >= as.Date("1993-10-01"), o_orderdate < as.Date("1994-01-01")) |>
    select_opt(o_orderkey, o_custkey)

  lo <- inner_join(na_matches = TPCH_NA_MATCHES, l, o,
    by = c("l_orderkey" = "o_orderkey")
  ) |>
    select_opt(l_extendedprice, l_discount, o_custkey)
  # first aggregate, then join with customer/nation,
  # otherwise we need to aggr over lots of cols

  lo_aggr <- lo |>
    mutate(volume = l_extendedprice * (1 - l_discount)) |>
    summarise(revenue = sum(volume), .by = o_custkey)

  c <- customer |>
    select_opt(c_custkey, c_nationkey, c_name, c_acctbal, c_phone, c_address, c_comment)

  loc <- inner_join(na_matches = TPCH_NA_MATCHES, c, lo_aggr, by = c("c_custkey" = "o_custkey"))

  locn <- inner_join(na_matches = TPCH_NA_MATCHES, loc, nation |> select_opt(n_nationkey, n_name),
    by = c("c_nationkey" = "n_nationkey")
  )

  res <- locn |>
    select(
      c_custkey, c_name, revenue, c_acctbal, n_name,
      c_address, c_phone, c_comment
    ) |>
    arrange(desc(revenue)) |>
    head(20)

  res
}

tpch_11 <- function() {
  nation <- nation |>
    filter(n_name == "GERMANY")

  joined_filtered <- partsupp |>
    inner_join(na_matches = TPCH_NA_MATCHES, supplier, by = c("ps_suppkey" = "s_suppkey")) |>
    inner_join(na_matches = TPCH_NA_MATCHES, nation, by = c("s_nationkey" = "n_nationkey"))

  global_agr <- joined_filtered |>
    summarise(
      global_value = sum(ps_supplycost * ps_availqty) * 0.0001000000
    ) |>
    mutate(global_agr_key = 1L)

  partkey_agr <- joined_filtered |>
    summarise(
      value = sum(ps_supplycost * ps_availqty),
      .by = ps_partkey
    )

  partkey_agr |>
    mutate(global_agr_key = 1L) |>
    inner_join(na_matches = TPCH_NA_MATCHES, global_agr, by = "global_agr_key") |>
    filter(value > global_value) |>
    arrange(desc(value)) |>
    select(ps_partkey, value)
}

tpch_12 <- function() {
  lineitem |>
    filter(
      l_shipmode %in% c("MAIL", "SHIP"),
      l_commitdate < l_receiptdate,
      l_shipdate < l_commitdate,
      l_receiptdate >= as.Date("1994-01-01"),
      l_receiptdate < as.Date("1995-01-01")
    ) |>
    inner_join(na_matches = TPCH_NA_MATCHES,
      orders,
      by = c("l_orderkey" = "o_orderkey")
    ) |>
    summarise(
      high_line_count = sum(
        ifelse(
          (o_orderpriority == "1-URGENT") | (o_orderpriority == "2-HIGH"),
          1L,
          0L
        )
      ),
      low_line_count = sum(
        ifelse(
          (o_orderpriority != "1-URGENT") & (o_orderpriority != "2-HIGH"),
          1L,
          0L
        )
      ),
      .by = l_shipmode
    ) |>
    arrange(l_shipmode)
}

tpch_13 <- function() {
  c_orders <- customer |>
    left_join(na_matches = TPCH_NA_MATCHES,
      orders |>
        filter(!grepl("special.*?requests", o_comment)),
      by = c("c_custkey" = "o_custkey")
    ) |>
    summarise(
      # FIXME: sum(!is.na(o_orderkey))
      c_count = sum(ifelse(is.na(o_orderkey), 0L, 1L)),
      .by = c_custkey
    )

  c_orders |>
    summarise(custdist = n(), .by = c_count) |>
    arrange(desc(custdist), desc(c_count))
}

tpch_14 <- function() {
  lineitem |>
    filter(
      l_shipdate >= as.Date("1995-09-01"),
      l_shipdate < as.Date("1995-10-01")
    ) |>
    inner_join(na_matches = TPCH_NA_MATCHES, part, by = c("l_partkey" = "p_partkey")) |>
    summarise(
      promo_revenue = 100 * sum(
        ifelse(grepl("^PROMO", p_type), l_extendedprice * (1 - l_discount), 0)
      ) / sum(l_extendedprice * (1 - l_discount))
    )
}

tpch_15 <- function() {
  revenue_by_supplier <- lineitem |>
    filter(
      l_shipdate >= as.Date("1996-01-01"),
      l_shipdate < as.Date("1996-04-01")
    ) |>
    summarise(
      total_revenue = sum(l_extendedprice * (1 - l_discount)),
      .by = l_suppkey
    )

  global_revenue <- revenue_by_supplier |>
    mutate(global_agr_key = 1L) |>
    summarise(
      max_total_revenue = max(total_revenue),
      .by = global_agr_key
    )

  revenue_by_supplier |>
    mutate(global_agr_key = 1L) |>
    inner_join(na_matches = TPCH_NA_MATCHES, global_revenue, by = "global_agr_key") |>
    filter(abs(total_revenue - max_total_revenue) < 1e-9) |>
    inner_join(na_matches = TPCH_NA_MATCHES, supplier, by = c("l_suppkey" = "s_suppkey")) |>
    select(s_suppkey = l_suppkey, s_name, s_address, s_phone, total_revenue)
}


tpch_16 <- function() {
  part_filtered <- part |>
    filter(
      p_brand != "Brand#45",
      !grepl("^MEDIUM POLISHED", p_type),
      p_size %in% c(49, 14, 23, 45, 19, 3, 36, 9)
    )

  supplier_filtered <- supplier |>
    filter(!grepl("Customer.*?Complaints", s_comment))

  partsupp_filtered <- partsupp |>
    inner_join(na_matches = TPCH_NA_MATCHES, supplier_filtered, by = c("ps_suppkey" = "s_suppkey")) |>
    select(ps_partkey, ps_suppkey)

  part_filtered |>
    inner_join(na_matches = TPCH_NA_MATCHES, partsupp_filtered, by = c("p_partkey" = "ps_partkey")) |>
    summarise(
      supplier_cnt = n_distinct(ps_suppkey),
      .by = c(p_brand, p_type, p_size)
    ) |>
    select(p_brand, p_type, p_size, supplier_cnt) |>
    arrange(desc(supplier_cnt), p_brand, p_type, p_size)
}

tpch_17 <- function() {
  parts_filtered <- part |>
    filter(
      p_brand == "Brand#23",
      p_container == "MED BOX"
    )

  joined <- lineitem |>
    inner_join(na_matches = TPCH_NA_MATCHES, parts_filtered, by = c("l_partkey" = "p_partkey"))

  quantity_by_part <- joined |>
    summarise(quantity_threshold = 0.2 * mean(l_quantity), .by = l_partkey)

  joined |>
    inner_join(na_matches = TPCH_NA_MATCHES, quantity_by_part, by = "l_partkey") |>
    filter(l_quantity < quantity_threshold) |>
    summarise(avg_yearly = sum(l_extendedprice) / 7.0)
}

tpch_18 <- function() {
  big_orders <- lineitem |>
    summarise(sum = sum(l_quantity), .by = l_orderkey) |>
    filter(sum > 300)

  orders |>
    inner_join(na_matches = TPCH_NA_MATCHES, big_orders, by = c("o_orderkey" = "l_orderkey")) |>
    inner_join(na_matches = TPCH_NA_MATCHES, customer, by = c("o_custkey" = "c_custkey")) |>
    select(
      c_name,
      c_custkey = o_custkey, o_orderkey,
      o_orderdate, o_totalprice, sum
    ) |>
    arrange(desc(o_totalprice), o_orderdate) |>
    head(100)
}

tpch_19 <- function() {
  joined <- lineitem |>
    inner_join(na_matches = TPCH_NA_MATCHES, part, by = c("l_partkey" = "p_partkey"))

  result <- joined |>
    filter(
      (
        p_brand == "Brand#12" &
          p_container %in% c("SM CASE", "SM BOX", "SM PACK", "SM PKG") &
          l_quantity >= 1 &
          l_quantity <= (1 + 10) &
          p_size >= 1 &
          p_size <= 5 &
          l_shipmode %in% c("AIR", "AIR REG") &
          l_shipinstruct == "DELIVER IN PERSON"
      ) |
        (
          p_brand == "Brand#23" &
            p_container %in% c("MED BAG", "MED BOX", "MED PKG", "MED PACK") &
            l_quantity >= 10 &
            l_quantity <= (10 + 10) &
            p_size >= 1 &
            p_size <= 10 &
            l_shipmode %in% c("AIR", "AIR REG") &
            l_shipinstruct == "DELIVER IN PERSON"
        ) |
        (
          p_brand == "Brand#34" &
            p_container %in% c("LG CASE", "LG BOX", "LG PACK", "LG PKG") &
            l_quantity >= 20 &
            l_quantity <= (20 + 10) &
            p_size >= 1 &
            p_size <= 15 &
            l_shipmode %in% c("AIR", "AIR REG") &
            l_shipinstruct == "DELIVER IN PERSON"
        )
    )

  result |>
    summarise(
      revenue = sum(l_extendedprice * (1 - l_discount))
    )
}

tpch_20 <- function() {
  supplier_ca <- supplier |>
    inner_join(na_matches = TPCH_NA_MATCHES,
      nation |> filter(n_name == "CANADA"),
      by = c("s_nationkey" = "n_nationkey")
    ) |>
    select(s_suppkey, s_name, s_address)

  part_forest <- part |>
    filter(grepl("^forest", p_name))

  partsupp_forest_ca <- partsupp |>
    semi_join(na_matches = TPCH_NA_MATCHES, supplier_ca, c("ps_suppkey" = "s_suppkey")) |>
    semi_join(na_matches = TPCH_NA_MATCHES, part_forest, by = c("ps_partkey" = "p_partkey"))

  qty_threshold <- lineitem |>
    filter(
      l_shipdate >= as.Date("1994-01-01"),
      l_shipdate < as.Date("1995-01-01")
    ) |>
    semi_join(na_matches = TPCH_NA_MATCHES, partsupp_forest_ca, by = c("l_partkey" = "ps_partkey", "l_suppkey" = "ps_suppkey")) |>
    summarise(qty_threshold = 0.5 * sum(l_quantity), .by = l_suppkey)

  partsupp_forest_ca_filtered <- partsupp_forest_ca |>
    inner_join(na_matches = TPCH_NA_MATCHES,
      qty_threshold,
      by = c("ps_suppkey" = "l_suppkey")
    ) |>
    filter(ps_availqty > qty_threshold)

  supplier_ca |>
    semi_join(na_matches = TPCH_NA_MATCHES, partsupp_forest_ca_filtered, by = c("s_suppkey" = "ps_suppkey")) |>
    select(s_name, s_address) |>
    arrange(s_name)
}

tpch_21 <- function() {
  orders_with_more_than_one_supplier <- lineitem |>
    count(l_orderkey, l_suppkey) |>
    summarise(n_supplier = n(), .by = l_orderkey) |>
    filter(n_supplier > 1)

  line_items_needed <- lineitem |>
    semi_join(na_matches = TPCH_NA_MATCHES, orders_with_more_than_one_supplier, by = "l_orderkey") |>
    inner_join(na_matches = TPCH_NA_MATCHES, orders, by = c("l_orderkey" = "o_orderkey")) |>
    filter(o_orderstatus == "F") |>
    summarise(
      failed_delivery_commit = any(l_receiptdate > l_commitdate),
      .by = c(l_orderkey, l_suppkey)
    ) |>
    summarise(
      n_supplier = n(),
      num_failed = sum(ifelse(failed_delivery_commit, 1, 0)),
      .by = l_orderkey
    ) |>
    filter(n_supplier > 1 & num_failed == 1)

  line_items <- lineitem |>
    semi_join(na_matches = TPCH_NA_MATCHES, line_items_needed, by = "l_orderkey")

  supplier |>
    inner_join(na_matches = TPCH_NA_MATCHES, line_items, by = c("s_suppkey" = "l_suppkey")) |>
    filter(l_receiptdate > l_commitdate) |>
    inner_join(na_matches = TPCH_NA_MATCHES, nation, by = c("s_nationkey" = "n_nationkey")) |>
    filter(n_name == "SAUDI ARABIA") |>
    summarise(numwait = n(), .by = s_name) |>
    arrange(desc(numwait), s_name) |>
    head(100)
}

tpch_22 <- function() {
  acctbal_mins <- customer |>
    filter(
      # FIXME: substr(c_phone, 1, 2)
      substr(c_phone, 1L, 2L) %in% c("13", "31", "23", "29", "30", "18", "17") &
        c_acctbal > 0
    ) |>
    # FIXME: mean(na.rm = TRUE)
    summarise(acctbal_min = mean(c_acctbal), join_id = 1L)

  customer |>
    # FIXME: substr(c_phone, 1, 2)
    mutate(cntrycode = substr(c_phone, 1L, 2L), join_id = 1L) |>
    left_join(na_matches = TPCH_NA_MATCHES, acctbal_mins, by = "join_id") |>
    filter(
      cntrycode %in% c("13", "31", "23", "29", "30", "18", "17") &
        c_acctbal > acctbal_min
    ) |>
    anti_join(na_matches = TPCH_NA_MATCHES, orders, by = c("c_custkey" = "o_custkey")) |>
    select(cntrycode, c_acctbal) |>
    summarise(
      numcust = n(),
      totacctbal = sum(c_acctbal),
      .by = cntrycode
    ) |>
    arrange(cntrycode)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_01 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "<=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1998-09-02", experimental = experimental)
              } else {
                duckdb:::expr_constant("1998-09-02")
              }
            )
          )
        )
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_aggregate(
    rel4,
    groups = list(duckdb:::expr_reference("l_returnflag"), duckdb:::expr_reference("l_linestatus")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_quantity")))
        duckdb:::expr_set_alias(tmp_expr, "sum_qty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_extendedprice")))
        duckdb:::expr_set_alias(tmp_expr, "sum_base_price")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_reference("l_extendedprice"),
                duckdb:::expr_function(
                  "-",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_discount")
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "sum_disc_price")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_function(
                  "*",
                  list(
                    duckdb:::expr_reference("l_extendedprice"),
                    duckdb:::expr_function(
                      "-",
                      list(
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant(1, experimental = experimental)
                        } else {
                          duckdb:::expr_constant(1)
                        },
                        duckdb:::expr_reference("l_discount")
                      )
                    )
                  )
                ),
                duckdb:::expr_function(
                  "+",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_tax")
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "sum_charge")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("mean", list(duckdb:::expr_reference("l_quantity")))
        duckdb:::expr_set_alias(tmp_expr, "avg_qty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("mean", list(duckdb:::expr_reference("l_extendedprice")))
        duckdb:::expr_set_alias(tmp_expr, "avg_price")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("mean", list(duckdb:::expr_reference("l_discount")))
        duckdb:::expr_set_alias(tmp_expr, "avg_disc")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "count_order")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_order(
    rel5,
    list(duckdb:::expr_reference("l_returnflag"), duckdb:::expr_reference("l_linestatus"))
  )
  rel6
  duckdb:::rel_to_altrep(rel6)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_02 <- function(con, experimental) {
  df1 <- partsupp
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      }
    )
  )
  df2 <- part
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_filter(
    rel4,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("p_size"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(15, experimental = experimental)
          } else {
            duckdb:::expr_constant(15)
          }
        )
      ),
      duckdb:::expr_function(
        "grepl",
        list(
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("BRASS$", experimental = experimental)
          } else {
            duckdb:::expr_constant("BRASS$")
          },
          duckdb:::expr_reference("p_type")
        )
      )
    )
  )
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel6, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel9 <- duckdb:::rel_join(
    rel7,
    rel8,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("p_partkey", rel7), duckdb:::expr_reference("ps_partkey", rel8))
      )
    ),
    "inner"
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("p_partkey", rel7), duckdb:::expr_reference("ps_partkey", rel8))
        )
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      }
    )
  )
  df3 <- supplier
  rel11 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_set_alias(rel10, "lhs")
  rel14 <- duckdb:::rel_set_alias(rel12, "rhs")
  rel15 <- duckdb:::rel_join(
    rel13,
    rel14,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("ps_suppkey", rel13), duckdb:::expr_reference("s_suppkey", rel14))
      )
    ),
    "inner"
  )
  rel16 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel13), duckdb:::expr_reference("s_suppkey", rel14))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  df4 <- region
  rel18 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel19 <- duckdb:::rel_filter(
    rel18,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("r_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("EUROPE", experimental = experimental)
          } else {
            duckdb:::expr_constant("EUROPE")
          }
        )
      )
    )
  )
  df5 <- nation
  rel20 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel21 <- duckdb:::rel_set_alias(rel20, "lhs")
  rel22 <- duckdb:::rel_set_alias(rel19, "rhs")
  rel23 <- duckdb:::rel_join(
    rel21,
    rel22,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("n_regionkey", rel21), duckdb:::expr_reference("r_regionkey", rel22))
      )
    ),
    "inner"
  )
  rel24 <- duckdb:::rel_project(
    rel23,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("n_regionkey", rel21), duckdb:::expr_reference("r_regionkey", rel22))
        )
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_comment")
        duckdb:::expr_set_alias(tmp_expr, "r_comment")
        tmp_expr
      }
    )
  )
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_set_alias(rel17, "lhs")
  rel27 <- duckdb:::rel_set_alias(rel25, "rhs")
  rel28 <- duckdb:::rel_join(
    rel26,
    rel27,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("s_nationkey", rel26), duckdb:::expr_reference("n_nationkey", rel27))
      )
    ),
    "inner"
  )
  rel29 <- duckdb:::rel_project(
    rel28,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel26), duckdb:::expr_reference("n_nationkey", rel27))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_project(
    rel29,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel31 <- duckdb:::rel_aggregate(
    rel30,
    groups = list(duckdb:::expr_reference("p_partkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("min", list(duckdb:::expr_reference("ps_supplycost")))
        duckdb:::expr_set_alias(tmp_expr, "min_ps_supplycost")
        tmp_expr
      }
    )
  )
  rel32 <- duckdb:::rel_set_alias(rel30, "lhs")
  rel33 <- duckdb:::rel_set_alias(rel31, "rhs")
  rel34 <- duckdb:::rel_project(
    rel32,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment_x")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("min_ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "min_ps_supplycost_y")
        tmp_expr
      }
    )
  )
  rel36 <- duckdb:::rel_join(
    rel34,
    rel35,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("p_partkey_x", rel34), duckdb:::expr_reference("p_partkey_y", rel35))
      ),
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("ps_supplycost_x", rel34), duckdb:::expr_reference("min_ps_supplycost_y", rel35))
      )
    ),
    "inner"
  )
  rel37 <- duckdb:::rel_project(
    rel36,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("p_partkey_x", rel34), duckdb:::expr_reference("p_partkey_y", rel35))
        )
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_supplycost_x", rel34), duckdb:::expr_reference("min_ps_supplycost_y", rel35))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr_x")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name_x")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal_x")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name_x")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address_x")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone_x")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel38 <- duckdb:::rel_project(
    rel37,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_order(
    rel38,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("s_acctbal"))), duckdb:::expr_reference("n_name"), duckdb:::expr_reference("s_name"), duckdb:::expr_reference("p_partkey"))
  )
  rel40 <- duckdb:::rel_limit(rel39, 100)
  rel40
  duckdb:::rel_to_altrep(rel40)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_03 <- function(con, experimental) {
  df1 <- orders
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-03-15", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-03-15")
              }
            )
          )
        )
      )
    )
  )
  df2 <- customer
  rel4 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel5 <- duckdb:::rel_project(
    rel4,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_filter(
    rel5,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("c_mktsegment"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("BUILDING", experimental = experimental)
          } else {
            duckdb:::expr_constant("BUILDING")
          }
        )
      )
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel3, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel6, "rhs")
  rel9 <- duckdb:::rel_join(
    rel7,
    rel8,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("o_custkey", rel7), duckdb:::expr_reference("c_custkey", rel8))
      )
    ),
    "inner"
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel7), duckdb:::expr_reference("c_custkey", rel8))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      }
    )
  )
  df3 <- lineitem
  rel12 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_filter(
    rel13,
    list(
      duckdb:::expr_function(
        ">",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-03-15", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-03-15")
              }
            )
          )
        )
      )
    )
  )
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_set_alias(rel15, "lhs")
  rel17 <- duckdb:::rel_set_alias(rel11, "rhs")
  rel18 <- duckdb:::rel_join(
    rel16,
    rel17,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("l_orderkey", rel16), duckdb:::expr_reference("o_orderkey", rel17))
      )
    ),
    "inner"
  )
  rel19 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel16), duckdb:::expr_reference("o_orderkey", rel17))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_aggregate(
    rel20,
    groups = list(duckdb:::expr_reference("l_orderkey"), duckdb:::expr_reference("o_orderdate"), duckdb:::expr_reference("o_shippriority")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_project(
    rel21,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_order(
    rel22,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("revenue"))), duckdb:::expr_reference("o_orderdate"))
  )
  rel24 <- duckdb:::rel_limit(rel23, 10)
  rel24
  duckdb:::rel_to_altrep(rel24)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_04 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "<",
        list(duckdb:::expr_reference("l_commitdate"), duckdb:::expr_reference("l_receiptdate"))
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      }
    )
  )
  df2 <- orders
  rel5 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_filter(
    rel6,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1993-07-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1993-07-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1993-10-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1993-10-01")
              }
            )
          )
        )
      )
    )
  )
  rel8 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_set_alias(rel4, "lhs")
  rel10 <- duckdb:::rel_set_alias(rel8, "rhs")
  rel11 <- duckdb:::rel_join(
    rel9,
    rel10,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel9), duckdb:::expr_reference("o_orderkey", rel10))
      )
    ),
    "inner"
  )
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel9), duckdb:::expr_reference("o_orderkey", rel10))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_distinct(rel12)
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_aggregate(
    rel14,
    groups = list(duckdb:::expr_reference("o_orderpriority")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "order_count")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_order(rel15, list(duckdb:::expr_reference("o_orderpriority")))
  rel16
  duckdb:::rel_to_altrep(rel16)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_05 <- function(con, experimental) {
  df1 <- nation
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df2 <- region
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_filter(
    rel4,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("r_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("ASIA", experimental = experimental)
          } else {
            duckdb:::expr_constant("ASIA")
          }
        )
      )
    )
  )
  rel6 <- duckdb:::rel_set_alias(rel2, "lhs")
  rel7 <- duckdb:::rel_set_alias(rel5, "rhs")
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("n_regionkey", rel6), duckdb:::expr_reference("r_regionkey", rel7))
      )
    ),
    "inner"
  )
  rel9 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("n_regionkey", rel6), duckdb:::expr_reference("r_regionkey", rel7))
        )
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df3 <- supplier
  rel11 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_set_alias(rel12, "lhs")
  rel14 <- duckdb:::rel_set_alias(rel10, "rhs")
  rel15 <- duckdb:::rel_join(
    rel13,
    rel14,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel13), duckdb:::expr_reference("n_nationkey", rel14))
      )
    ),
    "inner"
  )
  rel16 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel13), duckdb:::expr_reference("n_nationkey", rel14))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df4 <- lineitem
  rel18 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel19 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_set_alias(rel19, "lhs")
  rel21 <- duckdb:::rel_set_alias(rel17, "rhs")
  rel22 <- duckdb:::rel_join(
    rel20,
    rel21,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel20), duckdb:::expr_reference("s_suppkey", rel21))
      )
    ),
    "inner"
  )
  rel23 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel20), duckdb:::expr_reference("s_suppkey", rel21))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df5 <- orders
  rel24 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_filter(
    rel25,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      )
    )
  )
  rel27 <- duckdb:::rel_project(
    rel26,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  df6 <- customer
  rel28 <- duckdb:::rel_from_df(con, df6, experimental = experimental)
  rel29 <- duckdb:::rel_project(
    rel28,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_set_alias(rel27, "lhs")
  rel31 <- duckdb:::rel_set_alias(rel29, "rhs")
  rel32 <- duckdb:::rel_join(
    rel30,
    rel31,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_custkey", rel30), duckdb:::expr_reference("c_custkey", rel31))
      )
    ),
    "inner"
  )
  rel33 <- duckdb:::rel_project(
    rel32,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel30), duckdb:::expr_reference("c_custkey", rel31))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel34 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_set_alias(rel23, "lhs")
  rel36 <- duckdb:::rel_set_alias(rel34, "rhs")
  rel37 <- duckdb:::rel_join(
    rel35,
    rel36,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel35), duckdb:::expr_reference("o_orderkey", rel36))
      ),
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel35), duckdb:::expr_reference("c_nationkey", rel36))
      )
    ),
    "inner"
  )
  rel38 <- duckdb:::rel_project(
    rel37,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel35), duckdb:::expr_reference("o_orderkey", rel36))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel35), duckdb:::expr_reference("c_nationkey", rel36))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_project(
    rel38,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel40 <- duckdb:::rel_project(
    rel39,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel41 <- duckdb:::rel_aggregate(
    rel40,
    groups = list(duckdb:::expr_reference("n_name")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel42 <- duckdb:::rel_order(rel41, list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("revenue")))))
  rel42
  duckdb:::rel_to_altrep(rel42)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_06 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_discount"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(0.05, experimental = experimental)
          } else {
            duckdb:::expr_constant(0.05)
          }
        )
      ),
      duckdb:::expr_function(
        "<=",
        list(
          duckdb:::expr_reference("l_discount"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(0.07, experimental = experimental)
          } else {
            duckdb:::expr_constant(0.07)
          }
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_quantity"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(24, experimental = experimental)
          } else {
            duckdb:::expr_constant(24)
          }
        )
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_aggregate(
    rel4,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(duckdb:::expr_reference("l_extendedprice"), duckdb:::expr_reference("l_discount"))
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_distinct(rel5)
  rel6
  duckdb:::rel_to_altrep(rel6)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_07 <- function(con, experimental) {
  df1 <- supplier
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      }
    )
  )
  df2 <- nation
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_filter(
    rel4,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("n1_name"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("FRANCE", experimental = experimental)
              } else {
                duckdb:::expr_constant("FRANCE")
              }
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("n1_name"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("GERMANY", experimental = experimental)
              } else {
                duckdb:::expr_constant("GERMANY")
              }
            )
          )
        )
      )
    )
  )
  rel6 <- duckdb:::rel_set_alias(rel2, "lhs")
  rel7 <- duckdb:::rel_set_alias(rel5, "rhs")
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel6), duckdb:::expr_reference("n1_nationkey", rel7))
      )
    ),
    "inner"
  )
  rel9 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel6), duckdb:::expr_reference("n1_nationkey", rel7))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      }
    )
  )
  df3 <- customer
  rel11 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n2_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_filter(
    rel14,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("n2_name"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("FRANCE", experimental = experimental)
              } else {
                duckdb:::expr_constant("FRANCE")
              }
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("n2_name"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("GERMANY", experimental = experimental)
              } else {
                duckdb:::expr_constant("GERMANY")
              }
            )
          )
        )
      )
    )
  )
  rel16 <- duckdb:::rel_set_alias(rel12, "lhs")
  rel17 <- duckdb:::rel_set_alias(rel15, "rhs")
  rel18 <- duckdb:::rel_join(
    rel16,
    rel17,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_nationkey", rel16), duckdb:::expr_reference("n2_nationkey", rel17))
      )
    ),
    "inner"
  )
  rel19 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_nationkey", rel16), duckdb:::expr_reference("n2_nationkey", rel17))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  df4 <- orders
  rel21 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel22 <- duckdb:::rel_project(
    rel21,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_set_alias(rel22, "lhs")
  rel24 <- duckdb:::rel_set_alias(rel20, "rhs")
  rel25 <- duckdb:::rel_join(
    rel23,
    rel24,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_custkey", rel23), duckdb:::expr_reference("c_custkey", rel24))
      )
    ),
    "inner"
  )
  rel26 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel23), duckdb:::expr_reference("c_custkey", rel24))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel27 <- duckdb:::rel_project(
    rel26,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  df5 <- lineitem
  rel28 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel29 <- duckdb:::rel_project(
    rel28,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_filter(
    rel29,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1996-12-31", experimental = experimental)
              } else {
                duckdb:::expr_constant("1996-12-31")
              }
            )
          )
        )
      )
    )
  )
  rel31 <- duckdb:::rel_set_alias(rel30, "lhs")
  rel32 <- duckdb:::rel_set_alias(rel27, "rhs")
  rel33 <- duckdb:::rel_join(
    rel31,
    rel32,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel31), duckdb:::expr_reference("o_orderkey", rel32))
      )
    ),
    "inner"
  )
  rel34 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel31), duckdb:::expr_reference("o_orderkey", rel32))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_project(
    rel34,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel36 <- duckdb:::rel_set_alias(rel35, "lhs")
  rel37 <- duckdb:::rel_set_alias(rel10, "rhs")
  rel38 <- duckdb:::rel_join(
    rel36,
    rel37,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel36), duckdb:::expr_reference("s_suppkey", rel37))
      )
    ),
    "inner"
  )
  rel39 <- duckdb:::rel_project(
    rel38,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel36), duckdb:::expr_reference("s_suppkey", rel37))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      }
    )
  )
  rel40 <- duckdb:::rel_filter(
    rel39,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "&",
            list(
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("n1_name"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("FRANCE", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("FRANCE")
                  }
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("n2_name"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("GERMANY", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("GERMANY")
                  }
                )
              )
            )
          ),
          duckdb:::expr_function(
            "&",
            list(
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("n1_name"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("GERMANY", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("GERMANY")
                  }
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("n2_name"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("FRANCE", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("FRANCE")
                  }
                )
              )
            )
          )
        )
      )
    )
  )
  rel41 <- duckdb:::rel_project(
    rel40,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      }
    )
  )
  rel42 <- duckdb:::rel_project(
    rel41,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("supp_nation")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "cust_nation")
        tmp_expr
      }
    )
  )
  rel43 <- duckdb:::rel_project(
    rel42,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("supp_nation")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cust_nation")
        duckdb:::expr_set_alias(tmp_expr, "cust_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "as.integer",
          list(
            duckdb:::expr_function(
              "strftime",
              list(
                duckdb:::expr_reference("l_shipdate"),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant("%Y", experimental = experimental)
                } else {
                  duckdb:::expr_constant("%Y")
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "l_year")
        tmp_expr
      }
    )
  )
  rel44 <- duckdb:::rel_project(
    rel43,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("supp_nation")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cust_nation")
        duckdb:::expr_set_alias(tmp_expr, "cust_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_year")
        duckdb:::expr_set_alias(tmp_expr, "l_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel45 <- duckdb:::rel_project(
    rel44,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("supp_nation")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cust_nation")
        duckdb:::expr_set_alias(tmp_expr, "cust_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_year")
        duckdb:::expr_set_alias(tmp_expr, "l_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("volume")
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel46 <- duckdb:::rel_aggregate(
    rel45,
    groups = list(duckdb:::expr_reference("supp_nation"), duckdb:::expr_reference("cust_nation"), duckdb:::expr_reference("l_year")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel47 <- duckdb:::rel_order(
    rel46,
    list(duckdb:::expr_reference("supp_nation"), duckdb:::expr_reference("cust_nation"), duckdb:::expr_reference("l_year"))
  )
  rel47
  duckdb:::rel_to_altrep(rel47)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_08 <- function(con, experimental) {
  df1 <- nation
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_regionkey")
        tmp_expr
      }
    )
  )
  df2 <- region
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_filter(
    rel4,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("r_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("AMERICA", experimental = experimental)
          } else {
            duckdb:::expr_constant("AMERICA")
          }
        )
      )
    )
  )
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel2, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel6, "rhs")
  rel9 <- duckdb:::rel_join(
    rel7,
    rel8,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("n1_regionkey", rel7), duckdb:::expr_reference("r_regionkey", rel8))
      )
    ),
    "inner"
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n1_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("n1_regionkey", rel7), duckdb:::expr_reference("r_regionkey", rel8))
        )
        duckdb:::expr_set_alias(tmp_expr, "n1_regionkey")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n1_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      }
    )
  )
  df3 <- customer
  rel12 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_set_alias(rel13, "lhs")
  rel15 <- duckdb:::rel_set_alias(rel11, "rhs")
  rel16 <- duckdb:::rel_join(
    rel14,
    rel15,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_nationkey", rel14), duckdb:::expr_reference("n1_nationkey", rel15))
      )
    ),
    "inner"
  )
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_nationkey", rel14), duckdb:::expr_reference("n1_nationkey", rel15))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      }
    )
  )
  df4 <- orders
  rel19 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_filter(
    rel20,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1996-12-31", experimental = experimental)
              } else {
                duckdb:::expr_constant("1996-12-31")
              }
            )
          )
        )
      )
    )
  )
  rel22 <- duckdb:::rel_set_alias(rel21, "lhs")
  rel23 <- duckdb:::rel_set_alias(rel18, "rhs")
  rel24 <- duckdb:::rel_join(
    rel22,
    rel23,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_custkey", rel22), duckdb:::expr_reference("c_custkey", rel23))
      )
    ),
    "inner"
  )
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel22), duckdb:::expr_reference("c_custkey", rel23))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  df5 <- lineitem
  rel27 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel28 <- duckdb:::rel_project(
    rel27,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel29 <- duckdb:::rel_set_alias(rel28, "lhs")
  rel30 <- duckdb:::rel_set_alias(rel26, "rhs")
  rel31 <- duckdb:::rel_join(
    rel29,
    rel30,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel29), duckdb:::expr_reference("o_orderkey", rel30))
      )
    ),
    "inner"
  )
  rel32 <- duckdb:::rel_project(
    rel31,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel29), duckdb:::expr_reference("o_orderkey", rel30))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel33 <- duckdb:::rel_project(
    rel32,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  df6 <- part
  rel34 <- duckdb:::rel_from_df(con, df6, experimental = experimental)
  rel35 <- duckdb:::rel_project(
    rel34,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      }
    )
  )
  rel36 <- duckdb:::rel_filter(
    rel35,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("p_type"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("ECONOMY ANODIZED STEEL", experimental = experimental)
          } else {
            duckdb:::expr_constant("ECONOMY ANODIZED STEEL")
          }
        )
      )
    )
  )
  rel37 <- duckdb:::rel_project(
    rel36,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      }
    )
  )
  rel38 <- duckdb:::rel_set_alias(rel33, "lhs")
  rel39 <- duckdb:::rel_set_alias(rel37, "rhs")
  rel40 <- duckdb:::rel_join(
    rel38,
    rel39,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel38), duckdb:::expr_reference("p_partkey", rel39))
      )
    ),
    "inner"
  )
  rel41 <- duckdb:::rel_project(
    rel40,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel38), duckdb:::expr_reference("p_partkey", rel39))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel42 <- duckdb:::rel_project(
    rel41,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  df7 <- supplier
  rel43 <- duckdb:::rel_from_df(con, df7, experimental = experimental)
  rel44 <- duckdb:::rel_project(
    rel43,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  rel45 <- duckdb:::rel_set_alias(rel42, "lhs")
  rel46 <- duckdb:::rel_set_alias(rel44, "rhs")
  rel47 <- duckdb:::rel_join(
    rel45,
    rel46,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel45), duckdb:::expr_reference("s_suppkey", rel46))
      )
    ),
    "inner"
  )
  rel48 <- duckdb:::rel_project(
    rel47,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel45), duckdb:::expr_reference("s_suppkey", rel46))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  rel49 <- duckdb:::rel_project(
    rel48,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  rel50 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel51 <- duckdb:::rel_project(
    rel50,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n2_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel52 <- duckdb:::rel_set_alias(rel49, "lhs")
  rel53 <- duckdb:::rel_set_alias(rel51, "rhs")
  rel54 <- duckdb:::rel_join(
    rel52,
    rel53,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel52), duckdb:::expr_reference("n2_nationkey", rel53))
      )
    ),
    "inner"
  )
  rel55 <- duckdb:::rel_project(
    rel54,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel52), duckdb:::expr_reference("n2_nationkey", rel53))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel56 <- duckdb:::rel_project(
    rel55,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel57 <- duckdb:::rel_project(
    rel56,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "as.integer",
          list(
            duckdb:::expr_function(
              "strftime",
              list(
                duckdb:::expr_reference("o_orderdate"),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant("%Y", experimental = experimental)
                } else {
                  duckdb:::expr_constant("%Y")
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      }
    )
  )
  rel58 <- duckdb:::rel_project(
    rel57,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel59 <- duckdb:::rel_project(
    rel58,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("volume")
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      }
    )
  )
  rel60 <- duckdb:::rel_project(
    rel59,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("volume")
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("nation")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      }
    )
  )
  rel61 <- duckdb:::rel_aggregate(
    rel60,
    groups = list(duckdb:::expr_reference("o_year")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "/",
          list(
            duckdb:::expr_function(
              "sum",
              list(
                duckdb:::expr_function(
                  "ifelse",
                  list(
                    duckdb:::expr_function(
                      "==",
                      list(
                        duckdb:::expr_reference("nation"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("BRAZIL", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("BRAZIL")
                        }
                      )
                    ),
                    duckdb:::expr_reference("volume"),
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(0, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(0)
                    }
                  )
                )
              )
            ),
            duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "mkt_share")
        tmp_expr
      }
    )
  )
  rel62 <- duckdb:::rel_order(rel61, list(duckdb:::expr_reference("o_year")))
  rel62
  duckdb:::rel_to_altrep(rel62)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_09 <- function(con, experimental) {
  df1 <- part
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "grepl",
        list(
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("green", experimental = experimental)
          } else {
            duckdb:::expr_constant("green")
          },
          duckdb:::expr_reference("p_name")
        )
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      }
    )
  )
  df2 <- partsupp
  rel5 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel6, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel9 <- duckdb:::rel_join(
    rel7,
    rel8,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_partkey", rel7), duckdb:::expr_reference("p_partkey", rel8))
      )
    ),
    "inner"
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_partkey", rel7), duckdb:::expr_reference("p_partkey", rel8))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      }
    )
  )
  df3 <- supplier
  rel11 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  df4 <- nation
  rel13 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_set_alias(rel12, "lhs")
  rel16 <- duckdb:::rel_set_alias(rel14, "rhs")
  rel17 <- duckdb:::rel_join(
    rel15,
    rel16,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel15), duckdb:::expr_reference("n_nationkey", rel16))
      )
    ),
    "inner"
  )
  rel18 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel15), duckdb:::expr_reference("n_nationkey", rel16))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel19 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_set_alias(rel10, "lhs")
  rel21 <- duckdb:::rel_set_alias(rel19, "rhs")
  rel22 <- duckdb:::rel_join(
    rel20,
    rel21,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel20), duckdb:::expr_reference("s_suppkey", rel21))
      )
    ),
    "inner"
  )
  rel23 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel20), duckdb:::expr_reference("s_suppkey", rel21))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df5 <- lineitem
  rel24 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_set_alias(rel25, "lhs")
  rel27 <- duckdb:::rel_set_alias(rel23, "rhs")
  rel28 <- duckdb:::rel_join(
    rel26,
    rel27,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel26), duckdb:::expr_reference("ps_suppkey", rel27))
      ),
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel26), duckdb:::expr_reference("ps_partkey", rel27))
      )
    ),
    "inner"
  )
  rel29 <- duckdb:::rel_project(
    rel28,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel26), duckdb:::expr_reference("ps_suppkey", rel27))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel26), duckdb:::expr_reference("ps_partkey", rel27))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_project(
    rel29,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df6 <- orders
  rel31 <- duckdb:::rel_from_df(con, df6, experimental = experimental)
  rel32 <- duckdb:::rel_project(
    rel31,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel33 <- duckdb:::rel_set_alias(rel32, "lhs")
  rel34 <- duckdb:::rel_set_alias(rel30, "rhs")
  rel35 <- duckdb:::rel_join(
    rel33,
    rel34,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_orderkey", rel33), duckdb:::expr_reference("l_orderkey", rel34))
      )
    ),
    "inner"
  )
  rel36 <- duckdb:::rel_project(
    rel35,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_orderkey", rel33), duckdb:::expr_reference("l_orderkey", rel34))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel37 <- duckdb:::rel_project(
    rel36,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel38 <- duckdb:::rel_project(
    rel37,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_project(
    rel38,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("nation")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "as.integer",
          list(
            duckdb:::expr_function(
              "strftime",
              list(
                duckdb:::expr_reference("o_orderdate"),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant("%Y", experimental = experimental)
                } else {
                  duckdb:::expr_constant("%Y")
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      }
    )
  )
  rel40 <- duckdb:::rel_project(
    rel39,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("nation")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "-",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_reference("l_extendedprice"),
                duckdb:::expr_function(
                  "-",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_discount")
                  )
                )
              )
            ),
            duckdb:::expr_function(
              "*",
              list(duckdb:::expr_reference("ps_supplycost"), duckdb:::expr_reference("l_quantity"))
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "amount")
        tmp_expr
      }
    )
  )
  rel41 <- duckdb:::rel_project(
    rel40,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("nation")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("amount")
        duckdb:::expr_set_alias(tmp_expr, "amount")
        tmp_expr
      }
    )
  )
  rel42 <- duckdb:::rel_aggregate(
    rel41,
    groups = list(duckdb:::expr_reference("nation"), duckdb:::expr_reference("o_year")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("amount")))
        duckdb:::expr_set_alias(tmp_expr, "sum_profit")
        tmp_expr
      }
    )
  )
  rel43 <- duckdb:::rel_order(
    rel42,
    list(duckdb:::expr_reference("nation"), duckdb:::expr_function("desc", list(duckdb:::expr_reference("o_year"))))
  )
  rel43
  duckdb:::rel_to_altrep(rel43)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_10 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("l_returnflag"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("R", experimental = experimental)
          } else {
            duckdb:::expr_constant("R")
          }
        )
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  df2 <- orders
  rel5 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_filter(
    rel6,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1993-10-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1993-10-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      )
    )
  )
  rel8 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_set_alias(rel4, "lhs")
  rel10 <- duckdb:::rel_set_alias(rel8, "rhs")
  rel11 <- duckdb:::rel_join(
    rel9,
    rel10,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel9), duckdb:::expr_reference("o_orderkey", rel10))
      )
    ),
    "inner"
  )
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel9), duckdb:::expr_reference("o_orderkey", rel10))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_aggregate(
    rel14,
    groups = list(duckdb:::expr_reference("o_custkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  df3 <- customer
  rel16 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_set_alias(rel17, "lhs")
  rel19 <- duckdb:::rel_set_alias(rel15, "rhs")
  rel20 <- duckdb:::rel_join(
    rel18,
    rel19,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_custkey", rel18), duckdb:::expr_reference("o_custkey", rel19))
      )
    ),
    "inner"
  )
  rel21 <- duckdb:::rel_project(
    rel20,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_custkey", rel18), duckdb:::expr_reference("o_custkey", rel19))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  df4 <- nation
  rel22 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel23 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel24 <- duckdb:::rel_set_alias(rel21, "lhs")
  rel25 <- duckdb:::rel_set_alias(rel23, "rhs")
  rel26 <- duckdb:::rel_join(
    rel24,
    rel25,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_nationkey", rel24), duckdb:::expr_reference("n_nationkey", rel25))
      )
    ),
    "inner"
  )
  rel27 <- duckdb:::rel_project(
    rel26,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_nationkey", rel24), duckdb:::expr_reference("n_nationkey", rel25))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel28 <- duckdb:::rel_project(
    rel27,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      }
    )
  )
  rel29 <- duckdb:::rel_order(rel28, list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("revenue")))))
  rel30 <- duckdb:::rel_limit(rel29, 20)
  rel30
  duckdb:::rel_to_altrep(rel30)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_11 <- function(con, experimental) {
  df1 <- nation
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("n_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("GERMANY", experimental = experimental)
          } else {
            duckdb:::expr_constant("GERMANY")
          }
        )
      )
    )
  )
  df2 <- partsupp
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "lhs")
  df3 <- supplier
  rel5 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel6 <- duckdb:::rel_set_alias(rel5, "rhs")
  rel7 <- duckdb:::rel_join(
    rel4,
    rel6,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel4), duckdb:::expr_reference("s_suppkey", rel6))
      )
    ),
    "inner"
  )
  rel8 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel4), duckdb:::expr_reference("s_suppkey", rel6))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_set_alias(rel8, "lhs")
  rel10 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel11 <- duckdb:::rel_join(
    rel9,
    rel10,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel9), duckdb:::expr_reference("n_nationkey", rel10))
      )
    ),
    "inner"
  )
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel9), duckdb:::expr_reference("n_nationkey", rel10))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_aggregate(
    rel12,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_function(
              "sum",
              list(
                duckdb:::expr_function(
                  "*",
                  list(duckdb:::expr_reference("ps_supplycost"), duckdb:::expr_reference("ps_availqty"))
                )
              )
            ),
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(1e-04, experimental = experimental)
            } else {
              duckdb:::expr_constant(1e-04)
            }
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "global_value")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_distinct(rel13)
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("global_value")
        duckdb:::expr_set_alias(tmp_expr, "global_value")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_aggregate(
    rel12,
    groups = list(duckdb:::expr_reference("ps_partkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(duckdb:::expr_reference("ps_supplycost"), duckdb:::expr_reference("ps_availqty"))
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "value")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value")
        duckdb:::expr_set_alias(tmp_expr, "value")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_set_alias(rel17, "lhs")
  rel19 <- duckdb:::rel_set_alias(rel15, "rhs")
  rel20 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value")
        duckdb:::expr_set_alias(tmp_expr, "value_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_x")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("global_value")
        duckdb:::expr_set_alias(tmp_expr, "global_value_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_y")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_join(
    rel20,
    rel21,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("global_agr_key_x", rel20), duckdb:::expr_reference("global_agr_key_y", rel21))
      )
    ),
    "inner"
  )
  rel23 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey_x")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value_x")
        duckdb:::expr_set_alias(tmp_expr, "value")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("global_agr_key_x", rel20), duckdb:::expr_reference("global_agr_key_y", rel21))
        )
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_value_y")
        duckdb:::expr_set_alias(tmp_expr, "global_value")
        tmp_expr
      }
    )
  )
  rel24 <- duckdb:::rel_filter(
    rel23,
    list(
      duckdb:::expr_function(">", list(duckdb:::expr_reference("value"), duckdb:::expr_reference("global_value")))
    )
  )
  rel25 <- duckdb:::rel_order(rel24, list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("value")))))
  rel26 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value")
        duckdb:::expr_set_alias(tmp_expr, "value")
        tmp_expr
      }
    )
  )
  rel26
  duckdb:::rel_to_altrep(rel26)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_12 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "==",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("MAIL", experimental = experimental)
              } else {
                duckdb:::expr_constant("MAIL")
              },
              duckdb:::expr_reference("l_shipmode")
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("SHIP", experimental = experimental)
              } else {
                duckdb:::expr_constant("SHIP")
              },
              duckdb:::expr_reference("l_shipmode")
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(duckdb:::expr_reference("l_commitdate"), duckdb:::expr_reference("l_receiptdate"))
      ),
      duckdb:::expr_function(
        "<",
        list(duckdb:::expr_reference("l_shipdate"), duckdb:::expr_reference("l_commitdate"))
      ),
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_receiptdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_receiptdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      )
    )
  )
  rel3 <- duckdb:::rel_set_alias(rel2, "lhs")
  df2 <- orders
  rel4 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel5 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel6 <- duckdb:::rel_join(
    rel3,
    rel5,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel3), duckdb:::expr_reference("o_orderkey", rel5))
      )
    ),
    "inner"
  )
  rel7 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel3), duckdb:::expr_reference("o_orderkey", rel5))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_aggregate(
    rel7,
    groups = list(duckdb:::expr_reference("l_shipmode")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "ifelse",
              list(
                duckdb:::expr_function(
                  "|",
                  list(
                    duckdb:::expr_function(
                      "==",
                      list(
                        duckdb:::expr_reference("o_orderpriority"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("1-URGENT", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("1-URGENT")
                        }
                      )
                    ),
                    duckdb:::expr_function(
                      "==",
                      list(
                        duckdb:::expr_reference("o_orderpriority"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("2-HIGH", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("2-HIGH")
                        }
                      )
                    )
                  )
                ),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1L)
                },
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(0L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(0L)
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "high_line_count")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "ifelse",
              list(
                duckdb:::expr_function(
                  "&",
                  list(
                    duckdb:::expr_function(
                      "!=",
                      list(
                        duckdb:::expr_reference("o_orderpriority"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("1-URGENT", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("1-URGENT")
                        }
                      )
                    ),
                    duckdb:::expr_function(
                      "!=",
                      list(
                        duckdb:::expr_reference("o_orderpriority"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("2-HIGH", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("2-HIGH")
                        }
                      )
                    )
                  )
                ),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1L)
                },
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(0L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(0L)
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "low_line_count")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_order(rel8, list(duckdb:::expr_reference("l_shipmode")))
  rel9
  duckdb:::rel_to_altrep(rel9)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_13 <- function(con, experimental) {
  df1 <- orders
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "!",
        list(
          duckdb:::expr_function(
            "grepl",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("special.*?requests", experimental = experimental)
              } else {
                duckdb:::expr_constant("special.*?requests")
              },
              duckdb:::expr_reference("o_comment")
            )
          )
        )
      )
    )
  )
  df2 <- customer
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "lhs")
  rel5 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel6 <- duckdb:::rel_join(
    rel4,
    rel5,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_custkey", rel4), duckdb:::expr_reference("o_custkey", rel5))
      )
    ),
    "left"
  )
  rel7 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_custkey", rel4), duckdb:::expr_reference("o_custkey", rel5))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_aggregate(
    rel7,
    groups = list(duckdb:::expr_reference("c_custkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "ifelse",
              list(
                duckdb:::expr_function("is.na", list(duckdb:::expr_reference("o_orderkey"))),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(0L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(0L)
                },
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1L)
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "c_count")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_aggregate(
    rel8,
    groups = list(duckdb:::expr_reference("c_count")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "custdist")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_order(
    rel9,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("custdist"))), duckdb:::expr_function("desc", list(duckdb:::expr_reference("c_count"))))
  )
  rel10
  duckdb:::rel_to_altrep(rel10)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_14 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-09-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-09-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-10-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-10-01")
              }
            )
          )
        )
      )
    )
  )
  rel3 <- duckdb:::rel_set_alias(rel2, "lhs")
  df2 <- part
  rel4 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel5 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel6 <- duckdb:::rel_join(
    rel3,
    rel5,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel3), duckdb:::expr_reference("p_partkey", rel5))
      )
    ),
    "inner"
  )
  rel7 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel3), duckdb:::expr_reference("p_partkey", rel5))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_aggregate(
    rel7,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "/",
          list(
            duckdb:::expr_function(
              "*",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(100, experimental = experimental)
                } else {
                  duckdb:::expr_constant(100)
                },
                duckdb:::expr_function(
                  "sum",
                  list(
                    duckdb:::expr_function(
                      "ifelse",
                      list(
                        duckdb:::expr_function(
                          "grepl",
                          list(
                            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                              duckdb:::expr_constant("^PROMO", experimental = experimental)
                            } else {
                              duckdb:::expr_constant("^PROMO")
                            },
                            duckdb:::expr_reference("p_type")
                          )
                        ),
                        duckdb:::expr_function(
                          "*",
                          list(
                            duckdb:::expr_reference("l_extendedprice"),
                            duckdb:::expr_function(
                              "-",
                              list(
                                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                  duckdb:::expr_constant(1, experimental = experimental)
                                } else {
                                  duckdb:::expr_constant(1)
                                },
                                duckdb:::expr_reference("l_discount")
                              )
                            )
                          )
                        ),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant(0, experimental = experimental)
                        } else {
                          duckdb:::expr_constant(0)
                        }
                      )
                    )
                  )
                )
              )
            ),
            duckdb:::expr_function(
              "sum",
              list(
                duckdb:::expr_function(
                  "*",
                  list(
                    duckdb:::expr_reference("l_extendedprice"),
                    duckdb:::expr_function(
                      "-",
                      list(
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant(1, experimental = experimental)
                        } else {
                          duckdb:::expr_constant(1)
                        },
                        duckdb:::expr_reference("l_discount")
                      )
                    )
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "promo_revenue")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_distinct(rel8)
  rel9
  duckdb:::rel_to_altrep(rel9)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_15 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1996-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1996-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1996-04-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1996-04-01")
              }
            )
          )
        )
      )
    )
  )
  rel3 <- duckdb:::rel_aggregate(
    rel2,
    groups = list(duckdb:::expr_reference("l_suppkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_reference("l_extendedprice"),
                duckdb:::expr_function(
                  "-",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_discount")
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      }
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_aggregate(
    rel4,
    groups = list(duckdb:::expr_reference("global_agr_key")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("max", list(duckdb:::expr_reference("total_revenue")))
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel6, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel5, "rhs")
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_x")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("max_total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue_y")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_join(
    rel9,
    rel10,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("global_agr_key_x", rel9), duckdb:::expr_reference("global_agr_key_y", rel10))
      )
    ),
    "inner"
  )
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue_x")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("global_agr_key_x", rel9), duckdb:::expr_reference("global_agr_key_y", rel10))
        )
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("max_total_revenue_y")
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_filter(
    rel12,
    list(
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_function(
            "abs",
            list(
              duckdb:::expr_function(
                "-",
                list(duckdb:::expr_reference("total_revenue"), duckdb:::expr_reference("max_total_revenue"))
              )
            )
          ),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(1e-09, experimental = experimental)
          } else {
            duckdb:::expr_constant(1e-09)
          }
        )
      )
    )
  )
  rel14 <- duckdb:::rel_set_alias(rel13, "lhs")
  df2 <- supplier
  rel15 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel16 <- duckdb:::rel_set_alias(rel15, "rhs")
  rel17 <- duckdb:::rel_join(
    rel14,
    rel16,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel14), duckdb:::expr_reference("s_suppkey", rel16))
      )
    ),
    "inner"
  )
  rel18 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel14), duckdb:::expr_reference("s_suppkey", rel16))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("max_total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel19 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      }
    )
  )
  rel19
  duckdb:::rel_to_altrep(rel19)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_16 <- function(con, experimental) {
  df1 <- part
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "!=",
        list(
          duckdb:::expr_reference("p_brand"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("Brand#45", experimental = experimental)
          } else {
            duckdb:::expr_constant("Brand#45")
          }
        )
      ),
      duckdb:::expr_function(
        "!",
        list(
          duckdb:::expr_function(
            "grepl",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("^MEDIUM POLISHED", experimental = experimental)
              } else {
                duckdb:::expr_constant("^MEDIUM POLISHED")
              },
              duckdb:::expr_reference("p_type")
            )
          )
        )
      ),
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "|",
            list(
              duckdb:::expr_function(
                "|",
                list(
                  duckdb:::expr_function(
                    "|",
                    list(
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "|",
                            list(
                              duckdb:::expr_function(
                                "|",
                                list(
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(49, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(49)
                                      },
                                      duckdb:::expr_reference("p_size")
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(14, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(14)
                                      },
                                      duckdb:::expr_reference("p_size")
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                "==",
                                list(
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(23, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(23)
                                  },
                                  duckdb:::expr_reference("p_size")
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(45, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(45)
                              },
                              duckdb:::expr_reference("p_size")
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant(19, experimental = experimental)
                          } else {
                            duckdb:::expr_constant(19)
                          },
                          duckdb:::expr_reference("p_size")
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant(3, experimental = experimental)
                      } else {
                        duckdb:::expr_constant(3)
                      },
                      duckdb:::expr_reference("p_size")
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant(36, experimental = experimental)
                  } else {
                    duckdb:::expr_constant(36)
                  },
                  duckdb:::expr_reference("p_size")
                )
              )
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant(9, experimental = experimental)
              } else {
                duckdb:::expr_constant(9)
              },
              duckdb:::expr_reference("p_size")
            )
          )
        )
      )
    )
  )
  df2 <- supplier
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_filter(
    rel3,
    list(
      duckdb:::expr_function(
        "!",
        list(
          duckdb:::expr_function(
            "grepl",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("Customer.*?Complaints", experimental = experimental)
              } else {
                duckdb:::expr_constant("Customer.*?Complaints")
              },
              duckdb:::expr_reference("s_comment")
            )
          )
        )
      )
    )
  )
  df3 <- partsupp
  rel5 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel6 <- duckdb:::rel_set_alias(rel5, "lhs")
  rel7 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel6), duckdb:::expr_reference("s_suppkey", rel7))
      )
    ),
    "inner"
  )
  rel9 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel6), duckdb:::expr_reference("s_suppkey", rel7))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_set_alias(rel2, "lhs")
  rel12 <- duckdb:::rel_set_alias(rel10, "rhs")
  rel13 <- duckdb:::rel_join(
    rel11,
    rel12,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("p_partkey", rel11), duckdb:::expr_reference("ps_partkey", rel12))
      )
    ),
    "inner"
  )
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("p_partkey", rel11), duckdb:::expr_reference("ps_partkey", rel12))
        )
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_aggregate(
    rel14,
    groups = list(duckdb:::expr_reference("p_brand"), duckdb:::expr_reference("p_type"), duckdb:::expr_reference("p_size")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n_distinct", list(duckdb:::expr_reference("ps_suppkey")))
        duckdb:::expr_set_alias(tmp_expr, "supplier_cnt")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("supplier_cnt")
        duckdb:::expr_set_alias(tmp_expr, "supplier_cnt")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_order(
    rel16,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("supplier_cnt"))), duckdb:::expr_reference("p_brand"), duckdb:::expr_reference("p_type"), duckdb:::expr_reference("p_size"))
  )
  rel17
  duckdb:::rel_to_altrep(rel17)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_17 <- function(con, experimental) {
  df1 <- part
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("p_brand"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("Brand#23", experimental = experimental)
          } else {
            duckdb:::expr_constant("Brand#23")
          }
        )
      ),
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("p_container"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("MED BOX", experimental = experimental)
          } else {
            duckdb:::expr_constant("MED BOX")
          }
        )
      )
    )
  )
  df2 <- lineitem
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "lhs")
  rel5 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel6 <- duckdb:::rel_join(
    rel4,
    rel5,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel4), duckdb:::expr_reference("p_partkey", rel5))
      )
    ),
    "inner"
  )
  rel7 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel4), duckdb:::expr_reference("p_partkey", rel5))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_aggregate(
    rel7,
    groups = list(duckdb:::expr_reference("l_partkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(0.2, experimental = experimental)
            } else {
              duckdb:::expr_constant(0.2)
            },
            duckdb:::expr_function("mean", list(duckdb:::expr_reference("l_quantity")))
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "quantity_threshold")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_set_alias(rel7, "lhs")
  rel10 <- duckdb:::rel_set_alias(rel8, "rhs")
  rel11 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment_x")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("quantity_threshold")
        duckdb:::expr_set_alias(tmp_expr, "quantity_threshold_y")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_join(
    rel11,
    rel12,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey_x", rel11), duckdb:::expr_reference("l_partkey_y", rel12))
      )
    ),
    "inner"
  )
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey_x", rel11), duckdb:::expr_reference("l_partkey_y", rel12))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber_x")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity_x")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice_x")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount_x")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax_x")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag_x")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus_x")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name_x")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr_x")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand_x")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type_x")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size_x")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container_x")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice_x")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("quantity_threshold_y")
        duckdb:::expr_set_alias(tmp_expr, "quantity_threshold")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_filter(
    rel14,
    list(
      duckdb:::expr_function(
        "<",
        list(duckdb:::expr_reference("l_quantity"), duckdb:::expr_reference("quantity_threshold"))
      )
    )
  )
  rel16 <- duckdb:::rel_aggregate(
    rel15,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "/",
          list(
            duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_extendedprice"))),
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(7, experimental = experimental)
            } else {
              duckdb:::expr_constant(7)
            }
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "avg_yearly")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_distinct(rel16)
  rel17
  duckdb:::rel_to_altrep(rel17)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_18 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_aggregate(
    rel1,
    groups = list(duckdb:::expr_reference("l_orderkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_quantity")))
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        ">",
        list(
          duckdb:::expr_reference("sum"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(300, experimental = experimental)
          } else {
            duckdb:::expr_constant(300)
          }
        )
      )
    )
  )
  df2 <- orders
  rel4 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel5 <- duckdb:::rel_set_alias(rel4, "lhs")
  rel6 <- duckdb:::rel_set_alias(rel3, "rhs")
  rel7 <- duckdb:::rel_join(
    rel5,
    rel6,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_orderkey", rel5), duckdb:::expr_reference("l_orderkey", rel6))
      )
    ),
    "inner"
  )
  rel8 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_orderkey", rel5), duckdb:::expr_reference("l_orderkey", rel6))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("sum")
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_set_alias(rel8, "lhs")
  df3 <- customer
  rel10 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel11 <- duckdb:::rel_set_alias(rel10, "rhs")
  rel12 <- duckdb:::rel_join(
    rel9,
    rel11,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_custkey", rel9), duckdb:::expr_reference("c_custkey", rel11))
      )
    ),
    "inner"
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel9), duckdb:::expr_reference("c_custkey", rel11))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("sum")
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("sum")
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_order(
    rel14,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("o_totalprice"))), duckdb:::expr_reference("o_orderdate"))
  )
  rel16 <- duckdb:::rel_limit(rel15, 100)
  rel16
  duckdb:::rel_to_altrep(rel16)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_19 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_set_alias(rel1, "lhs")
  df2 <- part
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "rhs")
  rel5 <- duckdb:::rel_join(
    rel2,
    rel4,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel2), duckdb:::expr_reference("p_partkey", rel4))
      )
    ),
    "inner"
  )
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel2), duckdb:::expr_reference("p_partkey", rel4))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_filter(
    rel6,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "|",
            list(
              duckdb:::expr_function(
                "&",
                list(
                  duckdb:::expr_function(
                    "&",
                    list(
                      duckdb:::expr_function(
                        "&",
                        list(
                          duckdb:::expr_function(
                            "&",
                            list(
                              duckdb:::expr_function(
                                "&",
                                list(
                                  duckdb:::expr_function(
                                    "&",
                                    list(
                                      duckdb:::expr_function(
                                        "&",
                                        list(
                                          duckdb:::expr_function(
                                            "==",
                                            list(
                                              duckdb:::expr_reference("p_brand"),
                                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                duckdb:::expr_constant("Brand#12", experimental = experimental)
                                              } else {
                                                duckdb:::expr_constant("Brand#12")
                                              }
                                            )
                                          ),
                                          duckdb:::expr_function(
                                            "|",
                                            list(
                                              duckdb:::expr_function(
                                                "|",
                                                list(
                                                  duckdb:::expr_function(
                                                    "|",
                                                    list(
                                                      duckdb:::expr_function(
                                                        "==",
                                                        list(
                                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                            duckdb:::expr_constant("SM CASE", experimental = experimental)
                                                          } else {
                                                            duckdb:::expr_constant("SM CASE")
                                                          },
                                                          duckdb:::expr_reference("p_container")
                                                        )
                                                      ),
                                                      duckdb:::expr_function(
                                                        "==",
                                                        list(
                                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                            duckdb:::expr_constant("SM BOX", experimental = experimental)
                                                          } else {
                                                            duckdb:::expr_constant("SM BOX")
                                                          },
                                                          duckdb:::expr_reference("p_container")
                                                        )
                                                      )
                                                    )
                                                  ),
                                                  duckdb:::expr_function(
                                                    "==",
                                                    list(
                                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                        duckdb:::expr_constant("SM PACK", experimental = experimental)
                                                      } else {
                                                        duckdb:::expr_constant("SM PACK")
                                                      },
                                                      duckdb:::expr_reference("p_container")
                                                    )
                                                  )
                                                )
                                              ),
                                              duckdb:::expr_function(
                                                "==",
                                                list(
                                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                    duckdb:::expr_constant("SM PKG", experimental = experimental)
                                                  } else {
                                                    duckdb:::expr_constant("SM PKG")
                                                  },
                                                  duckdb:::expr_reference("p_container")
                                                )
                                              )
                                            )
                                          )
                                        )
                                      ),
                                      duckdb:::expr_function(
                                        ">=",
                                        list(
                                          duckdb:::expr_reference("l_quantity"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(1, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(1)
                                          }
                                        )
                                      )
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "<=",
                                    list(
                                      duckdb:::expr_reference("l_quantity"),
                                      duckdb:::expr_function(
                                        "+",
                                        list(
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(1, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(1)
                                          },
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(10, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(10)
                                          }
                                        )
                                      )
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                ">=",
                                list(
                                  duckdb:::expr_reference("p_size"),
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(1, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(1)
                                  }
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "<=",
                            list(
                              duckdb:::expr_reference("p_size"),
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(5, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(5)
                              }
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("AIR", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("AIR")
                              },
                              duckdb:::expr_reference("l_shipmode")
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("AIR REG", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("AIR REG")
                              },
                              duckdb:::expr_reference("l_shipmode")
                            )
                          )
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      duckdb:::expr_reference("l_shipinstruct"),
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant("DELIVER IN PERSON", experimental = experimental)
                      } else {
                        duckdb:::expr_constant("DELIVER IN PERSON")
                      }
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "&",
                list(
                  duckdb:::expr_function(
                    "&",
                    list(
                      duckdb:::expr_function(
                        "&",
                        list(
                          duckdb:::expr_function(
                            "&",
                            list(
                              duckdb:::expr_function(
                                "&",
                                list(
                                  duckdb:::expr_function(
                                    "&",
                                    list(
                                      duckdb:::expr_function(
                                        "&",
                                        list(
                                          duckdb:::expr_function(
                                            "==",
                                            list(
                                              duckdb:::expr_reference("p_brand"),
                                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                duckdb:::expr_constant("Brand#23", experimental = experimental)
                                              } else {
                                                duckdb:::expr_constant("Brand#23")
                                              }
                                            )
                                          ),
                                          duckdb:::expr_function(
                                            "|",
                                            list(
                                              duckdb:::expr_function(
                                                "|",
                                                list(
                                                  duckdb:::expr_function(
                                                    "|",
                                                    list(
                                                      duckdb:::expr_function(
                                                        "==",
                                                        list(
                                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                            duckdb:::expr_constant("MED BAG", experimental = experimental)
                                                          } else {
                                                            duckdb:::expr_constant("MED BAG")
                                                          },
                                                          duckdb:::expr_reference("p_container")
                                                        )
                                                      ),
                                                      duckdb:::expr_function(
                                                        "==",
                                                        list(
                                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                            duckdb:::expr_constant("MED BOX", experimental = experimental)
                                                          } else {
                                                            duckdb:::expr_constant("MED BOX")
                                                          },
                                                          duckdb:::expr_reference("p_container")
                                                        )
                                                      )
                                                    )
                                                  ),
                                                  duckdb:::expr_function(
                                                    "==",
                                                    list(
                                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                        duckdb:::expr_constant("MED PKG", experimental = experimental)
                                                      } else {
                                                        duckdb:::expr_constant("MED PKG")
                                                      },
                                                      duckdb:::expr_reference("p_container")
                                                    )
                                                  )
                                                )
                                              ),
                                              duckdb:::expr_function(
                                                "==",
                                                list(
                                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                    duckdb:::expr_constant("MED PACK", experimental = experimental)
                                                  } else {
                                                    duckdb:::expr_constant("MED PACK")
                                                  },
                                                  duckdb:::expr_reference("p_container")
                                                )
                                              )
                                            )
                                          )
                                        )
                                      ),
                                      duckdb:::expr_function(
                                        ">=",
                                        list(
                                          duckdb:::expr_reference("l_quantity"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(10, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(10)
                                          }
                                        )
                                      )
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "<=",
                                    list(
                                      duckdb:::expr_reference("l_quantity"),
                                      duckdb:::expr_function(
                                        "+",
                                        list(
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(10, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(10)
                                          },
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(10, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(10)
                                          }
                                        )
                                      )
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                ">=",
                                list(
                                  duckdb:::expr_reference("p_size"),
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(1, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(1)
                                  }
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "<=",
                            list(
                              duckdb:::expr_reference("p_size"),
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(10, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(10)
                              }
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("AIR", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("AIR")
                              },
                              duckdb:::expr_reference("l_shipmode")
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("AIR REG", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("AIR REG")
                              },
                              duckdb:::expr_reference("l_shipmode")
                            )
                          )
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      duckdb:::expr_reference("l_shipinstruct"),
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant("DELIVER IN PERSON", experimental = experimental)
                      } else {
                        duckdb:::expr_constant("DELIVER IN PERSON")
                      }
                    )
                  )
                )
              )
            )
          ),
          duckdb:::expr_function(
            "&",
            list(
              duckdb:::expr_function(
                "&",
                list(
                  duckdb:::expr_function(
                    "&",
                    list(
                      duckdb:::expr_function(
                        "&",
                        list(
                          duckdb:::expr_function(
                            "&",
                            list(
                              duckdb:::expr_function(
                                "&",
                                list(
                                  duckdb:::expr_function(
                                    "&",
                                    list(
                                      duckdb:::expr_function(
                                        "==",
                                        list(
                                          duckdb:::expr_reference("p_brand"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant("Brand#34", experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant("Brand#34")
                                          }
                                        )
                                      ),
                                      duckdb:::expr_function(
                                        "|",
                                        list(
                                          duckdb:::expr_function(
                                            "|",
                                            list(
                                              duckdb:::expr_function(
                                                "|",
                                                list(
                                                  duckdb:::expr_function(
                                                    "==",
                                                    list(
                                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                        duckdb:::expr_constant("LG CASE", experimental = experimental)
                                                      } else {
                                                        duckdb:::expr_constant("LG CASE")
                                                      },
                                                      duckdb:::expr_reference("p_container")
                                                    )
                                                  ),
                                                  duckdb:::expr_function(
                                                    "==",
                                                    list(
                                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                        duckdb:::expr_constant("LG BOX", experimental = experimental)
                                                      } else {
                                                        duckdb:::expr_constant("LG BOX")
                                                      },
                                                      duckdb:::expr_reference("p_container")
                                                    )
                                                  )
                                                )
                                              ),
                                              duckdb:::expr_function(
                                                "==",
                                                list(
                                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                    duckdb:::expr_constant("LG PACK", experimental = experimental)
                                                  } else {
                                                    duckdb:::expr_constant("LG PACK")
                                                  },
                                                  duckdb:::expr_reference("p_container")
                                                )
                                              )
                                            )
                                          ),
                                          duckdb:::expr_function(
                                            "==",
                                            list(
                                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                duckdb:::expr_constant("LG PKG", experimental = experimental)
                                              } else {
                                                duckdb:::expr_constant("LG PKG")
                                              },
                                              duckdb:::expr_reference("p_container")
                                            )
                                          )
                                        )
                                      )
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    ">=",
                                    list(
                                      duckdb:::expr_reference("l_quantity"),
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(20, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(20)
                                      }
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                "<=",
                                list(
                                  duckdb:::expr_reference("l_quantity"),
                                  duckdb:::expr_function(
                                    "+",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(20, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(20)
                                      },
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(10, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(10)
                                      }
                                    )
                                  )
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            ">=",
                            list(
                              duckdb:::expr_reference("p_size"),
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(1, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(1)
                              }
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "<=",
                        list(
                          duckdb:::expr_reference("p_size"),
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant(15, experimental = experimental)
                          } else {
                            duckdb:::expr_constant(15)
                          }
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "|",
                    list(
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant("AIR", experimental = experimental)
                          } else {
                            duckdb:::expr_constant("AIR")
                          },
                          duckdb:::expr_reference("l_shipmode")
                        )
                      ),
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant("AIR REG", experimental = experimental)
                          } else {
                            duckdb:::expr_constant("AIR REG")
                          },
                          duckdb:::expr_reference("l_shipmode")
                        )
                      )
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("l_shipinstruct"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("DELIVER IN PERSON", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("DELIVER IN PERSON")
                  }
                )
              )
            )
          )
        )
      )
    )
  )
  rel8 <- duckdb:::rel_aggregate(
    rel7,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_reference("l_extendedprice"),
                duckdb:::expr_function(
                  "-",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_discount")
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_distinct(rel8)
  rel9
  duckdb:::rel_to_altrep(rel9)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_20 <- function(con, experimental) {
  df1 <- nation
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("n_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("CANADA", experimental = experimental)
          } else {
            duckdb:::expr_constant("CANADA")
          }
        )
      )
    )
  )
  df2 <- supplier
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "lhs")
  rel5 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel6 <- duckdb:::rel_join(
    rel4,
    rel5,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel4), duckdb:::expr_reference("n_nationkey", rel5))
      )
    ),
    "inner"
  )
  rel7 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel4), duckdb:::expr_reference("n_nationkey", rel5))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      }
    )
  )
  df3 <- part
  rel9 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel10 <- duckdb:::rel_filter(
    rel9,
    list(
      duckdb:::expr_function(
        "grepl",
        list(
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("^forest", experimental = experimental)
          } else {
            duckdb:::expr_constant("^forest")
          },
          duckdb:::expr_reference("p_name")
        )
      )
    )
  )
  df4 <- partsupp
  rel11 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel12 <- duckdb:::rel_set_alias(rel11, "lhs")
  rel13 <- duckdb:::rel_set_alias(rel8, "rhs")
  rel14 <- duckdb:::rel_join(
    rel12,
    rel13,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel12), duckdb:::expr_reference("s_suppkey", rel13))
      )
    ),
    "semi"
  )
  rel15 <- duckdb:::rel_set_alias(rel14, "lhs")
  rel16 <- duckdb:::rel_set_alias(rel10, "rhs")
  rel17 <- duckdb:::rel_join(
    rel15,
    rel16,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_partkey", rel15), duckdb:::expr_reference("p_partkey", rel16))
      )
    ),
    "semi"
  )
  df5 <- lineitem
  rel18 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel19 <- duckdb:::rel_filter(
    rel18,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      )
    )
  )
  rel20 <- duckdb:::rel_set_alias(rel19, "lhs")
  rel21 <- duckdb:::rel_set_alias(rel17, "rhs")
  rel22 <- duckdb:::rel_join(
    rel20,
    rel21,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel20), duckdb:::expr_reference("ps_partkey", rel21))
      ),
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel20), duckdb:::expr_reference("ps_suppkey", rel21))
      )
    ),
    "semi"
  )
  rel23 <- duckdb:::rel_aggregate(
    rel22,
    groups = list(duckdb:::expr_reference("l_suppkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(0.5, experimental = experimental)
            } else {
              duckdb:::expr_constant(0.5)
            },
            duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_quantity")))
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "qty_threshold")
        tmp_expr
      }
    )
  )
  rel24 <- duckdb:::rel_set_alias(rel17, "lhs")
  rel25 <- duckdb:::rel_set_alias(rel23, "rhs")
  rel26 <- duckdb:::rel_join(
    rel24,
    rel25,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel24), duckdb:::expr_reference("l_suppkey", rel25))
      )
    ),
    "inner"
  )
  rel27 <- duckdb:::rel_project(
    rel26,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel24), duckdb:::expr_reference("l_suppkey", rel25))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("qty_threshold")
        duckdb:::expr_set_alias(tmp_expr, "qty_threshold")
        tmp_expr
      }
    )
  )
  rel28 <- duckdb:::rel_filter(
    rel27,
    list(
      duckdb:::expr_function(
        ">",
        list(duckdb:::expr_reference("ps_availqty"), duckdb:::expr_reference("qty_threshold"))
      )
    )
  )
  rel29 <- duckdb:::rel_set_alias(rel8, "lhs")
  rel30 <- duckdb:::rel_set_alias(rel28, "rhs")
  rel31 <- duckdb:::rel_join(
    rel29,
    rel30,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_suppkey", rel29), duckdb:::expr_reference("ps_suppkey", rel30))
      )
    ),
    "semi"
  )
  rel32 <- duckdb:::rel_project(
    rel31,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      }
    )
  )
  rel33 <- duckdb:::rel_order(rel32, list(duckdb:::expr_reference("s_name")))
  rel33
  duckdb:::rel_to_altrep(rel33)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_21 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_aggregate(
    rel1,
    groups = list(duckdb:::expr_reference("l_orderkey"), duckdb:::expr_reference("l_suppkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "n")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_aggregate(
    rel2,
    groups = list(duckdb:::expr_reference("l_orderkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "n_supplier")
        tmp_expr
      }
    )
  )
  rel4 <- duckdb:::rel_filter(
    rel3,
    list(
      duckdb:::expr_function(
        ">",
        list(
          duckdb:::expr_reference("n_supplier"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(1, experimental = experimental)
          } else {
            duckdb:::expr_constant(1)
          }
        )
      )
    )
  )
  rel5 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel6 <- duckdb:::rel_set_alias(rel5, "lhs")
  rel7 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel6), duckdb:::expr_reference("l_orderkey", rel7))
      )
    ),
    "semi"
  )
  rel9 <- duckdb:::rel_set_alias(rel8, "lhs")
  df2 <- orders
  rel10 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel11 <- duckdb:::rel_set_alias(rel10, "rhs")
  rel12 <- duckdb:::rel_join(
    rel9,
    rel11,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel9), duckdb:::expr_reference("o_orderkey", rel11))
      )
    ),
    "inner"
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel9), duckdb:::expr_reference("o_orderkey", rel11))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_filter(
    rel13,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("o_orderstatus"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("F", experimental = experimental)
          } else {
            duckdb:::expr_constant("F")
          }
        )
      )
    )
  )
  rel15 <- duckdb:::rel_aggregate(
    rel14,
    groups = list(duckdb:::expr_reference("l_orderkey"), duckdb:::expr_reference("l_suppkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "any",
          list(
            duckdb:::expr_function(
              ">",
              list(duckdb:::expr_reference("l_receiptdate"), duckdb:::expr_reference("l_commitdate"))
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "failed_delivery_commit")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_aggregate(
    rel15,
    groups = list(duckdb:::expr_reference("l_orderkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "n_supplier")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "ifelse",
              list(
                duckdb:::expr_reference("failed_delivery_commit"),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(0, experimental = experimental)
                } else {
                  duckdb:::expr_constant(0)
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "num_failed")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_filter(
    rel16,
    list(
      duckdb:::expr_function(
        "&",
        list(
          duckdb:::expr_function(
            ">",
            list(
              duckdb:::expr_reference("n_supplier"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant(1, experimental = experimental)
              } else {
                duckdb:::expr_constant(1)
              }
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("num_failed"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant(1, experimental = experimental)
              } else {
                duckdb:::expr_constant(1)
              }
            )
          )
        )
      )
    )
  )
  rel18 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel19 <- duckdb:::rel_set_alias(rel18, "lhs")
  rel20 <- duckdb:::rel_set_alias(rel17, "rhs")
  rel21 <- duckdb:::rel_join(
    rel19,
    rel20,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel19), duckdb:::expr_reference("l_orderkey", rel20))
      )
    ),
    "semi"
  )
  df3 <- supplier
  rel22 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel23 <- duckdb:::rel_set_alias(rel22, "lhs")
  rel24 <- duckdb:::rel_set_alias(rel21, "rhs")
  rel25 <- duckdb:::rel_join(
    rel23,
    rel24,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_suppkey", rel23), duckdb:::expr_reference("l_suppkey", rel24))
      )
    ),
    "inner"
  )
  rel26 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_suppkey", rel23), duckdb:::expr_reference("l_suppkey", rel24))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      }
    )
  )
  rel27 <- duckdb:::rel_filter(
    rel26,
    list(
      duckdb:::expr_function(
        ">",
        list(duckdb:::expr_reference("l_receiptdate"), duckdb:::expr_reference("l_commitdate"))
      )
    )
  )
  rel28 <- duckdb:::rel_set_alias(rel27, "lhs")
  df4 <- nation
  rel29 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel30 <- duckdb:::rel_set_alias(rel29, "rhs")
  rel31 <- duckdb:::rel_join(
    rel28,
    rel30,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel28), duckdb:::expr_reference("n_nationkey", rel30))
      )
    ),
    "inner"
  )
  rel32 <- duckdb:::rel_project(
    rel31,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel28), duckdb:::expr_reference("n_nationkey", rel30))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      }
    )
  )
  rel33 <- duckdb:::rel_filter(
    rel32,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("n_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("SAUDI ARABIA", experimental = experimental)
          } else {
            duckdb:::expr_constant("SAUDI ARABIA")
          }
        )
      )
    )
  )
  rel34 <- duckdb:::rel_aggregate(
    rel33,
    groups = list(duckdb:::expr_reference("s_name")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "numwait")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_order(
    rel34,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("numwait"))), duckdb:::expr_reference("s_name"))
  )
  rel36 <- duckdb:::rel_limit(rel35, 100)
  rel36
  duckdb:::rel_to_altrep(rel36)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_22 <- function(con, experimental) {
  df1 <- customer
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "&",
        list(
          duckdb:::expr_function(
            "|",
            list(
              duckdb:::expr_function(
                "|",
                list(
                  duckdb:::expr_function(
                    "|",
                    list(
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "|",
                            list(
                              duckdb:::expr_function(
                                "|",
                                list(
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant("13", experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant("13")
                                      },
                                      duckdb:::expr_function(
                                        "substr",
                                        list(
                                          duckdb:::expr_reference("c_phone"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(1L, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(1L)
                                          },
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(2L, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(2L)
                                          }
                                        )
                                      )
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant("31", experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant("31")
                                      },
                                      duckdb:::expr_function(
                                        "substr",
                                        list(
                                          duckdb:::expr_reference("c_phone"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(1L, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(1L)
                                          },
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(2L, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(2L)
                                          }
                                        )
                                      )
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                "==",
                                list(
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant("23", experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant("23")
                                  },
                                  duckdb:::expr_function(
                                    "substr",
                                    list(
                                      duckdb:::expr_reference("c_phone"),
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(1L, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(1L)
                                      },
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(2L, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(2L)
                                      }
                                    )
                                  )
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("29", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("29")
                              },
                              duckdb:::expr_function(
                                "substr",
                                list(
                                  duckdb:::expr_reference("c_phone"),
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(1L, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(1L)
                                  },
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(2L, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(2L)
                                  }
                                )
                              )
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant("30", experimental = experimental)
                          } else {
                            duckdb:::expr_constant("30")
                          },
                          duckdb:::expr_function(
                            "substr",
                            list(
                              duckdb:::expr_reference("c_phone"),
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(1L, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(1L)
                              },
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(2L, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(2L)
                              }
                            )
                          )
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant("18", experimental = experimental)
                      } else {
                        duckdb:::expr_constant("18")
                      },
                      duckdb:::expr_function(
                        "substr",
                        list(
                          duckdb:::expr_reference("c_phone"),
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant(1L, experimental = experimental)
                          } else {
                            duckdb:::expr_constant(1L)
                          },
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant(2L, experimental = experimental)
                          } else {
                            duckdb:::expr_constant(2L)
                          }
                        )
                      )
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("17", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("17")
                  },
                  duckdb:::expr_function(
                    "substr",
                    list(
                      duckdb:::expr_reference("c_phone"),
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant(1L, experimental = experimental)
                      } else {
                        duckdb:::expr_constant(1L)
                      },
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant(2L, experimental = experimental)
                      } else {
                        duckdb:::expr_constant(2L)
                      }
                    )
                  )
                )
              )
            )
          ),
          duckdb:::expr_function(
            ">",
            list(
              duckdb:::expr_reference("c_acctbal"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant(0, experimental = experimental)
              } else {
                duckdb:::expr_constant(0)
              }
            )
          )
        )
      )
    )
  )
  rel3 <- duckdb:::rel_aggregate(
    rel2,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("mean", list(duckdb:::expr_reference("c_acctbal")))
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "join_id")
        tmp_expr
      }
    )
  )
  rel4 <- duckdb:::rel_distinct(rel3)
  rel5 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "substr",
          list(
            duckdb:::expr_reference("c_phone"),
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(1L, experimental = experimental)
            } else {
              duckdb:::expr_constant(1L)
            },
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(2L, experimental = experimental)
            } else {
              duckdb:::expr_constant(2L)
            }
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "join_id")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_set_alias(rel7, "lhs")
  rel9 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel10 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("join_id")
        duckdb:::expr_set_alias(tmp_expr, "join_id_x")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("acctbal_min")
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("join_id")
        duckdb:::expr_set_alias(tmp_expr, "join_id_y")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_join(
    rel10,
    rel11,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("join_id_x", rel10), duckdb:::expr_reference("join_id_y", rel11))
      )
    ),
    "left"
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey_x")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name_x")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address_x")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey_x")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone_x")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal_x")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment_x")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode_x")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("join_id_x", rel10), duckdb:::expr_reference("join_id_y", rel11))
        )
        duckdb:::expr_set_alias(tmp_expr, "join_id")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("acctbal_min_y")
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_filter(
    rel13,
    list(
      duckdb:::expr_function(
        "&",
        list(
          duckdb:::expr_function(
            "|",
            list(
              duckdb:::expr_function(
                "|",
                list(
                  duckdb:::expr_function(
                    "|",
                    list(
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "|",
                            list(
                              duckdb:::expr_function(
                                "|",
                                list(
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant("13", experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant("13")
                                      },
                                      duckdb:::expr_reference("cntrycode")
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant("31", experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant("31")
                                      },
                                      duckdb:::expr_reference("cntrycode")
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                "==",
                                list(
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant("23", experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant("23")
                                  },
                                  duckdb:::expr_reference("cntrycode")
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("29", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("29")
                              },
                              duckdb:::expr_reference("cntrycode")
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant("30", experimental = experimental)
                          } else {
                            duckdb:::expr_constant("30")
                          },
                          duckdb:::expr_reference("cntrycode")
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant("18", experimental = experimental)
                      } else {
                        duckdb:::expr_constant("18")
                      },
                      duckdb:::expr_reference("cntrycode")
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("17", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("17")
                  },
                  duckdb:::expr_reference("cntrycode")
                )
              )
            )
          ),
          duckdb:::expr_function(
            ">",
            list(duckdb:::expr_reference("c_acctbal"), duckdb:::expr_reference("acctbal_min"))
          )
        )
      )
    )
  )
  rel15 <- duckdb:::rel_set_alias(rel14, "lhs")
  df2 <- orders
  rel16 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel17 <- duckdb:::rel_set_alias(rel16, "rhs")
  rel18 <- duckdb:::rel_join(
    rel15,
    rel17,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_custkey", rel15), duckdb:::expr_reference("o_custkey", rel17))
      )
    ),
    "anti"
  )
  rel19 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_aggregate(
    rel19,
    groups = list(duckdb:::expr_reference("cntrycode")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "numcust")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("c_acctbal")))
        duckdb:::expr_set_alias(tmp_expr, "totacctbal")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_order(rel20, list(duckdb:::expr_reference("cntrycode")))
  rel21
  duckdb:::rel_to_altrep(rel21)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_01 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "<=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1998-09-02", experimental = experimental)
              } else {
                duckdb:::expr_constant("1998-09-02")
              }
            )
          )
        )
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_aggregate(
    rel4,
    groups = list(duckdb:::expr_reference("l_returnflag"), duckdb:::expr_reference("l_linestatus")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_quantity")))
        duckdb:::expr_set_alias(tmp_expr, "sum_qty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_extendedprice")))
        duckdb:::expr_set_alias(tmp_expr, "sum_base_price")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_reference("l_extendedprice"),
                duckdb:::expr_function(
                  "-",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_discount")
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "sum_disc_price")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_function(
                  "*",
                  list(
                    duckdb:::expr_reference("l_extendedprice"),
                    duckdb:::expr_function(
                      "-",
                      list(
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant(1, experimental = experimental)
                        } else {
                          duckdb:::expr_constant(1)
                        },
                        duckdb:::expr_reference("l_discount")
                      )
                    )
                  )
                ),
                duckdb:::expr_function(
                  "+",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_tax")
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "sum_charge")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("mean", list(duckdb:::expr_reference("l_quantity")))
        duckdb:::expr_set_alias(tmp_expr, "avg_qty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("mean", list(duckdb:::expr_reference("l_extendedprice")))
        duckdb:::expr_set_alias(tmp_expr, "avg_price")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("mean", list(duckdb:::expr_reference("l_discount")))
        duckdb:::expr_set_alias(tmp_expr, "avg_disc")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "count_order")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_order(
    rel5,
    list(duckdb:::expr_reference("l_returnflag"), duckdb:::expr_reference("l_linestatus"))
  )
  rel6
  duckdb:::rel_to_altrep(rel6)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_02 <- function(con, experimental) {
  df1 <- partsupp
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      }
    )
  )
  df2 <- part
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_filter(
    rel4,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("p_size"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(15, experimental = experimental)
          } else {
            duckdb:::expr_constant(15)
          }
        )
      ),
      duckdb:::expr_function(
        "grepl",
        list(
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("BRASS$", experimental = experimental)
          } else {
            duckdb:::expr_constant("BRASS$")
          },
          duckdb:::expr_reference("p_type")
        )
      )
    )
  )
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel6, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_join(
    rel9,
    rel10,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("p_partkey", rel9), duckdb:::expr_reference("ps_partkey", rel10))
      )
    ),
    "inner"
  )
  rel12 <- duckdb:::rel_order(
    rel11,
    list(duckdb:::expr_reference("___row_number_x", rel9), duckdb:::expr_reference("___row_number_y", rel10))
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("p_partkey", rel9), duckdb:::expr_reference("ps_partkey", rel10))
        )
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      }
    )
  )
  df3 <- supplier
  rel14 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_set_alias(rel13, "lhs")
  rel17 <- duckdb:::rel_set_alias(rel15, "rhs")
  rel18 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel19 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_join(
    rel18,
    rel19,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("ps_suppkey", rel18), duckdb:::expr_reference("s_suppkey", rel19))
      )
    ),
    "inner"
  )
  rel21 <- duckdb:::rel_order(
    rel20,
    list(duckdb:::expr_reference("___row_number_x", rel18), duckdb:::expr_reference("___row_number_y", rel19))
  )
  rel22 <- duckdb:::rel_project(
    rel21,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel18), duckdb:::expr_reference("s_suppkey", rel19))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  df4 <- region
  rel24 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel25 <- duckdb:::rel_filter(
    rel24,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("r_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("EUROPE", experimental = experimental)
          } else {
            duckdb:::expr_constant("EUROPE")
          }
        )
      )
    )
  )
  df5 <- nation
  rel26 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel27 <- duckdb:::rel_set_alias(rel26, "lhs")
  rel28 <- duckdb:::rel_set_alias(rel25, "rhs")
  rel29 <- duckdb:::rel_project(
    rel27,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_project(
    rel28,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_comment")
        duckdb:::expr_set_alias(tmp_expr, "r_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel31 <- duckdb:::rel_join(
    rel29,
    rel30,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("n_regionkey", rel29), duckdb:::expr_reference("r_regionkey", rel30))
      )
    ),
    "inner"
  )
  rel32 <- duckdb:::rel_order(
    rel31,
    list(duckdb:::expr_reference("___row_number_x", rel29), duckdb:::expr_reference("___row_number_y", rel30))
  )
  rel33 <- duckdb:::rel_project(
    rel32,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("n_regionkey", rel29), duckdb:::expr_reference("r_regionkey", rel30))
        )
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_comment")
        duckdb:::expr_set_alias(tmp_expr, "r_comment")
        tmp_expr
      }
    )
  )
  rel34 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_set_alias(rel23, "lhs")
  rel36 <- duckdb:::rel_set_alias(rel34, "rhs")
  rel37 <- duckdb:::rel_project(
    rel35,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel38 <- duckdb:::rel_project(
    rel36,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_join(
    rel37,
    rel38,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("s_nationkey", rel37), duckdb:::expr_reference("n_nationkey", rel38))
      )
    ),
    "inner"
  )
  rel40 <- duckdb:::rel_order(
    rel39,
    list(duckdb:::expr_reference("___row_number_x", rel37), duckdb:::expr_reference("___row_number_y", rel38))
  )
  rel41 <- duckdb:::rel_project(
    rel40,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel37), duckdb:::expr_reference("n_nationkey", rel38))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel42 <- duckdb:::rel_project(
    rel41,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel43 <- duckdb:::rel_aggregate(
    rel42,
    groups = list(duckdb:::expr_reference("p_partkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("min", list(duckdb:::expr_reference("ps_supplycost")))
        duckdb:::expr_set_alias(tmp_expr, "min_ps_supplycost")
        tmp_expr
      }
    )
  )
  rel44 <- duckdb:::rel_set_alias(rel42, "lhs")
  rel45 <- duckdb:::rel_set_alias(rel43, "rhs")
  rel46 <- duckdb:::rel_project(
    rel44,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment_x")
        tmp_expr
      }
    )
  )
  rel47 <- duckdb:::rel_project(
    rel45,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("min_ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "min_ps_supplycost_y")
        tmp_expr
      }
    )
  )
  rel48 <- duckdb:::rel_project(
    rel46,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey_x")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost_x")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr_x")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name_x")
        duckdb:::expr_set_alias(tmp_expr, "n_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal_x")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name_x")
        duckdb:::expr_set_alias(tmp_expr, "s_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address_x")
        duckdb:::expr_set_alias(tmp_expr, "s_address_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone_x")
        duckdb:::expr_set_alias(tmp_expr, "s_phone_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "s_comment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel49 <- duckdb:::rel_project(
    rel47,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey_y")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("min_ps_supplycost_y")
        duckdb:::expr_set_alias(tmp_expr, "min_ps_supplycost_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel50 <- duckdb:::rel_join(
    rel48,
    rel49,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("p_partkey_x", rel48), duckdb:::expr_reference("p_partkey_y", rel49))
      ),
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("ps_supplycost_x", rel48), duckdb:::expr_reference("min_ps_supplycost_y", rel49))
      )
    ),
    "inner"
  )
  rel51 <- duckdb:::rel_order(
    rel50,
    list(duckdb:::expr_reference("___row_number_x", rel48), duckdb:::expr_reference("___row_number_y", rel49))
  )
  rel52 <- duckdb:::rel_project(
    rel51,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("p_partkey_x", rel48), duckdb:::expr_reference("p_partkey_y", rel49))
        )
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_supplycost_x", rel48), duckdb:::expr_reference("min_ps_supplycost_y", rel49))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr_x")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name_x")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal_x")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name_x")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address_x")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone_x")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel53 <- duckdb:::rel_project(
    rel52,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel54 <- duckdb:::rel_order(
    rel53,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("s_acctbal"))), duckdb:::expr_reference("n_name"), duckdb:::expr_reference("s_name"), duckdb:::expr_reference("p_partkey"))
  )
  rel55 <- duckdb:::rel_limit(rel54, 100)
  rel55
  duckdb:::rel_to_altrep(rel55)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_03 <- function(con, experimental) {
  df1 <- orders
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-03-15", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-03-15")
              }
            )
          )
        )
      )
    )
  )
  df2 <- customer
  rel4 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel5 <- duckdb:::rel_project(
    rel4,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_filter(
    rel5,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("c_mktsegment"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("BUILDING", experimental = experimental)
          } else {
            duckdb:::expr_constant("BUILDING")
          }
        )
      )
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel3, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel6, "rhs")
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_join(
    rel9,
    rel10,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("o_custkey", rel9), duckdb:::expr_reference("c_custkey", rel10))
      )
    ),
    "inner"
  )
  rel12 <- duckdb:::rel_order(
    rel11,
    list(duckdb:::expr_reference("___row_number_x", rel9), duckdb:::expr_reference("___row_number_y", rel10))
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel9), duckdb:::expr_reference("c_custkey", rel10))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      }
    )
  )
  df3 <- lineitem
  rel15 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel16 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_filter(
    rel16,
    list(
      duckdb:::expr_function(
        ">",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-03-15", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-03-15")
              }
            )
          )
        )
      )
    )
  )
  rel18 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel19 <- duckdb:::rel_set_alias(rel18, "lhs")
  rel20 <- duckdb:::rel_set_alias(rel14, "rhs")
  rel21 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_project(
    rel20,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_join(
    rel21,
    rel22,
    list(
      duckdb:::expr_function(
        "___eq_na_matches_na",
        list(duckdb:::expr_reference("l_orderkey", rel21), duckdb:::expr_reference("o_orderkey", rel22))
      )
    ),
    "inner"
  )
  rel24 <- duckdb:::rel_order(
    rel23,
    list(duckdb:::expr_reference("___row_number_x", rel21), duckdb:::expr_reference("___row_number_y", rel22))
  )
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel21), duckdb:::expr_reference("o_orderkey", rel22))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel27 <- duckdb:::rel_aggregate(
    rel26,
    groups = list(duckdb:::expr_reference("l_orderkey"), duckdb:::expr_reference("o_orderdate"), duckdb:::expr_reference("o_shippriority")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel28 <- duckdb:::rel_project(
    rel27,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      }
    )
  )
  rel29 <- duckdb:::rel_order(
    rel28,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("revenue"))), duckdb:::expr_reference("o_orderdate"))
  )
  rel30 <- duckdb:::rel_limit(rel29, 10)
  rel30
  duckdb:::rel_to_altrep(rel30)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_04 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "<",
        list(duckdb:::expr_reference("l_commitdate"), duckdb:::expr_reference("l_receiptdate"))
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      }
    )
  )
  df2 <- orders
  rel5 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_filter(
    rel6,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1993-07-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1993-07-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1993-10-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1993-10-01")
              }
            )
          )
        )
      )
    )
  )
  rel8 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_set_alias(rel4, "lhs")
  rel10 <- duckdb:::rel_set_alias(rel8, "rhs")
  rel11 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_join(
    rel11,
    rel12,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel11), duckdb:::expr_reference("o_orderkey", rel12))
      )
    ),
    "inner"
  )
  rel14 <- duckdb:::rel_order(
    rel13,
    list(duckdb:::expr_reference("___row_number_x", rel11), duckdb:::expr_reference("___row_number_y", rel12))
  )
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel11), duckdb:::expr_reference("o_orderkey", rel12))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      duckdb:::expr_reference("___row_number"),
      {
        tmp_expr <- duckdb:::expr_window(
          duckdb:::expr_function("row_number", list()),
          list(
            l_orderkey = {
              tmp_expr <- duckdb:::expr_reference("l_orderkey")
              duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
              tmp_expr
            },
            o_orderpriority = {
              tmp_expr <- duckdb:::expr_reference("o_orderpriority")
              duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
              tmp_expr
            }
          ),
          list(),
          offset_expr = NULL,
          default_expr = NULL
        )
        duckdb:::expr_set_alias(tmp_expr, "___row_number_by")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_filter(
    rel17,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("___row_number_by"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(1L, experimental = experimental)
          } else {
            duckdb:::expr_constant(1L)
          }
        )
      )
    )
  )
  rel19 <- duckdb:::rel_order(rel18, list(duckdb:::expr_reference("___row_number")))
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_project(
    rel20,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_aggregate(
    rel21,
    groups = list(duckdb:::expr_reference("o_orderpriority")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "order_count")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_order(rel22, list(duckdb:::expr_reference("o_orderpriority")))
  rel23
  duckdb:::rel_to_altrep(rel23)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_05 <- function(con, experimental) {
  df1 <- nation
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df2 <- region
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_filter(
    rel4,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("r_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("ASIA", experimental = experimental)
          } else {
            duckdb:::expr_constant("ASIA")
          }
        )
      )
    )
  )
  rel6 <- duckdb:::rel_set_alias(rel2, "lhs")
  rel7 <- duckdb:::rel_set_alias(rel5, "rhs")
  rel8 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_join(
    rel8,
    rel9,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("n_regionkey", rel8), duckdb:::expr_reference("r_regionkey", rel9))
      )
    ),
    "inner"
  )
  rel11 <- duckdb:::rel_order(
    rel10,
    list(duckdb:::expr_reference("___row_number_x", rel8), duckdb:::expr_reference("___row_number_y", rel9))
  )
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("n_regionkey", rel8), duckdb:::expr_reference("r_regionkey", rel9))
        )
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df3 <- supplier
  rel14 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_set_alias(rel15, "lhs")
  rel17 <- duckdb:::rel_set_alias(rel13, "rhs")
  rel18 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel19 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_join(
    rel18,
    rel19,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel18), duckdb:::expr_reference("n_nationkey", rel19))
      )
    ),
    "inner"
  )
  rel21 <- duckdb:::rel_order(
    rel20,
    list(duckdb:::expr_reference("___row_number_x", rel18), duckdb:::expr_reference("___row_number_y", rel19))
  )
  rel22 <- duckdb:::rel_project(
    rel21,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel18), duckdb:::expr_reference("n_nationkey", rel19))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df4 <- lineitem
  rel24 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_set_alias(rel25, "lhs")
  rel27 <- duckdb:::rel_set_alias(rel23, "rhs")
  rel28 <- duckdb:::rel_project(
    rel26,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel29 <- duckdb:::rel_project(
    rel27,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_join(
    rel28,
    rel29,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel28), duckdb:::expr_reference("s_suppkey", rel29))
      )
    ),
    "inner"
  )
  rel31 <- duckdb:::rel_order(
    rel30,
    list(duckdb:::expr_reference("___row_number_x", rel28), duckdb:::expr_reference("___row_number_y", rel29))
  )
  rel32 <- duckdb:::rel_project(
    rel31,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel28), duckdb:::expr_reference("s_suppkey", rel29))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df5 <- orders
  rel33 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel34 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_filter(
    rel34,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      )
    )
  )
  rel36 <- duckdb:::rel_project(
    rel35,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  df6 <- customer
  rel37 <- duckdb:::rel_from_df(con, df6, experimental = experimental)
  rel38 <- duckdb:::rel_project(
    rel37,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_set_alias(rel36, "lhs")
  rel40 <- duckdb:::rel_set_alias(rel38, "rhs")
  rel41 <- duckdb:::rel_project(
    rel39,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel42 <- duckdb:::rel_project(
    rel40,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel43 <- duckdb:::rel_join(
    rel41,
    rel42,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_custkey", rel41), duckdb:::expr_reference("c_custkey", rel42))
      )
    ),
    "inner"
  )
  rel44 <- duckdb:::rel_order(
    rel43,
    list(duckdb:::expr_reference("___row_number_x", rel41), duckdb:::expr_reference("___row_number_y", rel42))
  )
  rel45 <- duckdb:::rel_project(
    rel44,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel41), duckdb:::expr_reference("c_custkey", rel42))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel46 <- duckdb:::rel_project(
    rel45,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel47 <- duckdb:::rel_set_alias(rel32, "lhs")
  rel48 <- duckdb:::rel_set_alias(rel46, "rhs")
  rel49 <- duckdb:::rel_project(
    rel47,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel50 <- duckdb:::rel_project(
    rel48,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel51 <- duckdb:::rel_join(
    rel49,
    rel50,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel49), duckdb:::expr_reference("o_orderkey", rel50))
      ),
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel49), duckdb:::expr_reference("c_nationkey", rel50))
      )
    ),
    "inner"
  )
  rel52 <- duckdb:::rel_order(
    rel51,
    list(duckdb:::expr_reference("___row_number_x", rel49), duckdb:::expr_reference("___row_number_y", rel50))
  )
  rel53 <- duckdb:::rel_project(
    rel52,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel49), duckdb:::expr_reference("o_orderkey", rel50))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel49), duckdb:::expr_reference("c_nationkey", rel50))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel54 <- duckdb:::rel_project(
    rel53,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel55 <- duckdb:::rel_project(
    rel54,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel56 <- duckdb:::rel_aggregate(
    rel55,
    groups = list(duckdb:::expr_reference("n_name")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel57 <- duckdb:::rel_order(rel56, list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("revenue")))))
  rel57
  duckdb:::rel_to_altrep(rel57)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_06 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_discount"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(0.05, experimental = experimental)
          } else {
            duckdb:::expr_constant(0.05)
          }
        )
      ),
      duckdb:::expr_function(
        "<=",
        list(
          duckdb:::expr_reference("l_discount"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(0.07, experimental = experimental)
          } else {
            duckdb:::expr_constant(0.07)
          }
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_quantity"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(24, experimental = experimental)
          } else {
            duckdb:::expr_constant(24)
          }
        )
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_aggregate(
    rel4,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(duckdb:::expr_reference("l_extendedprice"), duckdb:::expr_reference("l_discount"))
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_distinct(rel5)
  rel6
  duckdb:::rel_to_altrep(rel6)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_07 <- function(con, experimental) {
  df1 <- supplier
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      }
    )
  )
  df2 <- nation
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_filter(
    rel4,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("n1_name"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("FRANCE", experimental = experimental)
              } else {
                duckdb:::expr_constant("FRANCE")
              }
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("n1_name"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("GERMANY", experimental = experimental)
              } else {
                duckdb:::expr_constant("GERMANY")
              }
            )
          )
        )
      )
    )
  )
  rel6 <- duckdb:::rel_set_alias(rel2, "lhs")
  rel7 <- duckdb:::rel_set_alias(rel5, "rhs")
  rel8 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n1_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_join(
    rel8,
    rel9,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel8), duckdb:::expr_reference("n1_nationkey", rel9))
      )
    ),
    "inner"
  )
  rel11 <- duckdb:::rel_order(
    rel10,
    list(duckdb:::expr_reference("___row_number_x", rel8), duckdb:::expr_reference("___row_number_y", rel9))
  )
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel8), duckdb:::expr_reference("n1_nationkey", rel9))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      }
    )
  )
  df3 <- customer
  rel14 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n2_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_filter(
    rel17,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("n2_name"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("FRANCE", experimental = experimental)
              } else {
                duckdb:::expr_constant("FRANCE")
              }
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("n2_name"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("GERMANY", experimental = experimental)
              } else {
                duckdb:::expr_constant("GERMANY")
              }
            )
          )
        )
      )
    )
  )
  rel19 <- duckdb:::rel_set_alias(rel15, "lhs")
  rel20 <- duckdb:::rel_set_alias(rel18, "rhs")
  rel21 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_project(
    rel20,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n2_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n2_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_join(
    rel21,
    rel22,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_nationkey", rel21), duckdb:::expr_reference("n2_nationkey", rel22))
      )
    ),
    "inner"
  )
  rel24 <- duckdb:::rel_order(
    rel23,
    list(duckdb:::expr_reference("___row_number_x", rel21), duckdb:::expr_reference("___row_number_y", rel22))
  )
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_nationkey", rel21), duckdb:::expr_reference("n2_nationkey", rel22))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  df4 <- orders
  rel27 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel28 <- duckdb:::rel_project(
    rel27,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      }
    )
  )
  rel29 <- duckdb:::rel_set_alias(rel28, "lhs")
  rel30 <- duckdb:::rel_set_alias(rel26, "rhs")
  rel31 <- duckdb:::rel_project(
    rel29,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel32 <- duckdb:::rel_project(
    rel30,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel33 <- duckdb:::rel_join(
    rel31,
    rel32,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_custkey", rel31), duckdb:::expr_reference("c_custkey", rel32))
      )
    ),
    "inner"
  )
  rel34 <- duckdb:::rel_order(
    rel33,
    list(duckdb:::expr_reference("___row_number_x", rel31), duckdb:::expr_reference("___row_number_y", rel32))
  )
  rel35 <- duckdb:::rel_project(
    rel34,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel31), duckdb:::expr_reference("c_custkey", rel32))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel36 <- duckdb:::rel_project(
    rel35,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  df5 <- lineitem
  rel37 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel38 <- duckdb:::rel_project(
    rel37,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_filter(
    rel38,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1996-12-31", experimental = experimental)
              } else {
                duckdb:::expr_constant("1996-12-31")
              }
            )
          )
        )
      )
    )
  )
  rel40 <- duckdb:::rel_set_alias(rel39, "lhs")
  rel41 <- duckdb:::rel_set_alias(rel36, "rhs")
  rel42 <- duckdb:::rel_project(
    rel40,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel43 <- duckdb:::rel_project(
    rel41,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel44 <- duckdb:::rel_join(
    rel42,
    rel43,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel42), duckdb:::expr_reference("o_orderkey", rel43))
      )
    ),
    "inner"
  )
  rel45 <- duckdb:::rel_order(
    rel44,
    list(duckdb:::expr_reference("___row_number_x", rel42), duckdb:::expr_reference("___row_number_y", rel43))
  )
  rel46 <- duckdb:::rel_project(
    rel45,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel42), duckdb:::expr_reference("o_orderkey", rel43))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel47 <- duckdb:::rel_project(
    rel46,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel48 <- duckdb:::rel_set_alias(rel47, "lhs")
  rel49 <- duckdb:::rel_set_alias(rel13, "rhs")
  rel50 <- duckdb:::rel_project(
    rel48,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel51 <- duckdb:::rel_project(
    rel49,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel52 <- duckdb:::rel_join(
    rel50,
    rel51,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel50), duckdb:::expr_reference("s_suppkey", rel51))
      )
    ),
    "inner"
  )
  rel53 <- duckdb:::rel_order(
    rel52,
    list(duckdb:::expr_reference("___row_number_x", rel50), duckdb:::expr_reference("___row_number_y", rel51))
  )
  rel54 <- duckdb:::rel_project(
    rel53,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel50), duckdb:::expr_reference("s_suppkey", rel51))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      }
    )
  )
  rel55 <- duckdb:::rel_filter(
    rel54,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "&",
            list(
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("n1_name"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("FRANCE", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("FRANCE")
                  }
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("n2_name"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("GERMANY", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("GERMANY")
                  }
                )
              )
            )
          ),
          duckdb:::expr_function(
            "&",
            list(
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("n1_name"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("GERMANY", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("GERMANY")
                  }
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("n2_name"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("FRANCE", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("FRANCE")
                  }
                )
              )
            )
          )
        )
      )
    )
  )
  rel56 <- duckdb:::rel_project(
    rel55,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      }
    )
  )
  rel57 <- duckdb:::rel_project(
    rel56,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("supp_nation")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "cust_nation")
        tmp_expr
      }
    )
  )
  rel58 <- duckdb:::rel_project(
    rel57,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("supp_nation")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cust_nation")
        duckdb:::expr_set_alias(tmp_expr, "cust_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "as.integer",
          list(
            duckdb:::expr_function(
              "strftime",
              list(
                duckdb:::expr_reference("l_shipdate"),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant("%Y", experimental = experimental)
                } else {
                  duckdb:::expr_constant("%Y")
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "l_year")
        tmp_expr
      }
    )
  )
  rel59 <- duckdb:::rel_project(
    rel58,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_name")
        duckdb:::expr_set_alias(tmp_expr, "n1_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("supp_nation")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cust_nation")
        duckdb:::expr_set_alias(tmp_expr, "cust_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_year")
        duckdb:::expr_set_alias(tmp_expr, "l_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel60 <- duckdb:::rel_project(
    rel59,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("supp_nation")
        duckdb:::expr_set_alias(tmp_expr, "supp_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cust_nation")
        duckdb:::expr_set_alias(tmp_expr, "cust_nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_year")
        duckdb:::expr_set_alias(tmp_expr, "l_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("volume")
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel61 <- duckdb:::rel_aggregate(
    rel60,
    groups = list(duckdb:::expr_reference("supp_nation"), duckdb:::expr_reference("cust_nation"), duckdb:::expr_reference("l_year")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel62 <- duckdb:::rel_order(
    rel61,
    list(duckdb:::expr_reference("supp_nation"), duckdb:::expr_reference("cust_nation"), duckdb:::expr_reference("l_year"))
  )
  rel62
  duckdb:::rel_to_altrep(rel62)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_08 <- function(con, experimental) {
  df1 <- nation
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_regionkey")
        tmp_expr
      }
    )
  )
  df2 <- region
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("r_name")
        duckdb:::expr_set_alias(tmp_expr, "r_name")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_filter(
    rel4,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("r_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("AMERICA", experimental = experimental)
          } else {
            duckdb:::expr_constant("AMERICA")
          }
        )
      )
    )
  )
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel2, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel6, "rhs")
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n1_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n1_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("r_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "r_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_join(
    rel9,
    rel10,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("n1_regionkey", rel9), duckdb:::expr_reference("r_regionkey", rel10))
      )
    ),
    "inner"
  )
  rel12 <- duckdb:::rel_order(
    rel11,
    list(duckdb:::expr_reference("___row_number_x", rel9), duckdb:::expr_reference("___row_number_y", rel10))
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n1_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("n1_regionkey", rel9), duckdb:::expr_reference("r_regionkey", rel10))
        )
        duckdb:::expr_set_alias(tmp_expr, "n1_regionkey")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n1_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      }
    )
  )
  df3 <- customer
  rel15 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel16 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_set_alias(rel16, "lhs")
  rel18 <- duckdb:::rel_set_alias(rel14, "rhs")
  rel19 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n1_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n1_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_join(
    rel19,
    rel20,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_nationkey", rel19), duckdb:::expr_reference("n1_nationkey", rel20))
      )
    ),
    "inner"
  )
  rel22 <- duckdb:::rel_order(
    rel21,
    list(duckdb:::expr_reference("___row_number_x", rel19), duckdb:::expr_reference("___row_number_y", rel20))
  )
  rel23 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_nationkey", rel19), duckdb:::expr_reference("n1_nationkey", rel20))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      }
    )
  )
  rel24 <- duckdb:::rel_project(
    rel23,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      }
    )
  )
  df4 <- orders
  rel25 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel26 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel27 <- duckdb:::rel_filter(
    rel26,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1996-12-31", experimental = experimental)
              } else {
                duckdb:::expr_constant("1996-12-31")
              }
            )
          )
        )
      )
    )
  )
  rel28 <- duckdb:::rel_set_alias(rel27, "lhs")
  rel29 <- duckdb:::rel_set_alias(rel24, "rhs")
  rel30 <- duckdb:::rel_project(
    rel28,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel31 <- duckdb:::rel_project(
    rel29,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel32 <- duckdb:::rel_join(
    rel30,
    rel31,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_custkey", rel30), duckdb:::expr_reference("c_custkey", rel31))
      )
    ),
    "inner"
  )
  rel33 <- duckdb:::rel_order(
    rel32,
    list(duckdb:::expr_reference("___row_number_x", rel30), duckdb:::expr_reference("___row_number_y", rel31))
  )
  rel34 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel30), duckdb:::expr_reference("c_custkey", rel31))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_project(
    rel34,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  df5 <- lineitem
  rel36 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel37 <- duckdb:::rel_project(
    rel36,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel38 <- duckdb:::rel_set_alias(rel37, "lhs")
  rel39 <- duckdb:::rel_set_alias(rel35, "rhs")
  rel40 <- duckdb:::rel_project(
    rel38,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel41 <- duckdb:::rel_project(
    rel39,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel42 <- duckdb:::rel_join(
    rel40,
    rel41,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel40), duckdb:::expr_reference("o_orderkey", rel41))
      )
    ),
    "inner"
  )
  rel43 <- duckdb:::rel_order(
    rel42,
    list(duckdb:::expr_reference("___row_number_x", rel40), duckdb:::expr_reference("___row_number_y", rel41))
  )
  rel44 <- duckdb:::rel_project(
    rel43,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel40), duckdb:::expr_reference("o_orderkey", rel41))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel45 <- duckdb:::rel_project(
    rel44,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  df6 <- part
  rel46 <- duckdb:::rel_from_df(con, df6, experimental = experimental)
  rel47 <- duckdb:::rel_project(
    rel46,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      }
    )
  )
  rel48 <- duckdb:::rel_filter(
    rel47,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("p_type"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("ECONOMY ANODIZED STEEL", experimental = experimental)
          } else {
            duckdb:::expr_constant("ECONOMY ANODIZED STEEL")
          }
        )
      )
    )
  )
  rel49 <- duckdb:::rel_project(
    rel48,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      }
    )
  )
  rel50 <- duckdb:::rel_set_alias(rel45, "lhs")
  rel51 <- duckdb:::rel_set_alias(rel49, "rhs")
  rel52 <- duckdb:::rel_project(
    rel50,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel53 <- duckdb:::rel_project(
    rel51,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel54 <- duckdb:::rel_join(
    rel52,
    rel53,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel52), duckdb:::expr_reference("p_partkey", rel53))
      )
    ),
    "inner"
  )
  rel55 <- duckdb:::rel_order(
    rel54,
    list(duckdb:::expr_reference("___row_number_x", rel52), duckdb:::expr_reference("___row_number_y", rel53))
  )
  rel56 <- duckdb:::rel_project(
    rel55,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel52), duckdb:::expr_reference("p_partkey", rel53))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel57 <- duckdb:::rel_project(
    rel56,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  df7 <- supplier
  rel58 <- duckdb:::rel_from_df(con, df7, experimental = experimental)
  rel59 <- duckdb:::rel_project(
    rel58,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  rel60 <- duckdb:::rel_set_alias(rel57, "lhs")
  rel61 <- duckdb:::rel_set_alias(rel59, "rhs")
  rel62 <- duckdb:::rel_project(
    rel60,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel63 <- duckdb:::rel_project(
    rel61,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel64 <- duckdb:::rel_join(
    rel62,
    rel63,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel62), duckdb:::expr_reference("s_suppkey", rel63))
      )
    ),
    "inner"
  )
  rel65 <- duckdb:::rel_order(
    rel64,
    list(duckdb:::expr_reference("___row_number_x", rel62), duckdb:::expr_reference("___row_number_y", rel63))
  )
  rel66 <- duckdb:::rel_project(
    rel65,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel62), duckdb:::expr_reference("s_suppkey", rel63))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  rel67 <- duckdb:::rel_project(
    rel66,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  rel68 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel69 <- duckdb:::rel_project(
    rel68,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n2_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel70 <- duckdb:::rel_set_alias(rel67, "lhs")
  rel71 <- duckdb:::rel_set_alias(rel69, "rhs")
  rel72 <- duckdb:::rel_project(
    rel70,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel73 <- duckdb:::rel_project(
    rel71,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n2_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n2_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel74 <- duckdb:::rel_join(
    rel72,
    rel73,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel72), duckdb:::expr_reference("n2_nationkey", rel73))
      )
    ),
    "inner"
  )
  rel75 <- duckdb:::rel_order(
    rel74,
    list(duckdb:::expr_reference("___row_number_x", rel72), duckdb:::expr_reference("___row_number_y", rel73))
  )
  rel76 <- duckdb:::rel_project(
    rel75,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel72), duckdb:::expr_reference("n2_nationkey", rel73))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel77 <- duckdb:::rel_project(
    rel76,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      }
    )
  )
  rel78 <- duckdb:::rel_project(
    rel77,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "as.integer",
          list(
            duckdb:::expr_function(
              "strftime",
              list(
                duckdb:::expr_reference("o_orderdate"),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant("%Y", experimental = experimental)
                } else {
                  duckdb:::expr_constant("%Y")
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      }
    )
  )
  rel79 <- duckdb:::rel_project(
    rel78,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel80 <- duckdb:::rel_project(
    rel79,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "n2_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("volume")
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n2_name")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      }
    )
  )
  rel81 <- duckdb:::rel_project(
    rel80,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("volume")
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("nation")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      }
    )
  )
  rel82 <- duckdb:::rel_aggregate(
    rel81,
    groups = list(duckdb:::expr_reference("o_year")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "/",
          list(
            duckdb:::expr_function(
              "sum",
              list(
                duckdb:::expr_function(
                  "ifelse",
                  list(
                    duckdb:::expr_function(
                      "==",
                      list(
                        duckdb:::expr_reference("nation"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("BRAZIL", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("BRAZIL")
                        }
                      )
                    ),
                    duckdb:::expr_reference("volume"),
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(0, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(0)
                    }
                  )
                )
              )
            ),
            duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "mkt_share")
        tmp_expr
      }
    )
  )
  rel83 <- duckdb:::rel_order(rel82, list(duckdb:::expr_reference("o_year")))
  rel83
  duckdb:::rel_to_altrep(rel83)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_09 <- function(con, experimental) {
  df1 <- part
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "grepl",
        list(
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("green", experimental = experimental)
          } else {
            duckdb:::expr_constant("green")
          },
          duckdb:::expr_reference("p_name")
        )
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      }
    )
  )
  df2 <- partsupp
  rel5 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel6, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_join(
    rel9,
    rel10,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_partkey", rel9), duckdb:::expr_reference("p_partkey", rel10))
      )
    ),
    "inner"
  )
  rel12 <- duckdb:::rel_order(
    rel11,
    list(duckdb:::expr_reference("___row_number_x", rel9), duckdb:::expr_reference("___row_number_y", rel10))
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_partkey", rel9), duckdb:::expr_reference("p_partkey", rel10))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      }
    )
  )
  df3 <- supplier
  rel14 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      }
    )
  )
  df4 <- nation
  rel16 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_set_alias(rel15, "lhs")
  rel19 <- duckdb:::rel_set_alias(rel17, "rhs")
  rel20 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_join(
    rel20,
    rel21,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel20), duckdb:::expr_reference("n_nationkey", rel21))
      )
    ),
    "inner"
  )
  rel23 <- duckdb:::rel_order(
    rel22,
    list(duckdb:::expr_reference("___row_number_x", rel20), duckdb:::expr_reference("___row_number_y", rel21))
  )
  rel24 <- duckdb:::rel_project(
    rel23,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel20), duckdb:::expr_reference("n_nationkey", rel21))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_set_alias(rel13, "lhs")
  rel27 <- duckdb:::rel_set_alias(rel25, "rhs")
  rel28 <- duckdb:::rel_project(
    rel26,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel29 <- duckdb:::rel_project(
    rel27,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_join(
    rel28,
    rel29,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel28), duckdb:::expr_reference("s_suppkey", rel29))
      )
    ),
    "inner"
  )
  rel31 <- duckdb:::rel_order(
    rel30,
    list(duckdb:::expr_reference("___row_number_x", rel28), duckdb:::expr_reference("___row_number_y", rel29))
  )
  rel32 <- duckdb:::rel_project(
    rel31,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel28), duckdb:::expr_reference("s_suppkey", rel29))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df5 <- lineitem
  rel33 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel34 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_set_alias(rel34, "lhs")
  rel36 <- duckdb:::rel_set_alias(rel32, "rhs")
  rel37 <- duckdb:::rel_project(
    rel35,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel38 <- duckdb:::rel_project(
    rel36,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_join(
    rel37,
    rel38,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel37), duckdb:::expr_reference("ps_suppkey", rel38))
      ),
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel37), duckdb:::expr_reference("ps_partkey", rel38))
      )
    ),
    "inner"
  )
  rel40 <- duckdb:::rel_order(
    rel39,
    list(duckdb:::expr_reference("___row_number_x", rel37), duckdb:::expr_reference("___row_number_y", rel38))
  )
  rel41 <- duckdb:::rel_project(
    rel40,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel37), duckdb:::expr_reference("ps_suppkey", rel38))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel37), duckdb:::expr_reference("ps_partkey", rel38))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel42 <- duckdb:::rel_project(
    rel41,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  df6 <- orders
  rel43 <- duckdb:::rel_from_df(con, df6, experimental = experimental)
  rel44 <- duckdb:::rel_project(
    rel43,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel45 <- duckdb:::rel_set_alias(rel44, "lhs")
  rel46 <- duckdb:::rel_set_alias(rel42, "rhs")
  rel47 <- duckdb:::rel_project(
    rel45,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel48 <- duckdb:::rel_project(
    rel46,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel49 <- duckdb:::rel_join(
    rel47,
    rel48,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_orderkey", rel47), duckdb:::expr_reference("l_orderkey", rel48))
      )
    ),
    "inner"
  )
  rel50 <- duckdb:::rel_order(
    rel49,
    list(duckdb:::expr_reference("___row_number_x", rel47), duckdb:::expr_reference("___row_number_y", rel48))
  )
  rel51 <- duckdb:::rel_project(
    rel50,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_orderkey", rel47), duckdb:::expr_reference("l_orderkey", rel48))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel52 <- duckdb:::rel_project(
    rel51,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel53 <- duckdb:::rel_project(
    rel52,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      }
    )
  )
  rel54 <- duckdb:::rel_project(
    rel53,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("nation")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "as.integer",
          list(
            duckdb:::expr_function(
              "strftime",
              list(
                duckdb:::expr_reference("o_orderdate"),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant("%Y", experimental = experimental)
                } else {
                  duckdb:::expr_constant("%Y")
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      }
    )
  )
  rel55 <- duckdb:::rel_project(
    rel54,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("nation")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "-",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_reference("l_extendedprice"),
                duckdb:::expr_function(
                  "-",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_discount")
                  )
                )
              )
            ),
            duckdb:::expr_function(
              "*",
              list(duckdb:::expr_reference("ps_supplycost"), duckdb:::expr_reference("l_quantity"))
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "amount")
        tmp_expr
      }
    )
  )
  rel56 <- duckdb:::rel_project(
    rel55,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("nation")
        duckdb:::expr_set_alias(tmp_expr, "nation")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_year")
        duckdb:::expr_set_alias(tmp_expr, "o_year")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("amount")
        duckdb:::expr_set_alias(tmp_expr, "amount")
        tmp_expr
      }
    )
  )
  rel57 <- duckdb:::rel_aggregate(
    rel56,
    groups = list(duckdb:::expr_reference("nation"), duckdb:::expr_reference("o_year")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("amount")))
        duckdb:::expr_set_alias(tmp_expr, "sum_profit")
        tmp_expr
      }
    )
  )
  rel58 <- duckdb:::rel_order(
    rel57,
    list(duckdb:::expr_reference("nation"), duckdb:::expr_function("desc", list(duckdb:::expr_reference("o_year"))))
  )
  rel58
  duckdb:::rel_to_altrep(rel58)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_10 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_project(
    rel1,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("l_returnflag"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("R", experimental = experimental)
          } else {
            duckdb:::expr_constant("R")
          }
        )
      )
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      }
    )
  )
  df2 <- orders
  rel5 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_filter(
    rel6,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1993-10-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1993-10-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("o_orderdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      )
    )
  )
  rel8 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_set_alias(rel4, "lhs")
  rel10 <- duckdb:::rel_set_alias(rel8, "rhs")
  rel11 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_join(
    rel11,
    rel12,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel11), duckdb:::expr_reference("o_orderkey", rel12))
      )
    ),
    "inner"
  )
  rel14 <- duckdb:::rel_order(
    rel13,
    list(duckdb:::expr_reference("___row_number_x", rel11), duckdb:::expr_reference("___row_number_y", rel12))
  )
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel11), duckdb:::expr_reference("o_orderkey", rel12))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_project(
    rel16,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_reference("l_extendedprice"),
            duckdb:::expr_function(
              "-",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                duckdb:::expr_reference("l_discount")
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "volume")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_aggregate(
    rel17,
    groups = list(duckdb:::expr_reference("o_custkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("volume")))
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  df3 <- customer
  rel19 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_set_alias(rel20, "lhs")
  rel22 <- duckdb:::rel_set_alias(rel18, "rhs")
  rel23 <- duckdb:::rel_project(
    rel21,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel24 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel25 <- duckdb:::rel_join(
    rel23,
    rel24,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_custkey", rel23), duckdb:::expr_reference("o_custkey", rel24))
      )
    ),
    "inner"
  )
  rel26 <- duckdb:::rel_order(
    rel25,
    list(duckdb:::expr_reference("___row_number_x", rel23), duckdb:::expr_reference("___row_number_y", rel24))
  )
  rel27 <- duckdb:::rel_project(
    rel26,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_custkey", rel23), duckdb:::expr_reference("o_custkey", rel24))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  df4 <- nation
  rel28 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel29 <- duckdb:::rel_project(
    rel28,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_set_alias(rel27, "lhs")
  rel31 <- duckdb:::rel_set_alias(rel29, "rhs")
  rel32 <- duckdb:::rel_project(
    rel30,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel33 <- duckdb:::rel_project(
    rel31,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel34 <- duckdb:::rel_join(
    rel32,
    rel33,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_nationkey", rel32), duckdb:::expr_reference("n_nationkey", rel33))
      )
    ),
    "inner"
  )
  rel35 <- duckdb:::rel_order(
    rel34,
    list(duckdb:::expr_reference("___row_number_x", rel32), duckdb:::expr_reference("___row_number_y", rel33))
  )
  rel36 <- duckdb:::rel_project(
    rel35,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_nationkey", rel32), duckdb:::expr_reference("n_nationkey", rel33))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      }
    )
  )
  rel37 <- duckdb:::rel_project(
    rel36,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("revenue")
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      }
    )
  )
  rel38 <- duckdb:::rel_order(rel37, list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("revenue")))))
  rel39 <- duckdb:::rel_limit(rel38, 20)
  rel39
  duckdb:::rel_to_altrep(rel39)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_11 <- function(con, experimental) {
  df1 <- nation
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("n_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("GERMANY", experimental = experimental)
          } else {
            duckdb:::expr_constant("GERMANY")
          }
        )
      )
    )
  )
  df2 <- partsupp
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "lhs")
  df3 <- supplier
  rel5 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel6 <- duckdb:::rel_set_alias(rel5, "rhs")
  rel7 <- duckdb:::rel_project(
    rel4,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_join(
    rel7,
    rel8,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel7), duckdb:::expr_reference("s_suppkey", rel8))
      )
    ),
    "inner"
  )
  rel10 <- duckdb:::rel_order(
    rel9,
    list(duckdb:::expr_reference("___row_number_x", rel7), duckdb:::expr_reference("___row_number_y", rel8))
  )
  rel11 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel7), duckdb:::expr_reference("s_suppkey", rel8))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_set_alias(rel11, "lhs")
  rel13 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel14 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_join(
    rel14,
    rel15,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel14), duckdb:::expr_reference("n_nationkey", rel15))
      )
    ),
    "inner"
  )
  rel17 <- duckdb:::rel_order(
    rel16,
    list(duckdb:::expr_reference("___row_number_x", rel14), duckdb:::expr_reference("___row_number_y", rel15))
  )
  rel18 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel14), duckdb:::expr_reference("n_nationkey", rel15))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      }
    )
  )
  rel19 <- duckdb:::rel_aggregate(
    rel18,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            duckdb:::expr_function(
              "sum",
              list(
                duckdb:::expr_function(
                  "*",
                  list(duckdb:::expr_reference("ps_supplycost"), duckdb:::expr_reference("ps_availqty"))
                )
              )
            ),
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(1e-04, experimental = experimental)
            } else {
              duckdb:::expr_constant(1e-04)
            }
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "global_value")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_distinct(rel19)
  rel21 <- duckdb:::rel_project(
    rel20,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("global_value")
        duckdb:::expr_set_alias(tmp_expr, "global_value")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_aggregate(
    rel18,
    groups = list(duckdb:::expr_reference("ps_partkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(duckdb:::expr_reference("ps_supplycost"), duckdb:::expr_reference("ps_availqty"))
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "value")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_project(
    rel22,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value")
        duckdb:::expr_set_alias(tmp_expr, "value")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      }
    )
  )
  rel24 <- duckdb:::rel_set_alias(rel23, "lhs")
  rel25 <- duckdb:::rel_set_alias(rel21, "rhs")
  rel26 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value")
        duckdb:::expr_set_alias(tmp_expr, "value_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_x")
        tmp_expr
      }
    )
  )
  rel27 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("global_value")
        duckdb:::expr_set_alias(tmp_expr, "global_value_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_y")
        tmp_expr
      }
    )
  )
  rel28 <- duckdb:::rel_project(
    rel26,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey_x")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value_x")
        duckdb:::expr_set_alias(tmp_expr, "value_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key_x")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel29 <- duckdb:::rel_project(
    rel27,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("global_value_y")
        duckdb:::expr_set_alias(tmp_expr, "global_value_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key_y")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel30 <- duckdb:::rel_join(
    rel28,
    rel29,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("global_agr_key_x", rel28), duckdb:::expr_reference("global_agr_key_y", rel29))
      )
    ),
    "inner"
  )
  rel31 <- duckdb:::rel_order(
    rel30,
    list(duckdb:::expr_reference("___row_number_x", rel28), duckdb:::expr_reference("___row_number_y", rel29))
  )
  rel32 <- duckdb:::rel_project(
    rel31,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey_x")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value_x")
        duckdb:::expr_set_alias(tmp_expr, "value")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("global_agr_key_x", rel28), duckdb:::expr_reference("global_agr_key_y", rel29))
        )
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_value_y")
        duckdb:::expr_set_alias(tmp_expr, "global_value")
        tmp_expr
      }
    )
  )
  rel33 <- duckdb:::rel_filter(
    rel32,
    list(
      duckdb:::expr_function(">", list(duckdb:::expr_reference("value"), duckdb:::expr_reference("global_value")))
    )
  )
  rel34 <- duckdb:::rel_order(rel33, list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("value")))))
  rel35 <- duckdb:::rel_project(
    rel34,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("value")
        duckdb:::expr_set_alias(tmp_expr, "value")
        tmp_expr
      }
    )
  )
  rel35
  duckdb:::rel_to_altrep(rel35)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_12 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "==",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("MAIL", experimental = experimental)
              } else {
                duckdb:::expr_constant("MAIL")
              },
              duckdb:::expr_reference("l_shipmode")
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("SHIP", experimental = experimental)
              } else {
                duckdb:::expr_constant("SHIP")
              },
              duckdb:::expr_reference("l_shipmode")
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(duckdb:::expr_reference("l_commitdate"), duckdb:::expr_reference("l_receiptdate"))
      ),
      duckdb:::expr_function(
        "<",
        list(duckdb:::expr_reference("l_shipdate"), duckdb:::expr_reference("l_commitdate"))
      ),
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_receiptdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_receiptdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      )
    )
  )
  rel3 <- duckdb:::rel_set_alias(rel2, "lhs")
  df2 <- orders
  rel4 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel5 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel6 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel6), duckdb:::expr_reference("o_orderkey", rel7))
      )
    ),
    "inner"
  )
  rel9 <- duckdb:::rel_order(
    rel8,
    list(duckdb:::expr_reference("___row_number_x", rel6), duckdb:::expr_reference("___row_number_y", rel7))
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel6), duckdb:::expr_reference("o_orderkey", rel7))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_aggregate(
    rel10,
    groups = list(duckdb:::expr_reference("l_shipmode")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "ifelse",
              list(
                duckdb:::expr_function(
                  "|",
                  list(
                    duckdb:::expr_function(
                      "==",
                      list(
                        duckdb:::expr_reference("o_orderpriority"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("1-URGENT", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("1-URGENT")
                        }
                      )
                    ),
                    duckdb:::expr_function(
                      "==",
                      list(
                        duckdb:::expr_reference("o_orderpriority"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("2-HIGH", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("2-HIGH")
                        }
                      )
                    )
                  )
                ),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1L)
                },
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(0L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(0L)
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "high_line_count")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "ifelse",
              list(
                duckdb:::expr_function(
                  "&",
                  list(
                    duckdb:::expr_function(
                      "!=",
                      list(
                        duckdb:::expr_reference("o_orderpriority"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("1-URGENT", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("1-URGENT")
                        }
                      )
                    ),
                    duckdb:::expr_function(
                      "!=",
                      list(
                        duckdb:::expr_reference("o_orderpriority"),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant("2-HIGH", experimental = experimental)
                        } else {
                          duckdb:::expr_constant("2-HIGH")
                        }
                      )
                    )
                  )
                ),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1L)
                },
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(0L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(0L)
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "low_line_count")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_order(rel11, list(duckdb:::expr_reference("l_shipmode")))
  rel12
  duckdb:::rel_to_altrep(rel12)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_13 <- function(con, experimental) {
  df1 <- orders
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "!",
        list(
          duckdb:::expr_function(
            "grepl",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("special.*?requests", experimental = experimental)
              } else {
                duckdb:::expr_constant("special.*?requests")
              },
              duckdb:::expr_reference("o_comment")
            )
          )
        )
      )
    )
  )
  df2 <- customer
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "lhs")
  rel5 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel6 <- duckdb:::rel_project(
    rel4,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_custkey", rel6), duckdb:::expr_reference("o_custkey", rel7))
      )
    ),
    "left"
  )
  rel9 <- duckdb:::rel_order(
    rel8,
    list(duckdb:::expr_reference("___row_number_x", rel6), duckdb:::expr_reference("___row_number_y", rel7))
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("c_custkey", rel6), duckdb:::expr_reference("o_custkey", rel7))
        )
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_aggregate(
    rel10,
    groups = list(duckdb:::expr_reference("c_custkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "ifelse",
              list(
                duckdb:::expr_function("is.na", list(duckdb:::expr_reference("o_orderkey"))),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(0L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(0L)
                },
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1L, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1L)
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "c_count")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_aggregate(
    rel11,
    groups = list(duckdb:::expr_reference("c_count")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "custdist")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_order(
    rel12,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("custdist"))), duckdb:::expr_function("desc", list(duckdb:::expr_reference("c_count"))))
  )
  rel13
  duckdb:::rel_to_altrep(rel13)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_14 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-09-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-09-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-10-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-10-01")
              }
            )
          )
        )
      )
    )
  )
  rel3 <- duckdb:::rel_set_alias(rel2, "lhs")
  df2 <- part
  rel4 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel5 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel6 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel6), duckdb:::expr_reference("p_partkey", rel7))
      )
    ),
    "inner"
  )
  rel9 <- duckdb:::rel_order(
    rel8,
    list(duckdb:::expr_reference("___row_number_x", rel6), duckdb:::expr_reference("___row_number_y", rel7))
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel6), duckdb:::expr_reference("p_partkey", rel7))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_aggregate(
    rel10,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "/",
          list(
            duckdb:::expr_function(
              "*",
              list(
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(100, experimental = experimental)
                } else {
                  duckdb:::expr_constant(100)
                },
                duckdb:::expr_function(
                  "sum",
                  list(
                    duckdb:::expr_function(
                      "ifelse",
                      list(
                        duckdb:::expr_function(
                          "grepl",
                          list(
                            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                              duckdb:::expr_constant("^PROMO", experimental = experimental)
                            } else {
                              duckdb:::expr_constant("^PROMO")
                            },
                            duckdb:::expr_reference("p_type")
                          )
                        ),
                        duckdb:::expr_function(
                          "*",
                          list(
                            duckdb:::expr_reference("l_extendedprice"),
                            duckdb:::expr_function(
                              "-",
                              list(
                                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                  duckdb:::expr_constant(1, experimental = experimental)
                                } else {
                                  duckdb:::expr_constant(1)
                                },
                                duckdb:::expr_reference("l_discount")
                              )
                            )
                          )
                        ),
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant(0, experimental = experimental)
                        } else {
                          duckdb:::expr_constant(0)
                        }
                      )
                    )
                  )
                )
              )
            ),
            duckdb:::expr_function(
              "sum",
              list(
                duckdb:::expr_function(
                  "*",
                  list(
                    duckdb:::expr_reference("l_extendedprice"),
                    duckdb:::expr_function(
                      "-",
                      list(
                        if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                          duckdb:::expr_constant(1, experimental = experimental)
                        } else {
                          duckdb:::expr_constant(1)
                        },
                        duckdb:::expr_reference("l_discount")
                      )
                    )
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "promo_revenue")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_distinct(rel11)
  rel12
  duckdb:::rel_to_altrep(rel12)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_15 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1996-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1996-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1996-04-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1996-04-01")
              }
            )
          )
        )
      )
    )
  )
  rel3 <- duckdb:::rel_aggregate(
    rel2,
    groups = list(duckdb:::expr_reference("l_suppkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_reference("l_extendedprice"),
                duckdb:::expr_function(
                  "-",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_discount")
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      }
    )
  )
  rel4 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      }
    )
  )
  rel5 <- duckdb:::rel_aggregate(
    rel4,
    groups = list(duckdb:::expr_reference("global_agr_key")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("max", list(duckdb:::expr_reference("total_revenue")))
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_project(
    rel3,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_set_alias(rel6, "lhs")
  rel8 <- duckdb:::rel_set_alias(rel5, "rhs")
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_x")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("max_total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue_y")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue_x")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key_x")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key_y")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("max_total_revenue_y")
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_join(
    rel11,
    rel12,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("global_agr_key_x", rel11), duckdb:::expr_reference("global_agr_key_y", rel12))
      )
    ),
    "inner"
  )
  rel14 <- duckdb:::rel_order(
    rel13,
    list(duckdb:::expr_reference("___row_number_x", rel11), duckdb:::expr_reference("___row_number_y", rel12))
  )
  rel15 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue_x")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("global_agr_key_x", rel11), duckdb:::expr_reference("global_agr_key_y", rel12))
        )
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("max_total_revenue_y")
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_filter(
    rel15,
    list(
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_function(
            "abs",
            list(
              duckdb:::expr_function(
                "-",
                list(duckdb:::expr_reference("total_revenue"), duckdb:::expr_reference("max_total_revenue"))
              )
            )
          ),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(1e-09, experimental = experimental)
          } else {
            duckdb:::expr_constant(1e-09)
          }
        )
      )
    )
  )
  rel17 <- duckdb:::rel_set_alias(rel16, "lhs")
  df2 <- supplier
  rel18 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel19 <- duckdb:::rel_set_alias(rel18, "rhs")
  rel20 <- duckdb:::rel_project(
    rel17,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("max_total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_join(
    rel20,
    rel21,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel20), duckdb:::expr_reference("s_suppkey", rel21))
      )
    ),
    "inner"
  )
  rel23 <- duckdb:::rel_order(
    rel22,
    list(duckdb:::expr_reference("___row_number_x", rel20), duckdb:::expr_reference("___row_number_y", rel21))
  )
  rel24 <- duckdb:::rel_project(
    rel23,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_suppkey", rel20), duckdb:::expr_reference("s_suppkey", rel21))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("global_agr_key")
        duckdb:::expr_set_alias(tmp_expr, "global_agr_key")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("max_total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "max_total_revenue")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("total_revenue")
        duckdb:::expr_set_alias(tmp_expr, "total_revenue")
        tmp_expr
      }
    )
  )
  rel25
  duckdb:::rel_to_altrep(rel25)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_16 <- function(con, experimental) {
  df1 <- part
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "!=",
        list(
          duckdb:::expr_reference("p_brand"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("Brand#45", experimental = experimental)
          } else {
            duckdb:::expr_constant("Brand#45")
          }
        )
      ),
      duckdb:::expr_function(
        "!",
        list(
          duckdb:::expr_function(
            "grepl",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("^MEDIUM POLISHED", experimental = experimental)
              } else {
                duckdb:::expr_constant("^MEDIUM POLISHED")
              },
              duckdb:::expr_reference("p_type")
            )
          )
        )
      ),
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "|",
            list(
              duckdb:::expr_function(
                "|",
                list(
                  duckdb:::expr_function(
                    "|",
                    list(
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "|",
                            list(
                              duckdb:::expr_function(
                                "|",
                                list(
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(49, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(49)
                                      },
                                      duckdb:::expr_reference("p_size")
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(14, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(14)
                                      },
                                      duckdb:::expr_reference("p_size")
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                "==",
                                list(
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(23, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(23)
                                  },
                                  duckdb:::expr_reference("p_size")
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(45, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(45)
                              },
                              duckdb:::expr_reference("p_size")
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant(19, experimental = experimental)
                          } else {
                            duckdb:::expr_constant(19)
                          },
                          duckdb:::expr_reference("p_size")
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant(3, experimental = experimental)
                      } else {
                        duckdb:::expr_constant(3)
                      },
                      duckdb:::expr_reference("p_size")
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant(36, experimental = experimental)
                  } else {
                    duckdb:::expr_constant(36)
                  },
                  duckdb:::expr_reference("p_size")
                )
              )
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant(9, experimental = experimental)
              } else {
                duckdb:::expr_constant(9)
              },
              duckdb:::expr_reference("p_size")
            )
          )
        )
      )
    )
  )
  df2 <- supplier
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_filter(
    rel3,
    list(
      duckdb:::expr_function(
        "!",
        list(
          duckdb:::expr_function(
            "grepl",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("Customer.*?Complaints", experimental = experimental)
              } else {
                duckdb:::expr_constant("Customer.*?Complaints")
              },
              duckdb:::expr_reference("s_comment")
            )
          )
        )
      )
    )
  )
  df3 <- partsupp
  rel5 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel6 <- duckdb:::rel_set_alias(rel5, "lhs")
  rel7 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel8 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_project(
    rel7,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_join(
    rel8,
    rel9,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel8), duckdb:::expr_reference("s_suppkey", rel9))
      )
    ),
    "inner"
  )
  rel11 <- duckdb:::rel_order(
    rel10,
    list(duckdb:::expr_reference("___row_number_x", rel8), duckdb:::expr_reference("___row_number_y", rel9))
  )
  rel12 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel8), duckdb:::expr_reference("s_suppkey", rel9))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_set_alias(rel2, "lhs")
  rel15 <- duckdb:::rel_set_alias(rel13, "rhs")
  rel16 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_join(
    rel16,
    rel17,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("p_partkey", rel16), duckdb:::expr_reference("ps_partkey", rel17))
      )
    ),
    "inner"
  )
  rel19 <- duckdb:::rel_order(
    rel18,
    list(duckdb:::expr_reference("___row_number_x", rel16), duckdb:::expr_reference("___row_number_y", rel17))
  )
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("p_partkey", rel16), duckdb:::expr_reference("ps_partkey", rel17))
        )
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_aggregate(
    rel20,
    groups = list(duckdb:::expr_reference("p_brand"), duckdb:::expr_reference("p_type"), duckdb:::expr_reference("p_size")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n_distinct", list(duckdb:::expr_reference("ps_suppkey")))
        duckdb:::expr_set_alias(tmp_expr, "supplier_cnt")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_project(
    rel21,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("supplier_cnt")
        duckdb:::expr_set_alias(tmp_expr, "supplier_cnt")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_order(
    rel22,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("supplier_cnt"))), duckdb:::expr_reference("p_brand"), duckdb:::expr_reference("p_type"), duckdb:::expr_reference("p_size"))
  )
  rel23
  duckdb:::rel_to_altrep(rel23)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_17 <- function(con, experimental) {
  df1 <- part
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("p_brand"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("Brand#23", experimental = experimental)
          } else {
            duckdb:::expr_constant("Brand#23")
          }
        )
      ),
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("p_container"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("MED BOX", experimental = experimental)
          } else {
            duckdb:::expr_constant("MED BOX")
          }
        )
      )
    )
  )
  df2 <- lineitem
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "lhs")
  rel5 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel6 <- duckdb:::rel_project(
    rel4,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel6), duckdb:::expr_reference("p_partkey", rel7))
      )
    ),
    "inner"
  )
  rel9 <- duckdb:::rel_order(
    rel8,
    list(duckdb:::expr_reference("___row_number_x", rel6), duckdb:::expr_reference("___row_number_y", rel7))
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel6), duckdb:::expr_reference("p_partkey", rel7))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_aggregate(
    rel10,
    groups = list(duckdb:::expr_reference("l_partkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(0.2, experimental = experimental)
            } else {
              duckdb:::expr_constant(0.2)
            },
            duckdb:::expr_function("mean", list(duckdb:::expr_reference("l_quantity")))
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "quantity_threshold")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_set_alias(rel10, "lhs")
  rel13 <- duckdb:::rel_set_alias(rel11, "rhs")
  rel14 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment_x")
        tmp_expr
      }
    )
  )
  rel15 <- duckdb:::rel_project(
    rel13,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("quantity_threshold")
        duckdb:::expr_set_alias(tmp_expr, "quantity_threshold_y")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber_x")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity_x")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice_x")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount_x")
        duckdb:::expr_set_alias(tmp_expr, "l_discount_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax_x")
        duckdb:::expr_set_alias(tmp_expr, "l_tax_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag_x")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus_x")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "l_comment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name_x")
        duckdb:::expr_set_alias(tmp_expr, "p_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr_x")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand_x")
        duckdb:::expr_set_alias(tmp_expr, "p_brand_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type_x")
        duckdb:::expr_set_alias(tmp_expr, "p_type_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size_x")
        duckdb:::expr_set_alias(tmp_expr, "p_size_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container_x")
        duckdb:::expr_set_alias(tmp_expr, "p_container_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice_x")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "p_comment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey_y")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("quantity_threshold_y")
        duckdb:::expr_set_alias(tmp_expr, "quantity_threshold_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_join(
    rel16,
    rel17,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey_x", rel16), duckdb:::expr_reference("l_partkey_y", rel17))
      )
    ),
    "inner"
  )
  rel19 <- duckdb:::rel_order(
    rel18,
    list(duckdb:::expr_reference("___row_number_x", rel16), duckdb:::expr_reference("___row_number_y", rel17))
  )
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey_x", rel16), duckdb:::expr_reference("l_partkey_y", rel17))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey_x")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber_x")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity_x")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice_x")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount_x")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax_x")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag_x")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus_x")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate_x")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode_x")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name_x")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr_x")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand_x")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type_x")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size_x")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container_x")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice_x")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("quantity_threshold_y")
        duckdb:::expr_set_alias(tmp_expr, "quantity_threshold")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_filter(
    rel20,
    list(
      duckdb:::expr_function(
        "<",
        list(duckdb:::expr_reference("l_quantity"), duckdb:::expr_reference("quantity_threshold"))
      )
    )
  )
  rel22 <- duckdb:::rel_aggregate(
    rel21,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "/",
          list(
            duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_extendedprice"))),
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(7, experimental = experimental)
            } else {
              duckdb:::expr_constant(7)
            }
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "avg_yearly")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_distinct(rel22)
  rel23
  duckdb:::rel_to_altrep(rel23)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_18 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_aggregate(
    rel1,
    groups = list(duckdb:::expr_reference("l_orderkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_quantity")))
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_filter(
    rel2,
    list(
      duckdb:::expr_function(
        ">",
        list(
          duckdb:::expr_reference("sum"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(300, experimental = experimental)
          } else {
            duckdb:::expr_constant(300)
          }
        )
      )
    )
  )
  df2 <- orders
  rel4 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel5 <- duckdb:::rel_set_alias(rel4, "lhs")
  rel6 <- duckdb:::rel_set_alias(rel3, "rhs")
  rel7 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("sum")
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_join(
    rel7,
    rel8,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_orderkey", rel7), duckdb:::expr_reference("l_orderkey", rel8))
      )
    ),
    "inner"
  )
  rel10 <- duckdb:::rel_order(
    rel9,
    list(duckdb:::expr_reference("___row_number_x", rel7), duckdb:::expr_reference("___row_number_y", rel8))
  )
  rel11 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_orderkey", rel7), duckdb:::expr_reference("l_orderkey", rel8))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("sum")
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_set_alias(rel11, "lhs")
  df3 <- customer
  rel13 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel14 <- duckdb:::rel_set_alias(rel13, "rhs")
  rel15 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("sum")
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_join(
    rel15,
    rel16,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("o_custkey", rel15), duckdb:::expr_reference("c_custkey", rel16))
      )
    ),
    "inner"
  )
  rel18 <- duckdb:::rel_order(
    rel17,
    list(duckdb:::expr_reference("___row_number_x", rel15), duckdb:::expr_reference("___row_number_y", rel16))
  )
  rel19 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("o_custkey", rel15), duckdb:::expr_reference("c_custkey", rel16))
        )
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("sum")
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("sum")
        duckdb:::expr_set_alias(tmp_expr, "sum")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_order(
    rel20,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("o_totalprice"))), duckdb:::expr_reference("o_orderdate"))
  )
  rel22 <- duckdb:::rel_limit(rel21, 100)
  rel22
  duckdb:::rel_to_altrep(rel22)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_19 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_set_alias(rel1, "lhs")
  df2 <- part
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "rhs")
  rel5 <- duckdb:::rel_project(
    rel2,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel6 <- duckdb:::rel_project(
    rel4,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("p_partkey")
        duckdb:::expr_set_alias(tmp_expr, "p_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_join(
    rel5,
    rel6,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel5), duckdb:::expr_reference("p_partkey", rel6))
      )
    ),
    "inner"
  )
  rel8 <- duckdb:::rel_order(
    rel7,
    list(duckdb:::expr_reference("___row_number_x", rel5), duckdb:::expr_reference("___row_number_y", rel6))
  )
  rel9 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_partkey", rel5), duckdb:::expr_reference("p_partkey", rel6))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_name")
        duckdb:::expr_set_alias(tmp_expr, "p_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_mfgr")
        duckdb:::expr_set_alias(tmp_expr, "p_mfgr")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_brand")
        duckdb:::expr_set_alias(tmp_expr, "p_brand")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_type")
        duckdb:::expr_set_alias(tmp_expr, "p_type")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_size")
        duckdb:::expr_set_alias(tmp_expr, "p_size")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_container")
        duckdb:::expr_set_alias(tmp_expr, "p_container")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_retailprice")
        duckdb:::expr_set_alias(tmp_expr, "p_retailprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("p_comment")
        duckdb:::expr_set_alias(tmp_expr, "p_comment")
        tmp_expr
      }
    )
  )
  rel10 <- duckdb:::rel_filter(
    rel9,
    list(
      duckdb:::expr_function(
        "|",
        list(
          duckdb:::expr_function(
            "|",
            list(
              duckdb:::expr_function(
                "&",
                list(
                  duckdb:::expr_function(
                    "&",
                    list(
                      duckdb:::expr_function(
                        "&",
                        list(
                          duckdb:::expr_function(
                            "&",
                            list(
                              duckdb:::expr_function(
                                "&",
                                list(
                                  duckdb:::expr_function(
                                    "&",
                                    list(
                                      duckdb:::expr_function(
                                        "&",
                                        list(
                                          duckdb:::expr_function(
                                            "==",
                                            list(
                                              duckdb:::expr_reference("p_brand"),
                                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                duckdb:::expr_constant("Brand#12", experimental = experimental)
                                              } else {
                                                duckdb:::expr_constant("Brand#12")
                                              }
                                            )
                                          ),
                                          duckdb:::expr_function(
                                            "|",
                                            list(
                                              duckdb:::expr_function(
                                                "|",
                                                list(
                                                  duckdb:::expr_function(
                                                    "|",
                                                    list(
                                                      duckdb:::expr_function(
                                                        "==",
                                                        list(
                                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                            duckdb:::expr_constant("SM CASE", experimental = experimental)
                                                          } else {
                                                            duckdb:::expr_constant("SM CASE")
                                                          },
                                                          duckdb:::expr_reference("p_container")
                                                        )
                                                      ),
                                                      duckdb:::expr_function(
                                                        "==",
                                                        list(
                                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                            duckdb:::expr_constant("SM BOX", experimental = experimental)
                                                          } else {
                                                            duckdb:::expr_constant("SM BOX")
                                                          },
                                                          duckdb:::expr_reference("p_container")
                                                        )
                                                      )
                                                    )
                                                  ),
                                                  duckdb:::expr_function(
                                                    "==",
                                                    list(
                                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                        duckdb:::expr_constant("SM PACK", experimental = experimental)
                                                      } else {
                                                        duckdb:::expr_constant("SM PACK")
                                                      },
                                                      duckdb:::expr_reference("p_container")
                                                    )
                                                  )
                                                )
                                              ),
                                              duckdb:::expr_function(
                                                "==",
                                                list(
                                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                    duckdb:::expr_constant("SM PKG", experimental = experimental)
                                                  } else {
                                                    duckdb:::expr_constant("SM PKG")
                                                  },
                                                  duckdb:::expr_reference("p_container")
                                                )
                                              )
                                            )
                                          )
                                        )
                                      ),
                                      duckdb:::expr_function(
                                        ">=",
                                        list(
                                          duckdb:::expr_reference("l_quantity"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(1, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(1)
                                          }
                                        )
                                      )
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "<=",
                                    list(
                                      duckdb:::expr_reference("l_quantity"),
                                      duckdb:::expr_function(
                                        "+",
                                        list(
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(1, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(1)
                                          },
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(10, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(10)
                                          }
                                        )
                                      )
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                ">=",
                                list(
                                  duckdb:::expr_reference("p_size"),
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(1, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(1)
                                  }
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "<=",
                            list(
                              duckdb:::expr_reference("p_size"),
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(5, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(5)
                              }
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("AIR", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("AIR")
                              },
                              duckdb:::expr_reference("l_shipmode")
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("AIR REG", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("AIR REG")
                              },
                              duckdb:::expr_reference("l_shipmode")
                            )
                          )
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      duckdb:::expr_reference("l_shipinstruct"),
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant("DELIVER IN PERSON", experimental = experimental)
                      } else {
                        duckdb:::expr_constant("DELIVER IN PERSON")
                      }
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "&",
                list(
                  duckdb:::expr_function(
                    "&",
                    list(
                      duckdb:::expr_function(
                        "&",
                        list(
                          duckdb:::expr_function(
                            "&",
                            list(
                              duckdb:::expr_function(
                                "&",
                                list(
                                  duckdb:::expr_function(
                                    "&",
                                    list(
                                      duckdb:::expr_function(
                                        "&",
                                        list(
                                          duckdb:::expr_function(
                                            "==",
                                            list(
                                              duckdb:::expr_reference("p_brand"),
                                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                duckdb:::expr_constant("Brand#23", experimental = experimental)
                                              } else {
                                                duckdb:::expr_constant("Brand#23")
                                              }
                                            )
                                          ),
                                          duckdb:::expr_function(
                                            "|",
                                            list(
                                              duckdb:::expr_function(
                                                "|",
                                                list(
                                                  duckdb:::expr_function(
                                                    "|",
                                                    list(
                                                      duckdb:::expr_function(
                                                        "==",
                                                        list(
                                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                            duckdb:::expr_constant("MED BAG", experimental = experimental)
                                                          } else {
                                                            duckdb:::expr_constant("MED BAG")
                                                          },
                                                          duckdb:::expr_reference("p_container")
                                                        )
                                                      ),
                                                      duckdb:::expr_function(
                                                        "==",
                                                        list(
                                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                            duckdb:::expr_constant("MED BOX", experimental = experimental)
                                                          } else {
                                                            duckdb:::expr_constant("MED BOX")
                                                          },
                                                          duckdb:::expr_reference("p_container")
                                                        )
                                                      )
                                                    )
                                                  ),
                                                  duckdb:::expr_function(
                                                    "==",
                                                    list(
                                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                        duckdb:::expr_constant("MED PKG", experimental = experimental)
                                                      } else {
                                                        duckdb:::expr_constant("MED PKG")
                                                      },
                                                      duckdb:::expr_reference("p_container")
                                                    )
                                                  )
                                                )
                                              ),
                                              duckdb:::expr_function(
                                                "==",
                                                list(
                                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                    duckdb:::expr_constant("MED PACK", experimental = experimental)
                                                  } else {
                                                    duckdb:::expr_constant("MED PACK")
                                                  },
                                                  duckdb:::expr_reference("p_container")
                                                )
                                              )
                                            )
                                          )
                                        )
                                      ),
                                      duckdb:::expr_function(
                                        ">=",
                                        list(
                                          duckdb:::expr_reference("l_quantity"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(10, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(10)
                                          }
                                        )
                                      )
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "<=",
                                    list(
                                      duckdb:::expr_reference("l_quantity"),
                                      duckdb:::expr_function(
                                        "+",
                                        list(
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(10, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(10)
                                          },
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(10, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(10)
                                          }
                                        )
                                      )
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                ">=",
                                list(
                                  duckdb:::expr_reference("p_size"),
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(1, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(1)
                                  }
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "<=",
                            list(
                              duckdb:::expr_reference("p_size"),
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(10, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(10)
                              }
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("AIR", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("AIR")
                              },
                              duckdb:::expr_reference("l_shipmode")
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("AIR REG", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("AIR REG")
                              },
                              duckdb:::expr_reference("l_shipmode")
                            )
                          )
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      duckdb:::expr_reference("l_shipinstruct"),
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant("DELIVER IN PERSON", experimental = experimental)
                      } else {
                        duckdb:::expr_constant("DELIVER IN PERSON")
                      }
                    )
                  )
                )
              )
            )
          ),
          duckdb:::expr_function(
            "&",
            list(
              duckdb:::expr_function(
                "&",
                list(
                  duckdb:::expr_function(
                    "&",
                    list(
                      duckdb:::expr_function(
                        "&",
                        list(
                          duckdb:::expr_function(
                            "&",
                            list(
                              duckdb:::expr_function(
                                "&",
                                list(
                                  duckdb:::expr_function(
                                    "&",
                                    list(
                                      duckdb:::expr_function(
                                        "==",
                                        list(
                                          duckdb:::expr_reference("p_brand"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant("Brand#34", experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant("Brand#34")
                                          }
                                        )
                                      ),
                                      duckdb:::expr_function(
                                        "|",
                                        list(
                                          duckdb:::expr_function(
                                            "|",
                                            list(
                                              duckdb:::expr_function(
                                                "|",
                                                list(
                                                  duckdb:::expr_function(
                                                    "==",
                                                    list(
                                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                        duckdb:::expr_constant("LG CASE", experimental = experimental)
                                                      } else {
                                                        duckdb:::expr_constant("LG CASE")
                                                      },
                                                      duckdb:::expr_reference("p_container")
                                                    )
                                                  ),
                                                  duckdb:::expr_function(
                                                    "==",
                                                    list(
                                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                        duckdb:::expr_constant("LG BOX", experimental = experimental)
                                                      } else {
                                                        duckdb:::expr_constant("LG BOX")
                                                      },
                                                      duckdb:::expr_reference("p_container")
                                                    )
                                                  )
                                                )
                                              ),
                                              duckdb:::expr_function(
                                                "==",
                                                list(
                                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                    duckdb:::expr_constant("LG PACK", experimental = experimental)
                                                  } else {
                                                    duckdb:::expr_constant("LG PACK")
                                                  },
                                                  duckdb:::expr_reference("p_container")
                                                )
                                              )
                                            )
                                          ),
                                          duckdb:::expr_function(
                                            "==",
                                            list(
                                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                                duckdb:::expr_constant("LG PKG", experimental = experimental)
                                              } else {
                                                duckdb:::expr_constant("LG PKG")
                                              },
                                              duckdb:::expr_reference("p_container")
                                            )
                                          )
                                        )
                                      )
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    ">=",
                                    list(
                                      duckdb:::expr_reference("l_quantity"),
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(20, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(20)
                                      }
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                "<=",
                                list(
                                  duckdb:::expr_reference("l_quantity"),
                                  duckdb:::expr_function(
                                    "+",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(20, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(20)
                                      },
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(10, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(10)
                                      }
                                    )
                                  )
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            ">=",
                            list(
                              duckdb:::expr_reference("p_size"),
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(1, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(1)
                              }
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "<=",
                        list(
                          duckdb:::expr_reference("p_size"),
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant(15, experimental = experimental)
                          } else {
                            duckdb:::expr_constant(15)
                          }
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "|",
                    list(
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant("AIR", experimental = experimental)
                          } else {
                            duckdb:::expr_constant("AIR")
                          },
                          duckdb:::expr_reference("l_shipmode")
                        )
                      ),
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant("AIR REG", experimental = experimental)
                          } else {
                            duckdb:::expr_constant("AIR REG")
                          },
                          duckdb:::expr_reference("l_shipmode")
                        )
                      )
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  duckdb:::expr_reference("l_shipinstruct"),
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("DELIVER IN PERSON", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("DELIVER IN PERSON")
                  }
                )
              )
            )
          )
        )
      )
    )
  )
  rel11 <- duckdb:::rel_aggregate(
    rel10,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "*",
              list(
                duckdb:::expr_reference("l_extendedprice"),
                duckdb:::expr_function(
                  "-",
                  list(
                    if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                      duckdb:::expr_constant(1, experimental = experimental)
                    } else {
                      duckdb:::expr_constant(1)
                    },
                    duckdb:::expr_reference("l_discount")
                  )
                )
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "revenue")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_distinct(rel11)
  rel12
  duckdb:::rel_to_altrep(rel12)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_20 <- function(con, experimental) {
  df1 <- nation
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("n_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("CANADA", experimental = experimental)
          } else {
            duckdb:::expr_constant("CANADA")
          }
        )
      )
    )
  )
  df2 <- supplier
  rel3 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel4 <- duckdb:::rel_set_alias(rel3, "lhs")
  rel5 <- duckdb:::rel_set_alias(rel2, "rhs")
  rel6 <- duckdb:::rel_project(
    rel4,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_join(
    rel6,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel6), duckdb:::expr_reference("n_nationkey", rel7))
      )
    ),
    "inner"
  )
  rel9 <- duckdb:::rel_order(
    rel8,
    list(duckdb:::expr_reference("___row_number_x", rel6), duckdb:::expr_reference("___row_number_y", rel7))
  )
  rel10 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel6), duckdb:::expr_reference("n_nationkey", rel7))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      }
    )
  )
  df3 <- part
  rel12 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel13 <- duckdb:::rel_filter(
    rel12,
    list(
      duckdb:::expr_function(
        "grepl",
        list(
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("^forest", experimental = experimental)
          } else {
            duckdb:::expr_constant("^forest")
          },
          duckdb:::expr_reference("p_name")
        )
      )
    )
  )
  df4 <- partsupp
  rel14 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel15 <- duckdb:::rel_set_alias(rel14, "lhs")
  rel16 <- duckdb:::rel_set_alias(rel11, "rhs")
  rel17 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel18 <- duckdb:::rel_join(
    rel17,
    rel16,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel17), duckdb:::expr_reference("s_suppkey", rel16))
      )
    ),
    "semi"
  )
  rel19 <- duckdb:::rel_order(rel18, list(duckdb:::expr_reference("___row_number_x", rel17)))
  rel20 <- duckdb:::rel_project(
    rel19,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      }
    )
  )
  rel21 <- duckdb:::rel_set_alias(rel20, "lhs")
  rel22 <- duckdb:::rel_set_alias(rel13, "rhs")
  rel23 <- duckdb:::rel_project(
    rel21,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel24 <- duckdb:::rel_join(
    rel23,
    rel22,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_partkey", rel23), duckdb:::expr_reference("p_partkey", rel22))
      )
    ),
    "semi"
  )
  rel25 <- duckdb:::rel_order(rel24, list(duckdb:::expr_reference("___row_number_x", rel23)))
  rel26 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      }
    )
  )
  df5 <- lineitem
  rel27 <- duckdb:::rel_from_df(con, df5, experimental = experimental)
  rel28 <- duckdb:::rel_filter(
    rel27,
    list(
      duckdb:::expr_function(
        ">=",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1994-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1994-01-01")
              }
            )
          )
        )
      ),
      duckdb:::expr_function(
        "<",
        list(
          duckdb:::expr_reference("l_shipdate"),
          duckdb:::expr_function(
            "as.Date",
            list(
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant("1995-01-01", experimental = experimental)
              } else {
                duckdb:::expr_constant("1995-01-01")
              }
            )
          )
        )
      )
    )
  )
  rel29 <- duckdb:::rel_set_alias(rel28, "lhs")
  rel30 <- duckdb:::rel_set_alias(rel26, "rhs")
  rel31 <- duckdb:::rel_project(
    rel29,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel32 <- duckdb:::rel_join(
    rel31,
    rel30,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_partkey", rel31), duckdb:::expr_reference("ps_partkey", rel30))
      ),
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_suppkey", rel31), duckdb:::expr_reference("ps_suppkey", rel30))
      )
    ),
    "semi"
  )
  rel33 <- duckdb:::rel_order(rel32, list(duckdb:::expr_reference("___row_number_x", rel31)))
  rel34 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_aggregate(
    rel34,
    groups = list(duckdb:::expr_reference("l_suppkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "*",
          list(
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(0.5, experimental = experimental)
            } else {
              duckdb:::expr_constant(0.5)
            },
            duckdb:::expr_function("sum", list(duckdb:::expr_reference("l_quantity")))
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "qty_threshold")
        tmp_expr
      }
    )
  )
  rel36 <- duckdb:::rel_set_alias(rel26, "lhs")
  rel37 <- duckdb:::rel_set_alias(rel35, "rhs")
  rel38 <- duckdb:::rel_project(
    rel36,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_project(
    rel37,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("qty_threshold")
        duckdb:::expr_set_alias(tmp_expr, "qty_threshold")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel40 <- duckdb:::rel_join(
    rel38,
    rel39,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("ps_suppkey", rel38), duckdb:::expr_reference("l_suppkey", rel39))
      )
    ),
    "inner"
  )
  rel41 <- duckdb:::rel_order(
    rel40,
    list(duckdb:::expr_reference("___row_number_x", rel38), duckdb:::expr_reference("___row_number_y", rel39))
  )
  rel42 <- duckdb:::rel_project(
    rel41,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("ps_partkey")
        duckdb:::expr_set_alias(tmp_expr, "ps_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("ps_suppkey", rel38), duckdb:::expr_reference("l_suppkey", rel39))
        )
        duckdb:::expr_set_alias(tmp_expr, "ps_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_availqty")
        duckdb:::expr_set_alias(tmp_expr, "ps_availqty")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_supplycost")
        duckdb:::expr_set_alias(tmp_expr, "ps_supplycost")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("ps_comment")
        duckdb:::expr_set_alias(tmp_expr, "ps_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("qty_threshold")
        duckdb:::expr_set_alias(tmp_expr, "qty_threshold")
        tmp_expr
      }
    )
  )
  rel43 <- duckdb:::rel_filter(
    rel42,
    list(
      duckdb:::expr_function(
        ">",
        list(duckdb:::expr_reference("ps_availqty"), duckdb:::expr_reference("qty_threshold"))
      )
    )
  )
  rel44 <- duckdb:::rel_set_alias(rel11, "lhs")
  rel45 <- duckdb:::rel_set_alias(rel43, "rhs")
  rel46 <- duckdb:::rel_project(
    rel44,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel47 <- duckdb:::rel_join(
    rel46,
    rel45,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_suppkey", rel46), duckdb:::expr_reference("ps_suppkey", rel45))
      )
    ),
    "semi"
  )
  rel48 <- duckdb:::rel_order(rel47, list(duckdb:::expr_reference("___row_number_x", rel46)))
  rel49 <- duckdb:::rel_project(
    rel48,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      }
    )
  )
  rel50 <- duckdb:::rel_project(
    rel49,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      }
    )
  )
  rel51 <- duckdb:::rel_order(rel50, list(duckdb:::expr_reference("s_name")))
  rel51
  duckdb:::rel_to_altrep(rel51)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_21 <- function(con, experimental) {
  df1 <- lineitem
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_aggregate(
    rel1,
    groups = list(duckdb:::expr_reference("l_orderkey"), duckdb:::expr_reference("l_suppkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "n")
        tmp_expr
      }
    )
  )
  rel3 <- duckdb:::rel_aggregate(
    rel2,
    groups = list(duckdb:::expr_reference("l_orderkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "n_supplier")
        tmp_expr
      }
    )
  )
  rel4 <- duckdb:::rel_filter(
    rel3,
    list(
      duckdb:::expr_function(
        ">",
        list(
          duckdb:::expr_reference("n_supplier"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant(1, experimental = experimental)
          } else {
            duckdb:::expr_constant(1)
          }
        )
      )
    )
  )
  rel5 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel6 <- duckdb:::rel_set_alias(rel5, "lhs")
  rel7 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel8 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel9 <- duckdb:::rel_join(
    rel8,
    rel7,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel8), duckdb:::expr_reference("l_orderkey", rel7))
      )
    ),
    "semi"
  )
  rel10 <- duckdb:::rel_order(rel9, list(duckdb:::expr_reference("___row_number_x", rel8)))
  rel11 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_set_alias(rel11, "lhs")
  df2 <- orders
  rel13 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel14 <- duckdb:::rel_set_alias(rel13, "rhs")
  rel15 <- duckdb:::rel_project(
    rel12,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel16 <- duckdb:::rel_project(
    rel14,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("o_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "o_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_join(
    rel15,
    rel16,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel15), duckdb:::expr_reference("o_orderkey", rel16))
      )
    ),
    "inner"
  )
  rel18 <- duckdb:::rel_order(
    rel17,
    list(duckdb:::expr_reference("___row_number_x", rel15), duckdb:::expr_reference("___row_number_y", rel16))
  )
  rel19 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("l_orderkey", rel15), duckdb:::expr_reference("o_orderkey", rel16))
        )
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_custkey")
        duckdb:::expr_set_alias(tmp_expr, "o_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderstatus")
        duckdb:::expr_set_alias(tmp_expr, "o_orderstatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_totalprice")
        duckdb:::expr_set_alias(tmp_expr, "o_totalprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderdate")
        duckdb:::expr_set_alias(tmp_expr, "o_orderdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_orderpriority")
        duckdb:::expr_set_alias(tmp_expr, "o_orderpriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_clerk")
        duckdb:::expr_set_alias(tmp_expr, "o_clerk")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_shippriority")
        duckdb:::expr_set_alias(tmp_expr, "o_shippriority")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("o_comment")
        duckdb:::expr_set_alias(tmp_expr, "o_comment")
        tmp_expr
      }
    )
  )
  rel20 <- duckdb:::rel_filter(
    rel19,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("o_orderstatus"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("F", experimental = experimental)
          } else {
            duckdb:::expr_constant("F")
          }
        )
      )
    )
  )
  rel21 <- duckdb:::rel_aggregate(
    rel20,
    groups = list(duckdb:::expr_reference("l_orderkey"), duckdb:::expr_reference("l_suppkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function(
          "any",
          list(
            duckdb:::expr_function(
              ">",
              list(duckdb:::expr_reference("l_receiptdate"), duckdb:::expr_reference("l_commitdate"))
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "failed_delivery_commit")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_aggregate(
    rel21,
    groups = list(duckdb:::expr_reference("l_orderkey")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "n_supplier")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "sum",
          list(
            duckdb:::expr_function(
              "ifelse",
              list(
                duckdb:::expr_reference("failed_delivery_commit"),
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(1, experimental = experimental)
                } else {
                  duckdb:::expr_constant(1)
                },
                if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                  duckdb:::expr_constant(0, experimental = experimental)
                } else {
                  duckdb:::expr_constant(0)
                }
              )
            )
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "num_failed")
        tmp_expr
      }
    )
  )
  rel23 <- duckdb:::rel_filter(
    rel22,
    list(
      duckdb:::expr_function(
        "&",
        list(
          duckdb:::expr_function(
            ">",
            list(
              duckdb:::expr_reference("n_supplier"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant(1, experimental = experimental)
              } else {
                duckdb:::expr_constant(1)
              }
            )
          ),
          duckdb:::expr_function(
            "==",
            list(
              duckdb:::expr_reference("num_failed"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant(1, experimental = experimental)
              } else {
                duckdb:::expr_constant(1)
              }
            )
          )
        )
      )
    )
  )
  rel24 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel25 <- duckdb:::rel_set_alias(rel24, "lhs")
  rel26 <- duckdb:::rel_set_alias(rel23, "rhs")
  rel27 <- duckdb:::rel_project(
    rel25,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel28 <- duckdb:::rel_join(
    rel27,
    rel26,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("l_orderkey", rel27), duckdb:::expr_reference("l_orderkey", rel26))
      )
    ),
    "semi"
  )
  rel29 <- duckdb:::rel_order(rel28, list(duckdb:::expr_reference("___row_number_x", rel27)))
  rel30 <- duckdb:::rel_project(
    rel29,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      }
    )
  )
  df3 <- supplier
  rel31 <- duckdb:::rel_from_df(con, df3, experimental = experimental)
  rel32 <- duckdb:::rel_set_alias(rel31, "lhs")
  rel33 <- duckdb:::rel_set_alias(rel30, "rhs")
  rel34 <- duckdb:::rel_project(
    rel32,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel35 <- duckdb:::rel_project(
    rel33,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "l_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel36 <- duckdb:::rel_join(
    rel34,
    rel35,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_suppkey", rel34), duckdb:::expr_reference("l_suppkey", rel35))
      )
    ),
    "inner"
  )
  rel37 <- duckdb:::rel_order(
    rel36,
    list(duckdb:::expr_reference("___row_number_x", rel34), duckdb:::expr_reference("___row_number_y", rel35))
  )
  rel38 <- duckdb:::rel_project(
    rel37,
    list(
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_suppkey", rel34), duckdb:::expr_reference("l_suppkey", rel35))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      }
    )
  )
  rel39 <- duckdb:::rel_filter(
    rel38,
    list(
      duckdb:::expr_function(
        ">",
        list(duckdb:::expr_reference("l_receiptdate"), duckdb:::expr_reference("l_commitdate"))
      )
    )
  )
  rel40 <- duckdb:::rel_set_alias(rel39, "lhs")
  df4 <- nation
  rel41 <- duckdb:::rel_from_df(con, df4, experimental = experimental)
  rel42 <- duckdb:::rel_set_alias(rel41, "rhs")
  rel43 <- duckdb:::rel_project(
    rel40,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel44 <- duckdb:::rel_project(
    rel42,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("n_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "n_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel45 <- duckdb:::rel_join(
    rel43,
    rel44,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("s_nationkey", rel43), duckdb:::expr_reference("n_nationkey", rel44))
      )
    ),
    "inner"
  )
  rel46 <- duckdb:::rel_order(
    rel45,
    list(duckdb:::expr_reference("___row_number_x", rel43), duckdb:::expr_reference("___row_number_y", rel44))
  )
  rel47 <- duckdb:::rel_project(
    rel46,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("s_suppkey")
        duckdb:::expr_set_alias(tmp_expr, "s_suppkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_name")
        duckdb:::expr_set_alias(tmp_expr, "s_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_address")
        duckdb:::expr_set_alias(tmp_expr, "s_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("s_nationkey", rel43), duckdb:::expr_reference("n_nationkey", rel44))
        )
        duckdb:::expr_set_alias(tmp_expr, "s_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_phone")
        duckdb:::expr_set_alias(tmp_expr, "s_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "s_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("s_comment")
        duckdb:::expr_set_alias(tmp_expr, "s_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_orderkey")
        duckdb:::expr_set_alias(tmp_expr, "l_orderkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_partkey")
        duckdb:::expr_set_alias(tmp_expr, "l_partkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linenumber")
        duckdb:::expr_set_alias(tmp_expr, "l_linenumber")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_quantity")
        duckdb:::expr_set_alias(tmp_expr, "l_quantity")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_extendedprice")
        duckdb:::expr_set_alias(tmp_expr, "l_extendedprice")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_discount")
        duckdb:::expr_set_alias(tmp_expr, "l_discount")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_tax")
        duckdb:::expr_set_alias(tmp_expr, "l_tax")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_returnflag")
        duckdb:::expr_set_alias(tmp_expr, "l_returnflag")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_linestatus")
        duckdb:::expr_set_alias(tmp_expr, "l_linestatus")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipdate")
        duckdb:::expr_set_alias(tmp_expr, "l_shipdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_commitdate")
        duckdb:::expr_set_alias(tmp_expr, "l_commitdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_receiptdate")
        duckdb:::expr_set_alias(tmp_expr, "l_receiptdate")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipinstruct")
        duckdb:::expr_set_alias(tmp_expr, "l_shipinstruct")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_shipmode")
        duckdb:::expr_set_alias(tmp_expr, "l_shipmode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("l_comment")
        duckdb:::expr_set_alias(tmp_expr, "l_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_name")
        duckdb:::expr_set_alias(tmp_expr, "n_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_regionkey")
        duckdb:::expr_set_alias(tmp_expr, "n_regionkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("n_comment")
        duckdb:::expr_set_alias(tmp_expr, "n_comment")
        tmp_expr
      }
    )
  )
  rel48 <- duckdb:::rel_filter(
    rel47,
    list(
      duckdb:::expr_function(
        "==",
        list(
          duckdb:::expr_reference("n_name"),
          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
            duckdb:::expr_constant("SAUDI ARABIA", experimental = experimental)
          } else {
            duckdb:::expr_constant("SAUDI ARABIA")
          }
        )
      )
    )
  )
  rel49 <- duckdb:::rel_aggregate(
    rel48,
    groups = list(duckdb:::expr_reference("s_name")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "numwait")
        tmp_expr
      }
    )
  )
  rel50 <- duckdb:::rel_order(
    rel49,
    list(duckdb:::expr_function("desc", list(duckdb:::expr_reference("numwait"))), duckdb:::expr_reference("s_name"))
  )
  rel51 <- duckdb:::rel_limit(rel50, 100)
  rel51
  duckdb:::rel_to_altrep(rel51)
}

# Generated by meta_replay_to_fun_file(), do not edit by hand
tpch_raw_oo_22 <- function(con, experimental) {
  df1 <- customer
  rel1 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel2 <- duckdb:::rel_filter(
    rel1,
    list(
      duckdb:::expr_function(
        "&",
        list(
          duckdb:::expr_function(
            "|",
            list(
              duckdb:::expr_function(
                "|",
                list(
                  duckdb:::expr_function(
                    "|",
                    list(
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "|",
                            list(
                              duckdb:::expr_function(
                                "|",
                                list(
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant("13", experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant("13")
                                      },
                                      duckdb:::expr_function(
                                        "substr",
                                        list(
                                          duckdb:::expr_reference("c_phone"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(1L, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(1L)
                                          },
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(2L, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(2L)
                                          }
                                        )
                                      )
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant("31", experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant("31")
                                      },
                                      duckdb:::expr_function(
                                        "substr",
                                        list(
                                          duckdb:::expr_reference("c_phone"),
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(1L, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(1L)
                                          },
                                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                            duckdb:::expr_constant(2L, experimental = experimental)
                                          } else {
                                            duckdb:::expr_constant(2L)
                                          }
                                        )
                                      )
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                "==",
                                list(
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant("23", experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant("23")
                                  },
                                  duckdb:::expr_function(
                                    "substr",
                                    list(
                                      duckdb:::expr_reference("c_phone"),
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(1L, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(1L)
                                      },
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant(2L, experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant(2L)
                                      }
                                    )
                                  )
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("29", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("29")
                              },
                              duckdb:::expr_function(
                                "substr",
                                list(
                                  duckdb:::expr_reference("c_phone"),
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(1L, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(1L)
                                  },
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant(2L, experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant(2L)
                                  }
                                )
                              )
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant("30", experimental = experimental)
                          } else {
                            duckdb:::expr_constant("30")
                          },
                          duckdb:::expr_function(
                            "substr",
                            list(
                              duckdb:::expr_reference("c_phone"),
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(1L, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(1L)
                              },
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant(2L, experimental = experimental)
                              } else {
                                duckdb:::expr_constant(2L)
                              }
                            )
                          )
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant("18", experimental = experimental)
                      } else {
                        duckdb:::expr_constant("18")
                      },
                      duckdb:::expr_function(
                        "substr",
                        list(
                          duckdb:::expr_reference("c_phone"),
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant(1L, experimental = experimental)
                          } else {
                            duckdb:::expr_constant(1L)
                          },
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant(2L, experimental = experimental)
                          } else {
                            duckdb:::expr_constant(2L)
                          }
                        )
                      )
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("17", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("17")
                  },
                  duckdb:::expr_function(
                    "substr",
                    list(
                      duckdb:::expr_reference("c_phone"),
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant(1L, experimental = experimental)
                      } else {
                        duckdb:::expr_constant(1L)
                      },
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant(2L, experimental = experimental)
                      } else {
                        duckdb:::expr_constant(2L)
                      }
                    )
                  )
                )
              )
            )
          ),
          duckdb:::expr_function(
            ">",
            list(
              duckdb:::expr_reference("c_acctbal"),
              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                duckdb:::expr_constant(0, experimental = experimental)
              } else {
                duckdb:::expr_constant(0)
              }
            )
          )
        )
      )
    )
  )
  rel3 <- duckdb:::rel_aggregate(
    rel2,
    groups = list(),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("mean", list(duckdb:::expr_reference("c_acctbal")))
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "join_id")
        tmp_expr
      }
    )
  )
  rel4 <- duckdb:::rel_distinct(rel3)
  rel5 <- duckdb:::rel_from_df(con, df1, experimental = experimental)
  rel6 <- duckdb:::rel_project(
    rel5,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "substr",
          list(
            duckdb:::expr_reference("c_phone"),
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(1L, experimental = experimental)
            } else {
              duckdb:::expr_constant(1L)
            },
            if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
              duckdb:::expr_constant(2L, experimental = experimental)
            } else {
              duckdb:::expr_constant(2L)
            }
          )
        )
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      }
    )
  )
  rel7 <- duckdb:::rel_project(
    rel6,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      },
      {
        tmp_expr <- if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
          duckdb:::expr_constant(1L, experimental = experimental)
        } else {
          duckdb:::expr_constant(1L)
        }
        duckdb:::expr_set_alias(tmp_expr, "join_id")
        tmp_expr
      }
    )
  )
  rel8 <- duckdb:::rel_set_alias(rel7, "lhs")
  rel9 <- duckdb:::rel_set_alias(rel4, "rhs")
  rel10 <- duckdb:::rel_project(
    rel8,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("join_id")
        duckdb:::expr_set_alias(tmp_expr, "join_id_x")
        tmp_expr
      }
    )
  )
  rel11 <- duckdb:::rel_project(
    rel9,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("acctbal_min")
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("join_id")
        duckdb:::expr_set_alias(tmp_expr, "join_id_y")
        tmp_expr
      }
    )
  )
  rel12 <- duckdb:::rel_project(
    rel10,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey_x")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name_x")
        duckdb:::expr_set_alias(tmp_expr, "c_name_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address_x")
        duckdb:::expr_set_alias(tmp_expr, "c_address_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey_x")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone_x")
        duckdb:::expr_set_alias(tmp_expr, "c_phone_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal_x")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment_x")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "c_comment_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode_x")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("join_id_x")
        duckdb:::expr_set_alias(tmp_expr, "join_id_x")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel13 <- duckdb:::rel_project(
    rel11,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("acctbal_min_y")
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("join_id_y")
        duckdb:::expr_set_alias(tmp_expr, "join_id_y")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_y")
        tmp_expr
      }
    )
  )
  rel14 <- duckdb:::rel_join(
    rel12,
    rel13,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("join_id_x", rel12), duckdb:::expr_reference("join_id_y", rel13))
      )
    ),
    "left"
  )
  rel15 <- duckdb:::rel_order(
    rel14,
    list(duckdb:::expr_reference("___row_number_x", rel12), duckdb:::expr_reference("___row_number_y", rel13))
  )
  rel16 <- duckdb:::rel_project(
    rel15,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey_x")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name_x")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address_x")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey_x")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone_x")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal_x")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment_x")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment_x")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode_x")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function(
          "___coalesce",
          list(duckdb:::expr_reference("join_id_x", rel12), duckdb:::expr_reference("join_id_y", rel13))
        )
        duckdb:::expr_set_alias(tmp_expr, "join_id")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("acctbal_min_y")
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min")
        tmp_expr
      }
    )
  )
  rel17 <- duckdb:::rel_filter(
    rel16,
    list(
      duckdb:::expr_function(
        "&",
        list(
          duckdb:::expr_function(
            "|",
            list(
              duckdb:::expr_function(
                "|",
                list(
                  duckdb:::expr_function(
                    "|",
                    list(
                      duckdb:::expr_function(
                        "|",
                        list(
                          duckdb:::expr_function(
                            "|",
                            list(
                              duckdb:::expr_function(
                                "|",
                                list(
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant("13", experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant("13")
                                      },
                                      duckdb:::expr_reference("cntrycode")
                                    )
                                  ),
                                  duckdb:::expr_function(
                                    "==",
                                    list(
                                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                        duckdb:::expr_constant("31", experimental = experimental)
                                      } else {
                                        duckdb:::expr_constant("31")
                                      },
                                      duckdb:::expr_reference("cntrycode")
                                    )
                                  )
                                )
                              ),
                              duckdb:::expr_function(
                                "==",
                                list(
                                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                    duckdb:::expr_constant("23", experimental = experimental)
                                  } else {
                                    duckdb:::expr_constant("23")
                                  },
                                  duckdb:::expr_reference("cntrycode")
                                )
                              )
                            )
                          ),
                          duckdb:::expr_function(
                            "==",
                            list(
                              if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                                duckdb:::expr_constant("29", experimental = experimental)
                              } else {
                                duckdb:::expr_constant("29")
                              },
                              duckdb:::expr_reference("cntrycode")
                            )
                          )
                        )
                      ),
                      duckdb:::expr_function(
                        "==",
                        list(
                          if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                            duckdb:::expr_constant("30", experimental = experimental)
                          } else {
                            duckdb:::expr_constant("30")
                          },
                          duckdb:::expr_reference("cntrycode")
                        )
                      )
                    )
                  ),
                  duckdb:::expr_function(
                    "==",
                    list(
                      if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                        duckdb:::expr_constant("18", experimental = experimental)
                      } else {
                        duckdb:::expr_constant("18")
                      },
                      duckdb:::expr_reference("cntrycode")
                    )
                  )
                )
              ),
              duckdb:::expr_function(
                "==",
                list(
                  if ("experimental" %in% names(formals(duckdb:::expr_constant))) {
                    duckdb:::expr_constant("17", experimental = experimental)
                  } else {
                    duckdb:::expr_constant("17")
                  },
                  duckdb:::expr_reference("cntrycode")
                )
              )
            )
          ),
          duckdb:::expr_function(
            ">",
            list(duckdb:::expr_reference("c_acctbal"), duckdb:::expr_reference("acctbal_min"))
          )
        )
      )
    )
  )
  rel18 <- duckdb:::rel_set_alias(rel17, "lhs")
  df2 <- orders
  rel19 <- duckdb:::rel_from_df(con, df2, experimental = experimental)
  rel20 <- duckdb:::rel_set_alias(rel19, "rhs")
  rel21 <- duckdb:::rel_project(
    rel18,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("join_id")
        duckdb:::expr_set_alias(tmp_expr, "join_id")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("acctbal_min")
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_window(duckdb:::expr_function("row_number", list()), list(), list(), offset_expr = NULL, default_expr = NULL)
        duckdb:::expr_set_alias(tmp_expr, "___row_number_x")
        tmp_expr
      }
    )
  )
  rel22 <- duckdb:::rel_join(
    rel21,
    rel20,
    list(
      duckdb:::expr_function(
        "==",
        list(duckdb:::expr_reference("c_custkey", rel21), duckdb:::expr_reference("o_custkey", rel20))
      )
    ),
    "anti"
  )
  rel23 <- duckdb:::rel_order(rel22, list(duckdb:::expr_reference("___row_number_x", rel21)))
  rel24 <- duckdb:::rel_project(
    rel23,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("c_custkey")
        duckdb:::expr_set_alias(tmp_expr, "c_custkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_name")
        duckdb:::expr_set_alias(tmp_expr, "c_name")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_address")
        duckdb:::expr_set_alias(tmp_expr, "c_address")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_nationkey")
        duckdb:::expr_set_alias(tmp_expr, "c_nationkey")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_phone")
        duckdb:::expr_set_alias(tmp_expr, "c_phone")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_mktsegment")
        duckdb:::expr_set_alias(tmp_expr, "c_mktsegment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_comment")
        duckdb:::expr_set_alias(tmp_expr, "c_comment")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("join_id")
        duckdb:::expr_set_alias(tmp_expr, "join_id")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("acctbal_min")
        duckdb:::expr_set_alias(tmp_expr, "acctbal_min")
        tmp_expr
      }
    )
  )
  rel25 <- duckdb:::rel_project(
    rel24,
    list(
      {
        tmp_expr <- duckdb:::expr_reference("cntrycode")
        duckdb:::expr_set_alias(tmp_expr, "cntrycode")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_reference("c_acctbal")
        duckdb:::expr_set_alias(tmp_expr, "c_acctbal")
        tmp_expr
      }
    )
  )
  rel26 <- duckdb:::rel_aggregate(
    rel25,
    groups = list(duckdb:::expr_reference("cntrycode")),
    aggregates = list(
      {
        tmp_expr <- duckdb:::expr_function("n", list())
        duckdb:::expr_set_alias(tmp_expr, "numcust")
        tmp_expr
      },
      {
        tmp_expr <- duckdb:::expr_function("sum", list(duckdb:::expr_reference("c_acctbal")))
        duckdb:::expr_set_alias(tmp_expr, "totacctbal")
        tmp_expr
      }
    )
  )
  rel27 <- duckdb:::rel_order(rel26, list(duckdb:::expr_reference("cntrycode")))
  rel27
  duckdb:::rel_to_altrep(rel27)
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr transmute
#' @export
transmute.data.frame <- function(.data, ...) {
  force(.data)

  dots <- check_transmute_args(...)
  dots <- dplyr_quosures(!!!dots)

  rel_try(
    "Can't use relational with zero-column result set." = (length(dots) == 0),
    {
      exprs <- rel_translate_dots(dots, .data)
      rel <- duckdb_rel_from_df(.data)
      out_rel <- rel_project(rel, exprs)
      out <- rel_to_df(out_rel)
      out <- dplyr_reconstruct(out, .data)
      return(out)
    }
  )

  # dplyr forward
  transmute <- transmute_data_frame
  out <- transmute(.data, ...)
  return(out)

  # dplyr implementation
  dots <- check_transmute_args(...)
  dots <- dplyr_quosures(!!!dots)

  # We don't expose `.by` because `transmute()` is superseded
  by <- compute_by(by = NULL, data = .data)

  cols <- mutate_cols(.data, dots, by)

  out <- dplyr_col_modify(.data, cols)

  # Compact out `NULL` columns that got removed.
  # These won't exist in `out`, but we don't want them to look "new".
  # Note that `dplyr_col_modify()` makes it impossible to `NULL` a group column,
  # which we rely on below.
  cols <- compact_null(cols)

  # Retain expression columns in order of their appearance
  cols_expr <- names(cols)

  # Retain untouched group variables up front
  cols_group <- by$names
  cols_group <- setdiff(cols_group, cols_expr)

  cols_retain <- c(cols_group, cols_expr)

  dplyr_col_select(out, cols_retain)
}

duckplyr_transmute <- function(.data, ...) {
  try_fetch(
    .data <- as_duckplyr_df(.data),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- transmute(.data, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr ungroup
#' @export
ungroup.data.frame <- function(x, ...) {
  # Our implementation
  rel_try(
    "No relational implementation for ungroup()" = TRUE,
    {
      return(out)
    }
  )

  # dplyr forward
  ungroup <- ungroup_data_frame
  out <- ungroup(x, ...)
  return(out)

  # dplyr implementation
  check_dots_empty()
  x
}

duckplyr_ungroup <- function(x, ...) {
  try_fetch(
    x <- as_duckplyr_df(x),
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- ungroup(x, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr union
#' @export
union.data.frame <- function(x, y, ...) {
  # Our implementation
  check_dots_empty()

  # This is difficult to do manually due to order preservation
  return(distinct(union_all(x, y)))

  # dplyr forward
  union <- union_data_frame
  out <- union(x, y, ...)
  return(out)

  # dplyr implementation
  check_dots_empty()
  check_compatible(x, y)

  out <- vec_set_union(x, y, error_call = current_env())

  dplyr_reconstruct(out, x)
}

duckplyr_union <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- union(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

# Generated by 02-duckplyr_df-methods.R
#' @importFrom dplyr union_all
#' @export
union_all.data.frame <- function(x, y, ...) {
  # Our implementation
  check_dots_empty()

  x_names <- names(x)
  y_names <- names(y)
  if (identical(x_names, y_names)) {
    # Ensure identical() is very cheap
    y_names <- x_names
  }

  rel_try(
    "No duplicate names" = !identical(x_names, y_names) && anyDuplicated(x_names) && anyDuplicated(y_names),
    "Tables of different width" = length(x_names) != length(y_names),
    "Name mismatch" = !identical(x_names, y_names) && !all(y_names %in% x_names),
    {
      x_rel <- duckdb_rel_from_df(x)
      y_rel <- duckdb_rel_from_df(y)
      if (!identical(x_names, y_names)) {
        # FIXME: Select by position
        exprs <- nexprs_from_loc(x_names, set_names(seq_along(x_names), x_names))
        y_rel <- rel_project(y_rel, exprs)
      }

      rel <- rel_union_all(x_rel, y_rel)
      out <- rel_to_df(rel)
      out <- dplyr_reconstruct(out, x)
      return(out)
    }
  )

  # dplyr forward
  union_all <- union_all_data_frame
  out <- union_all(x, y, ...)
  return(out)

  # dplyr implementation
  check_dots_empty()
  check_compatible(x, y)

  out <- vec_rbind(x, y)
  dplyr_reconstruct(out, x)
}

duckplyr_union_all <- function(x, y, ...) {
  try_fetch(
    {
      x <- as_duckplyr_df(x)
      y <- as_duckplyr_df(y)
    },
    error = function(e) {
      testthat::skip(conditionMessage(e))
    }
  )
  out <- union_all(x, y, ...)
  class(out) <- setdiff(class(out), "duckplyr_df")
  out
}

